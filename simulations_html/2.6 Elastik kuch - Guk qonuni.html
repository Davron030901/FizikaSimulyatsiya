<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guk Qonuni Simulyatsiyasi</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .panel { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .panel h2 { margin-bottom: 20px; color: #667eea; border-bottom: 3px solid #667eea; padding-bottom: 10px; }
        
        /* Spring System */
        .spring-container { position: relative; height: 400px; background: linear-gradient(180deg, #e3f2fd 0%, #fff 100%); border-radius: 10px; overflow: hidden; }
        .ceiling { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 200px; height: 25px; background: #8B4513; border-radius: 0 0 5px 5px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
        .ceiling::after { content: ''; position: absolute; bottom: -10px; left: 0; right: 0; height: 15px; background: repeating-linear-gradient(45deg, #8B4513, #8B4513 10px, #A0522D 10px, #A0522D 20px); }
        .spring { position: absolute; left: 50%; transform: translateX(-50%); width: 30px; top: 40px; }
        .spring-coil { width: 100%; border: 3px solid #4CAF50; border-radius: 50%; margin: 0; background: linear-gradient(90deg, #4CAF50 0%, #81C784 100%); box-shadow: inset 0 2px 4px rgba(0,0,0,0.2); }
        .mass { position: absolute; left: 50%; transform: translateX(-50%); width: 80px; height: 50px; background: linear-gradient(145deg, #FF6B6B, #FF5252); border-radius: 10px; box-shadow: 0 6px 20px rgba(255,107,107,0.5); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 16px; will-change: top; }
        .mass::before { content: ''; position: absolute; top: -8px; width: 15px; height: 15px; background: #333; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .force-arrow { position: absolute; left: 50%; transform: translateX(-50%); width: 6px; background: linear-gradient(180deg, #E91E63, #C2185B); transition: all 0.3s ease; box-shadow: 0 0 10px rgba(233,30,99,0.5); }
        .force-arrow::after { content: ''; position: absolute; bottom: -15px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 20px solid #C2185B; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
        .force-label { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: #E91E63; font-weight: bold; font-size: 18px; background: white; padding: 5px 10px; border-radius: 5px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .ref-line { position: absolute; left: 0; right: 0; height: 2px; background: #FF9800; z-index: 10; }
        .ref-line::before { content: attr(data-label); position: absolute; right: 10px; top: -22px; color: #FF9800; font-size: 11px; font-weight: bold; background: white; padding: 2px 6px; border-radius: 3px; }
        
        /* Graph */
        .graph-wrapper { position: relative; height: 400px; background: #f9f9f9; border-radius: 10px; padding: 10px; }
        canvas { width: 100%; height: 100%; border-radius: 8px; }
        
        /* Controls */
        .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .control-item { background: linear-gradient(145deg, #f8f9fa, #e9ecef); padding: 20px; border-radius: 12px; border: 2px solid #dee2e6; transition: all 0.3s ease; }
        .control-item:hover { border-color: #667eea; box-shadow: 0 6px 20px rgba(102,126,234,0.3); transform: translateY(-2px); }
        .control-item label { display: block; margin-bottom: 10px; font-weight: 600; color: #495057; font-size: 14px; }
        input[type="range"] { width: 100%; height: 8px; border-radius: 5px; background: linear-gradient(to right, #667eea, #764ba2); outline: none; -webkit-appearance: none; appearance: none; margin-bottom: 10px; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 22px; height: 22px; border-radius: 50%; background: white; cursor: pointer; box-shadow: 0 3px 8px rgba(0,0,0,0.3); border: 3px solid #667eea; }
        input[type="range"]::-moz-range-thumb { width: 22px; height: 22px; border-radius: 50%; background: white; cursor: pointer; border: 3px solid #667eea; box-shadow: 0 3px 8px rgba(0,0,0,0.3); }
        input[type="number"] { width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 14px; transition: border-color 0.3s ease; }
        input[type="number"]:focus { outline: none; border-color: #667eea; }
        .value-display { text-align: center; font-size: 16px; color: #667eea; font-weight: bold; background: white; padding: 8px; border-radius: 8px; margin-top: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
        .preset-btns { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
        .preset-btn { flex: 1; padding: 8px 12px; border: none; border-radius: 20px; background: linear-gradient(145deg, #667eea, #764ba2); color: white; cursor: pointer; font-size: 12px; font-weight: 600; transition: all 0.3s ease; }
        .preset-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102,126,234,0.4); }
        
        /* Action Buttons */
        .actions { display: flex; gap: 15px; justify-content: center; align-items: center; margin-top: 20px; flex-wrap: wrap; }
        .btn { padding: 12px 24px; border: none; border-radius: 25px; color: white; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
        .btn-play { background: linear-gradient(145deg, #28a745, #20c997); }
        .btn-reset { background: linear-gradient(145deg, #dc3545, #c82333); }
        .btn-export { background: linear-gradient(145deg, #007bff, #0056b3); }
        
        /* Info Cards */
        .info-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .info-card { background: linear-gradient(145deg, #ffffff, #f8f9fa); padding: 20px; border-radius: 12px; text-align: center; border: 2px solid #e9ecef; transition: all 0.3s ease; }
        .info-card:hover { border-color: #667eea; box-shadow: 0 8px 25px rgba(102,126,234,0.2); transform: translateY(-3px); }
        .info-card h3 { color: #667eea; margin-bottom: 10px; font-size: 14px; font-weight: 600; }
        .info-card .value { font-size: 2em; font-weight: bold; color: #495057; }
        .info-card .unit { color: #6c757d; font-size: 0.9em; margin-top: 5px; }
        
        /* Tabs */
        .tabs { display: flex; gap: 5px; margin-bottom: 20px; border-bottom: 2px solid #e9ecef; }
        .tab { padding: 12px 24px; border: none; background: transparent; cursor: pointer; transition: all 0.3s ease; font-weight: 600; color: #6c757d; border-bottom: 3px solid transparent; }
        .tab.active { color: #667eea; border-bottom-color: #667eea; }
        .tab-content { display: none; padding: 20px; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .formula-box { background: linear-gradient(145deg, #f8f9fa, #e9ecef); padding: 20px; border-radius: 10px; margin: 15px 0; border-left: 5px solid #667eea; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .formula-box strong { color: #667eea; font-size: 18px; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
            .header h1 { font-size: 2em; }
            .controls { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öôÔ∏è Guk Qonuni - Interaktiv Simulyatsiya</h1>
            <p>Prujina elastikligi va kuch-cho'zilish bog'lanishini o'rganing</p>
        </div>

        <div class="grid">
            <div class="panel">
                <h2>üåÄ Prujina-Yuk Tizimi</h2>
                <div class="spring-container">
                    <div class="ceiling"></div>
                    <div class="spring" id="spring"></div>
                    <div class="mass" id="mass">1 kg</div>
                    <div class="ref-line" id="eq-line" data-label="Muvozanat"></div>
                    <div class="force-arrow" id="arrow"></div>
                    <div class="force-label" id="f-label">F = 0 N</div>
                </div>
            </div>

            <div class="panel">
                <h2>üìä Kuch-Cho'zilish Grafigi</h2>
                <div class="graph-wrapper">
                    <canvas id="graph"></canvas>
                </div>
            </div>
        </div>

        <div class="panel">
            <h2>üéõÔ∏è Boshqaruv Paneli</h2>
            <div class="controls">
                <div class="control-item">
                    <label>Bikrlik koeffitsienti (k)</label>
                    <input type="range" id="k-range" min="10" max="100" value="50" step="5">
                    <input type="number" id="k-num" min="10" max="100" value="50">
                    <div class="value-display">k = <span id="k-val">50</span> N/m</div>
                    <div class="preset-btns">
                        <button class="preset-btn" data-param="k" data-value="20">Yumshoq</button>
                        <button class="preset-btn" data-param="k" data-value="50">O'rta</button>
                        <button class="preset-btn" data-param="k" data-value="100">Qattiq</button>
                    </div>
                </div>

                <div class="control-item">
                    <label>Cho'zilish (x)</label>
                    <input type="range" id="x-range" min="0" max="20" value="5" step="0.5">
                    <input type="number" id="x-num" min="0" max="20" value="5" step="0.1">
                    <div class="value-display">x = <span id="x-val">5</span> cm</div>
                    <div class="preset-btns">
                        <button class="preset-btn" data-param="x" data-value="0">0 cm</button>
                        <button class="preset-btn" data-param="x" data-value="10">10 cm</button>
                        <button class="preset-btn" data-param="x" data-value="20">20 cm</button>
                    </div>
                </div>

                <div class="control-item">
                    <label>Massa (m)</label>
                    <input type="range" id="m-range" min="0.5" max="5" value="1" step="0.5">
                    <input type="number" id="m-num" min="0.5" max="5" value="1" step="0.1">
                    <div class="value-display">m = <span id="m-val">1</span> kg</div>
                    <div class="preset-btns">
                        <button class="preset-btn" data-param="m" data-value="0.5">0.5 kg</button>
                        <button class="preset-btn" data-param="m" data-value="2">2 kg</button>
                        <button class="preset-btn" data-param="m" data-value="5">5 kg</button>
                    </div>
                </div>

                <div class="control-item">
                    <label>Animatsiya Tezligi</label>
                    <input type="range" id="spd-range" min="0.5" max="3" value="1" step="0.5">
                    <div class="value-display">Tezlik: <span id="spd-val">1</span>x</div>
                </div>
            </div>

            <div class="actions">
                <button class="btn btn-play" id="play-btn">‚ñ∂ Boshlash</button>
                <button class="btn btn-reset" id="reset-btn">üîÑ Qaytarish</button>
                <button class="btn btn-export" id="export-btn">üíæ Saqlash</button>
            </div>
        </div>

        <div class="info-cards">
            <div class="info-card">
                <h3>Elastik Kuch</h3>
                <div class="value" id="f-elastic">0</div>
                <div class="unit">N (Nyuton)</div>
            </div>
            <div class="info-card">
                <h3>Potensial Energiya</h3>
                <div class="value" id="energy">0</div>
                <div class="unit">J (Joul)</div>
            </div>
            <div class="info-card">
                <h3>Cho'zilish</h3>
                <div class="value" id="disp">0</div>
                <div class="unit">cm</div>
            </div>
            <div class="info-card">
                <h3>Og'irlik Kuchi</h3>
                <div class="value" id="weight">0</div>
                <div class="unit">N (Nyuton)</div>
            </div>
        </div>

        <div class="panel">
            <div class="tabs">
                <button class="tab active" data-tab="0">üìö Nazariya</button>
                <button class="tab" data-tab="1">üìê Formulalar</button>
                <button class="tab" data-tab="2">üí° Misollar</button>
            </div>

            <div class="tab-content active">
                <h3>Guk Qonuni haqida</h3>
                <p>Guk qonuni elastik jismlarning deformatsiyasi va kuch orasidagi munosabatni ifodalaydi. Ingliz olimi Robert Hooke tomonidan 1660-yilda kashf etilgan.</p>
                <div class="formula-box">
                    <strong>Asosiy formula:</strong><br><br>
                    $$F = -kx$$
                    <ul style="margin-top: 10px; line-height: 2;">
                        <li><strong>F</strong> - qaytaruvchi kuch (N)</li>
                        <li><strong>k</strong> - bikrlik koeffitsienti (N/m)</li>
                        <li><strong>x</strong> - cho'zilish (m)</li>
                    </ul>
                </div>
                <p><strong>Minus belgisi:</strong> Qaytaruvchi kuch har doim cho'zilish yo'nalishiga qarama-qarshi tomonga yo'nalgan.</p>
            </div>

            <div class="tab-content">
                <h3>Muhim Formulalar</h3>
                <div class="formula-box">
                    <strong>1. Guk qonuni:</strong><br>$$F = -kx$$
                </div>
                <div class="formula-box">
                    <strong>2. Elastik potensial energiya:</strong><br>$$U = \frac{1}{2}kx^2$$
                </div>
                <div class="formula-box">
                    <strong>3. Tebranish davri:</strong><br>$$T = 2\pi\sqrt{\frac{m}{k}}$$
                </div>
                <div class="formula-box">
                    <strong>4. Tebranish chastotasi:</strong><br>$$f = \frac{1}{2\pi}\sqrt{\frac{k}{m}}$$
                </div>
                <div class="formula-box">
                    <strong>5. Muvozanat sharti:</strong><br>$$kx_0 = mg$$
                </div>
            </div>

            <div class="tab-content">
                <h3>Hayotiy Qo'llanmalar</h3>
                <div class="formula-box">
                    <strong>üöó Avtomobil Ressori</strong><br>
                    k ‚âà 30,000 N/m<br>
                    Yo'l notekisliklarini yumshatadi va haydovchilik qulayligini oshiradi.
                </div>
                <div class="formula-box">
                    <strong>üèπ Kamon (Yoy)</strong><br>
                    k ‚âà 500-1000 N/m<br>
                    O'qqa kinetik energiya berish uchun elastik energiyadan foydalaniladi.
                </div>
                <div class="formula-box">
                    <strong>‚öñÔ∏è Prujinali Tarozi</strong><br>
                    k ‚âà 10-100 N/m<br>
                    Massani cho'zilishni o'lchash orqali aniqlaydi.
                </div>
                <div class="formula-box">
                    <strong>‚è∞ Soat Mexanizmi</strong><br>
                    k ‚âà 0.1-1 N/m<br>
                    Muntazam tebranishlar orqali vaqtni o'lchaydi.
                </div>
            </div>
        </div>
    </div>

    <script>
        let state = { k: 50, x: 5, m: 1, speed: 1, isPlaying: false, time: 0 };
        let animFrame;

        function init() {
            const spring = document.getElementById('spring');
            spring.innerHTML = '';
            // Create 25 coils for smoother spring effect
            for (let i = 0; i < 25; i++) {
                const coil = document.createElement('div');
                coil.className = 'spring-coil';
                spring.appendChild(coil);
            }
            bindEvents();
            update();
            drawGraph();
        }

        function bindEvents() {
            ['k', 'x', 'm'].forEach(p => {
                const range = document.getElementById(p + '-range');
                const num = document.getElementById(p + '-num');
                if (range) range.oninput = e => setParam(p, e.target.value);
                if (num) num.oninput = e => setParam(p, e.target.value);
            });

            const spdRange = document.getElementById('spd-range');
            if (spdRange) {
                spdRange.oninput = e => {
                    state.speed = parseFloat(e.target.value);
                    document.getElementById('spd-val').textContent = state.speed;
                };
            }

            const playBtn = document.getElementById('play-btn');
            const resetBtn = document.getElementById('reset-btn');
            const exportBtn = document.getElementById('export-btn');
            
            if (playBtn) playBtn.addEventListener('click', togglePlay);
            if (resetBtn) resetBtn.addEventListener('click', reset);
            if (exportBtn) exportBtn.addEventListener('click', exportData);

            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    setParam(btn.dataset.param, btn.dataset.value);
                });
            });

            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    showTab(parseInt(tab.dataset.tab));
                });
            });
        }

        function setParam(param, val) {
            val = parseFloat(val);
            const limits = { k: [10, 100], x: [0, 20], m: [0.5, 5], spd: [0.5, 3] };
            if (limits[param]) val = Math.max(limits[param][0], Math.min(limits[param][1], val));
            
            if (param === 'k') state.k = val;
            else if (param === 'x') state.x = val;
            else if (param === 'm') state.m = val;
            else if (param === 'spd') state.speed = val;

            // Update UI elements safely
            const updateElement = (id, value) => {
                const el = document.getElementById(id);
                if (el) el.value = value;
            };

            const updateText = (id, value) => {
                const el = document.getElementById(id);
                if (el) el.textContent = value;
            };

            if (param === 'k') {
                updateElement('k-range', state.k);
                updateElement('k-num', state.k);
                updateText('k-val', state.k);
            } else if (param === 'x') {
                updateElement('x-range', state.x);
                updateElement('x-num', state.x);
                updateText('x-val', state.x);
            } else if (param === 'm') {
                updateElement('m-range', state.m);
                updateElement('m-num', state.m);
                updateText('m-val', state.m);
            } else if (param === 'spd') {
                updateElement('spd-range', state.speed);
                updateText('spd-val', state.speed);
            }

            update();
            drawGraph();
        }

        function update() {
            const xm = state.x / 100;
            const F = state.k * xm;
            const U = 0.5 * state.k * xm * xm;
            const W = state.m * 9.8;

            // Update spring with realistic coil spacing
            const springEl = document.getElementById('spring');
            const coils = springEl.querySelectorAll('.spring-coil');
            const naturalHeight = 100;
            const maxStretch = 250;
            const currentStretch = (state.x / 20) * maxStretch;
            const totalHeight = naturalHeight + currentStretch;
            
            // Calculate coil properties based on stretch
            const baseCoilHeight = 6;
            const coilHeight = baseCoilHeight + (state.x / 20) * 6; // Coils get taller when stretched
            const spacing = (totalHeight - (coils.length * coilHeight)) / (coils.length - 1);
            
            // Apply to each coil with smooth transition
            let currentY = 0;
            coils.forEach((coil, i) => {
                coil.style.height = coilHeight + 'px';
                coil.style.marginTop = (i === 0 ? 0 : spacing) + 'px';
                
                // Add slight wave effect for more realism
                const wave = Math.sin((i / coils.length) * Math.PI) * 2;
                coil.style.width = (30 + wave) + 'px';
            });

            springEl.style.height = totalHeight + 'px';

            // Update mass position smoothly
            const massTop = 40 + totalHeight;
            const massEl = document.getElementById('mass');
            massEl.style.top = massTop + 'px';
            massEl.textContent = state.m + ' kg';

            // Add subtle rotation effect when stretching
            const rotation = (state.x / 20) * 3;
            massEl.style.transform = `translateX(-50%) rotate(${Math.sin(rotation) * 2}deg)`;

            // Update force arrow with smooth animation
            const arrowH = Math.min(F * 20, 150);
            const arrow = document.getElementById('arrow');
            if (F > 0.05) {
                arrow.style.height = arrowH + 'px';
                arrow.style.top = (massTop + 50) + 'px';
                arrow.style.display = 'block';
                arrow.style.opacity = Math.min(F / 5, 1);
            } else {
                arrow.style.display = 'none';
            }

            const fLabel = document.getElementById('f-label');
            fLabel.textContent = `F = ${F.toFixed(2)} N ‚Üë`;
            fLabel.style.top = (massTop + 15) + 'px';

            // Update equilibrium line
            const eqExtension = (W / state.k) * 100;
            const eqY = 40 + naturalHeight + ((eqExtension / 20) * maxStretch);
            const eqLine = document.getElementById('eq-line');
            if (eqY < 380 && eqExtension < 20) {
                eqLine.style.top = eqY + 'px';
                eqLine.style.display = 'block';
            } else {
                eqLine.style.display = 'none';
            }

            // Update info cards
            document.getElementById('f-elastic').textContent = F.toFixed(2);
            document.getElementById('energy').textContent = U.toFixed(4);
            document.getElementById('disp').textContent = state.x.toFixed(1);
            document.getElementById('weight').textContent = W.toFixed(2);
        }

        function drawGraph() {
            const canvas = document.getElementById('graph');
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;

            const w = canvas.width, h = canvas.height;
            const p = 40;

            ctx.clearRect(0, 0, w, h);
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;

            for (let i = 0; i <= 10; i++) {
                const x = p + i * (w - 2 * p) / 10;
                ctx.beginPath(); ctx.moveTo(x, p); ctx.lineTo(x, h - p); ctx.stroke();
                const y = h - p - i * (h - 2 * p) / 10;
                ctx.beginPath(); ctx.moveTo(p, y); ctx.lineTo(w - p, y); ctx.stroke();
            }

            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(p, h - p); ctx.lineTo(w - p, h - p); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(p, p); ctx.lineTo(p, h - p); ctx.stroke();

            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(p, h - p);
            ctx.lineTo(w - p, p);
            ctx.stroke();

            if (state.x > 0) {
                const xm = state.x / 100;
                const F = state.k * xm;
                const px = p + (xm / 0.2) * (w - 2 * p);
                const py = h - p - (F / (state.k * 0.2)) * (h - 2 * p);

                ctx.fillStyle = '#FF6B6B';
                ctx.beginPath();
                ctx.arc(px, py, 10, 0, 2 * Math.PI);
                ctx.fill();

                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.fillText(`(${xm.toFixed(2)}, ${F.toFixed(1)})`, px + 15, py - 10);
            }

            ctx.fillStyle = '#667eea';
            ctx.font = 'bold 16px Arial';
            ctx.fillText(`F = ${state.k}x`, p + 10, p + 25);

            ctx.fillStyle = '#666';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Cho\'zilish (m)', w / 2, h - 5);
            ctx.save();
            ctx.translate(15, h / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Kuch (N)', 0, 0);
            ctx.restore();
        }

        function togglePlay() {
            state.isPlaying = !state.isPlaying;
            const btn = document.getElementById('play-btn');
            btn.textContent = state.isPlaying ? '‚è∏ To\'xtatish' : '‚ñ∂ Boshlash';
            if (state.isPlaying) animate();
            else cancelAnimationFrame(animFrame);
        }

        function animate() {
            if (!state.isPlaying) return;
            
            const deltaTime = 0.016 * state.speed;
            state.time += deltaTime;
            
            // Calculate natural frequency
            const omega = Math.sqrt(state.k / state.m);
            const freq = omega / (2 * Math.PI);
            const period = 1 / freq;
            
            // Use cosine for smooth oscillation starting from maximum
            const amplitude = 10; // cm
            const phase = omega * state.time;
            
            // Calculate position with damping effect for realism
            const dampingFactor = 0.98; // Slight damping
            const currentAmp = amplitude * Math.pow(dampingFactor, state.time);
            const newX = Math.abs(currentAmp * Math.cos(phase));
            
            // Smooth update
            state.x = newX;
            
            // Update all elements
            const xm = state.x / 100;
            const F = state.k * xm;
            const U = 0.5 * state.k * xm * xm;
            const W = state.m * 9.8;

            // Direct DOM manipulation for smooth 60fps animation
            const springEl = document.getElementById('spring');
            const coils = springEl.querySelectorAll('.spring-coil');
            const naturalHeight = 100;
            const maxStretch = 250;
            const currentStretch = (state.x / 20) * maxStretch;
            const totalHeight = naturalHeight + currentStretch;
            
            const baseCoilHeight = 6;
            const coilHeight = baseCoilHeight + (state.x / 20) * 6;
            const spacing = (totalHeight - (coils.length * coilHeight)) / (coils.length - 1);
            
            coils.forEach((coil, i) => {
                coil.style.height = coilHeight + 'px';
                coil.style.marginTop = (i === 0 ? 0 : spacing) + 'px';
                const wave = Math.sin((i / coils.length) * Math.PI + state.time * 3) * 1.5;
                coil.style.width = (30 + wave) + 'px';
            });

            springEl.style.height = totalHeight + 'px';

            const massTop = 40 + totalHeight;
            const massEl = document.getElementById('mass');
            massEl.style.top = massTop + 'px';
            
            const rotation = Math.sin(phase) * 3;
            massEl.style.transform = `translateX(-50%) rotate(${rotation}deg)`;

            const arrowH = Math.min(F * 20, 150);
            const arrow = document.getElementById('arrow');
            if (F > 0.05) {
                arrow.style.height = arrowH + 'px';
                arrow.style.top = (massTop + 50) + 'px';
                arrow.style.opacity = Math.min(F / 5, 1);
            }

            document.getElementById('f-label').textContent = `F = ${F.toFixed(2)} N ‚Üë`;
            document.getElementById('x-val').textContent = state.x.toFixed(1);
            document.getElementById('f-elastic').textContent = F.toFixed(2);
            document.getElementById('energy').textContent = U.toFixed(4);
            document.getElementById('disp').textContent = state.x.toFixed(1);

            // Reset after one complete period for continuous oscillation
            if (state.time >= period * 2) {
                state.time = 0;
            }
            
            animFrame = requestAnimationFrame(animate);
        }

        function reset() {
            state.isPlaying = false;
            document.getElementById('play-btn').textContent = '‚ñ∂ Boshlash';
            cancelAnimationFrame(animFrame);
            state.time = 0;
            setParam('k', 50);
            setParam('x', 5);
            setParam('m', 1);
            setParam('spd', 1);
        }

        function exportData() {
            const xm = state.x / 100;
            const data = {
                bikrlik_koeffitsienti: state.k + ' N/m',
                chozilish: state.x + ' cm',
                massa: state.m + ' kg',
                elastik_kuch: (state.k * xm).toFixed(2) + ' N',
                potensial_energiya: (0.5 * state.k * xm * xm).toFixed(4) + ' J',
                ogirlik_kuchi: (state.m * 9.8).toFixed(2) + ' N',
                vaqt: new Date().toLocaleString('uz-UZ')
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `guk_qonuni_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function showTab(index) {
            document.querySelectorAll('.tab').forEach((t, i) => {
                t.classList.toggle('active', i === index);
            });
            document.querySelectorAll('.tab-content').forEach((c, i) => {
                c.classList.toggle('active', i === index);
            });
        }

        document.addEventListener('keydown', e => {
            if (e.key === ' ') { e.preventDefault(); togglePlay(); }
            if (e.key === 'r') reset();
            if (e.key === 'ArrowUp') setParam('x', Math.min(state.x + 0.5, 20));
            if (e.key === 'ArrowDown') setParam('x', Math.max(state.x - 0.5, 0));
            if (e.key === 'ArrowRight') setParam('k', Math.min(state.k + 5, 100));
            if (e.key === 'ArrowLeft') setParam('k', Math.max(state.k - 5, 10));
        });

        window.addEventListener('resize', () => setTimeout(drawGraph, 100));

        window.MathJax = {
            tex: {
                inlineMath: [[', ']],
                displayMath: [['$', '$']]
            }
        };

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
