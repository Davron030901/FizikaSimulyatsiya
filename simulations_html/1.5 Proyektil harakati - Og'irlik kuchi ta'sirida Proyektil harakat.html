<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyektil harakati - Og'irlik kuchi ta'sirida</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\\[','\\]']]}};</script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;color:#333;overflow-x:hidden}
        .container{max-width:1400px;margin:0 auto;padding:10px}
        header{background:rgba(255,255,255,.95);padding:15px 20px;margin-bottom:20px;border-radius:15px;box-shadow:0 8px 32px rgba(0,0,0,.1);text-align:center}
        h1{color:#2c3e50;margin-bottom:10px;font-size:clamp(1.5rem,4vw,2.5rem)}
        .subtitle{color:#7f8c8d;font-size:clamp(.9rem,2vw,1.1rem)}
        .main-content{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
        .panel{background:rgba(255,255,255,.95);border-radius:15px;padding:20px;box-shadow:0 8px 32px rgba(0,0,0,.1)}
        .simulation-panel{display:flex;flex-direction:column;align-items:center}
        .canvas-container{position:relative;width:100%;max-width:800px;height:500px;margin:15px 0}
        canvas{width:100%;height:100%;border:2px solid #3498db;border-radius:10px;background:linear-gradient(180deg,#87ceeb 0%,#98fb98 100%);cursor:crosshair}
        .controls-panel h3{color:#2c3e50;margin-bottom:15px;font-size:1.4rem}
        .control-group{margin-bottom:20px;padding:15px;background:rgba(52,152,219,.1);border-radius:10px;border-left:4px solid #3498db}
        .control-group label{display:block;margin-bottom:8px;font-weight:600;color:#2c3e50}
        .slider-container{display:flex;align-items:center;gap:10px;margin-bottom:10px}
        .slider{flex:1;height:6px;border-radius:3px;background:#ddd;outline:none;-webkit-appearance:none}
        .slider::-webkit-slider-thumb{appearance:none;width:20px;height:20px;border-radius:50%;background:#3498db;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,.2)}
        .slider::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:#3498db;cursor:pointer;border:none;box-shadow:0 2px 6px rgba(0,0,0,.2)}
        .value-display{min-width:80px;padding:5px 10px;background:#fff;border:1px solid #ddd;border-radius:5px;text-align:center;font-weight:600;color:#2c3e50}
        .btn{padding:10px 20px;border:none;border-radius:8px;font-size:1rem;cursor:pointer;transition:all .3s ease;font-weight:600;margin:5px}
        .btn-primary{background:#3498db;color:white}
        .btn-primary:hover{background:#2980b9;transform:translateY(-2px)}
        .btn-success{background:#27ae60;color:white}
        .btn-success:hover{background:#229954;transform:translateY(-2px)}
        .btn-warning{background:#f39c12;color:white}
        .btn-warning:hover{background:#e67e22;transform:translateY(-2px)}
        .btn-danger{background:#e74c3c;color:white}
        .btn-danger:hover{background:#c0392b;transform:translateY(-2px)}
        .control-buttons{display:flex;flex-wrap:wrap;justify-content:center;gap:10px;margin:15px 0}
        .presets{display:flex;flex-wrap:wrap;gap:10px;margin-top:15px}
        .preset-btn{padding:8px 15px;background:#9b59b6;color:white;border:none;border-radius:5px;cursor:pointer;font-size:.9rem;transition:all .3s ease}
        .preset-btn:hover{background:#8e44ad;transform:translateY(-2px)}
        .graphs-section{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:15px}
        .graph-container{background:rgba(255,255,255,.95);border-radius:15px;padding:15px;box-shadow:0 8px 32px rgba(0,0,0,.1)}
        .graph-title{color:#2c3e50;margin-bottom:15px;text-align:center;font-size:1.2rem}
        .graph-canvas{width:100%;height:250px;border:1px solid #ddd;border-radius:8px;background:#fff}
        .formulas-section{background:rgba(255,255,255,.95);border-radius:15px;padding:20px;margin-top:20px;box-shadow:0 8px 32px rgba(0,0,0,.1)}
        .formula-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-top:20px}
        .formula-card{background:rgba(52,152,219,.1);border-radius:10px;padding:15px;border-left:4px solid #3498db}
        .formula-title{color:#2c3e50;font-weight:600;margin-bottom:10px}
        .current-values{background:rgba(46,204,113,.1);border-radius:10px;padding:15px;margin-top:20px;border-left:4px solid #2ecc71}
        .values-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-top:10px}
        .value-item{background:#fff;padding:10px;border-radius:5px;text-align:center;border:1px solid #ddd}
        .value-label{font-size:.9rem;color:#7f8c8d;margin-bottom:5px}
        .value-number{font-size:1.2rem;font-weight:600;color:#2c3e50}
        .theory-section{background:rgba(255,255,255,.95);border-radius:15px;padding:15px;margin-top:15px;box-shadow:0 8px 32px rgba(0,0,0,.1)}
        .theory-toggle{background:#3498db;color:white;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-size:1rem;margin-bottom:15px}
        .theory-content{display:none;line-height:1.6}
        .theory-content.active{display:block}
        .trajectory-info{position:absolute;top:10px;right:10px;background:rgba(0,0,0,.7);color:white;padding:10px;border-radius:5px;font-size:.8rem;min-width:150px}
        .sensor-controls{background:rgba(155,89,182,.1);border-left:4px solid #9b59b6;padding:10px;border-radius:5px;margin-top:10px}
        .sensor-status{font-size:.9rem;color:#7f8c8d;margin-top:5px}
        .scale-controls{background:rgba(241,196,15,.1);border-left:4px solid #f1c40f;padding:10px;border-radius:5px;margin-top:10px}
        .checkbox-container{display:flex;align-items:center;gap:8px;margin-bottom:10px}
        .checkbox-container input[type="checkbox"]{width:18px;height:18px;accent-color:#3498db}
        .checkbox-container label{margin:0;font-size:.9rem;cursor:pointer}
        .adaptive-info{font-size:.8rem;color:#7f8c8d;margin-top:5px;font-style:italic}
        @media(max-width:768px){.main-content,.graphs-section,.formula-grid{grid-template-columns:1fr}.values-grid{grid-template-columns:1fr 1fr}.container{padding:5px}.panel{padding:15px}}
        @media(max-width:480px){.values-grid,.control-buttons{grid-template-columns:1fr}.control-buttons{flex-direction:column;align-items:center}.btn{width:100%;max-width:200px}}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>1.5 Proyektil harakati - Og'irlik kuchi ta'sirida</h1>
            <p class="subtitle">To'p otish simulyatsiyasi va parabolik harakat</p>
        </header>

        <div class="main-content">
            <div class="panel simulation-panel">
                <h3>Simulyatsiya</h3>
                <div class="canvas-container">
                    <canvas id="simulationCanvas" width="800" height="500"></canvas>
                    <div class="trajectory-info" id="trajectoryInfo">
                        <div>Maksimal balandlik: <span id="maxHeight">0</span> m</div>
                        <div>Maksimal masofa: <span id="maxRange">0</span> m</div>
                        <div>Uchish vaqti: <span id="flightTime">0</span> s</div>
                    </div>
                </div>
                <div class="control-buttons">
                    <button class="btn btn-success" id="fireBtn">üöÄ Otish</button>
                    <button class="btn btn-warning" id="pauseBtn">‚è∏ Pauza</button>
                    <button class="btn btn-danger" id="resetBtn">üîÑ Qayta boshlash</button>
                    <button class="btn btn-primary" id="clearBtn">üßπ Tozalash</button>
                </div>
            </div>

            <div class="panel controls-panel">
                <h3>Parametrlar</h3>
                
                <div class="control-group">
                    <label>Boshlang'ich tezlik (v‚ÇÄ):</label>
                    <div class="slider-container">
                        <input type="range" class="slider" id="v0Slider" min="10" max="100" step="1" value="50">
                        <span class="value-display" id="v0Value">50 m/s</span>
                    </div>
                </div>

                <div class="control-group">
                    <label>Otish burchagi (Œ∏):</label>
                    <div class="slider-container">
                        <input type="range" class="slider" id="thetaSlider" min="0" max="90" step="1" value="45">
                        <span class="value-display" id="thetaValue">45¬∞</span>
                    </div>
                </div>

                <div class="control-group">
                    <label>Og'irlik kuchi (g):</label>
                    <div class="slider-container">
                        <input type="range" class="slider" id="gSlider" min="5" max="15" step="0.1" value="9.8">
                        <span class="value-display" id="gValue">9.8 m/s¬≤</span>
                    </div>
                </div>

                <div class="control-group">
                    <label>Animatsiya tezligi:</label>
                    <div class="slider-container">
                        <input type="range" class="slider" id="speedSlider" min="0.1" max="3" step="0.1" value="1">
                        <span class="value-display" id="speedValue">1.0x</span>
                    </div>
                </div>

                <div class="control-group">
                    <label>Tayyor sozlamalar:</label>
                    <div class="presets">
                        <button class="preset-btn" onclick="setPreset(30,30)">30¬∞ 30m/s</button>
                        <button class="preset-btn" onclick="setPreset(45,50)">45¬∞ 50m/s</button>
                        <button class="preset-btn" onclick="setPreset(60,40)">60¬∞ 40m/s</button>
                        <button class="preset-btn" onclick="setPreset(75,60)">75¬∞ 60m/s</button>
                    </div>
                </div>

                <div class="control-group">
                    <label>Maydon moslashuvi:</label>
                    <div class="scale-controls">
                        <div class="checkbox-container">
                            <input type="checkbox" id="autoScaleCheck" checked>
                            <label for="autoScaleCheck">Avtomatik moslashish</label>
                        </div>
                        <div class="adaptive-info">Gorizontal masofa asosida avtomatik moslashadi</div>
                        <div class="slider-container">
                            <label>Qo'lda sozlash:</label>
                            <input type="range" class="slider" id="scaleSlider" min="0.1" max="30" step="0.1" value="2">
                            <span class="value-display" id="scaleValue">2.0x</span>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <label>Sensor boshqaruvi:</label>
                    <div class="sensor-controls">
                        <button class="btn btn-primary" id="sensorBtn" onclick="toggleSensor()">üì± Sensorni yoqish</button>
                        <div id="sensorStatus" class="sensor-status">Sensor: O'chiq</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="current-values">
            <h3>Hozirgi qiymatlar</h3>
            <div class="values-grid">
                <div class="value-item"><div class="value-label">Vaqt (t)</div><div class="value-number" id="currentTime">0.0 s</div></div>
                <div class="value-item"><div class="value-label">X pozitsiya</div><div class="value-number" id="currentX">0.0 m</div></div>
                <div class="value-item"><div class="value-label">Y pozitsiya</div><div class="value-number" id="currentY">0.0 m</div></div>
                <div class="value-item"><div class="value-label">X tezlik (v‚Çì)</div><div class="value-number" id="currentVx">0.0 m/s</div></div>
                <div class="value-item"><div class="value-label">Y tezlik (v·µß)</div><div class="value-number" id="currentVy">0.0 m/s</div></div>
                <div class="value-item"><div class="value-label">Umumiy tezlik (v)</div><div class="value-number" id="currentV">0.0 m/s</div></div>
            </div>
        </div>

        <div class="graphs-section">
            <div class="graph-container">
                <h3 class="graph-title">Tezlik komponentlari - Vaqt</h3>
                <canvas class="graph-canvas" id="velocityGraph" width="400" height="250"></canvas>
            </div>
            <div class="graph-container">
                <h3 class="graph-title">Balandlik - Vaqt grafigi</h3>
                <canvas class="graph-canvas" id="heightGraph" width="400" height="250"></canvas>
            </div>
        </div>

        <div class="formulas-section">
            <h3>Formulalar va tenglamalar</h3>
            <div class="formula-grid">
                <div class="formula-card"><div class="formula-title">Gorizontal harakat</div><div>$$x = v_0 \cos\theta \cdot t$$</div></div>
                <div class="formula-card"><div class="formula-title">Vertikal harakat</div><div>$$y = v_0 \sin\theta \cdot t - \frac{1}{2}gt^2$$</div></div>
                <div class="formula-card"><div class="formula-title">Maksimal balandlik</div><div>$$H = \frac{(v_0 \sin\theta)^2}{2g}$$</div></div>
                <div class="formula-card"><div class="formula-title">Maksimal masofa</div><div>$$R = \frac{v_0^2 \sin(2\theta)}{g}$$</div></div>
                <div class="formula-card"><div class="formula-title">Uchish vaqti</div><div>$$t = \frac{2v_0 \sin\theta}{g}$$</div></div>
                <div class="formula-card"><div class="formula-title">Tezlik komponentlari</div><div>$$v_x = v_0 \cos\theta$$</div><div>$$v_y = v_0 \sin\theta - gt$$</div></div>
            </div>
        </div>

        <div class="theory-section">
            <button class="theory-toggle" onclick="toggleTheory()">üìö Nazariy ma'lumotlar</button>
            <div class="theory-content" id="theoryContent">
                <h4>Proyektil harakati haqida</h4>
                <p>Proyektil harakati - bu og'irlik kuchi ta'sirida sodir bo'ladigan ikki o'lchovli harakat. Bu harakat gorizontal va vertikal komponentlarga bo'linadi.</p>
                <h4>Asosiy xususiyatlar:</h4>
                <ul>
                    <li><strong>Gorizontal harakat:</strong> Tekis harakat (tezlanish yo'q)</li>
                    <li><strong>Vertikal harakat:</strong> Tekis tezlanuvchan harakat (g = 9.8 m/s¬≤)</li>
                    <li><strong>Traektoriya:</strong> Parabola shakli</li>
                    <li><strong>Optimal burchak:</strong> 45¬∞ maksimal masofani beradi</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        let canvas,ctx,velocityCanvas,velocityCtx,heightCanvas,heightCtx,animationId,isPlaying=false,isPaused=false,currentTime=0,v0=50,theta=45,g=9.8,animationSpeed=1,scale=2,autoScale=true,projectiles=[],trajectoryPoints=[],deviceOrientation={alpha:0,beta:0,gamma:0},sensorEnabled=false,sensorSupported=false,timeData=[],vxData=[],vyData=[],heightData=[];
        
        class Projectile{constructor(v0,theta,g){this.v0=v0;this.theta=theta*Math.PI/180;this.g=g;this.startTime=Date.now();this.isActive=true;this.trail=[];this.vx=v0*Math.cos(this.theta);this.vy=v0*Math.sin(this.theta);this.maxHeight=(v0*Math.sin(this.theta))**2/(2*g);this.maxRange=(v0**2*Math.sin(2*this.theta))/g;this.flightTime=(2*v0*Math.sin(this.theta))/g}
        update(t){if(!this.isActive)return;this.x=this.vx*t;this.y=this.vy*t-0.5*this.g*t*t;this.currentVx=this.vx;this.currentVy=this.vy-this.g*t;this.currentV=Math.sqrt(this.currentVx**2+this.currentVy**2);this.trail.push({x:this.x,y:this.y});if(this.trail.length>100)this.trail.shift();if(this.y<=0&&t>0.1){this.isActive=false;this.y=0}return{x:this.x,y:this.y,vx:this.currentVx,vy:this.currentVy,v:this.currentV,t:t,active:this.isActive}}
        draw(ctx,w,h){const ml=25,mb=25,cx=ml+this.x*scale,cy=h-mb-this.y*scale;if(this.trail.length>1){ctx.beginPath();ctx.strokeStyle='rgba(231,76,60,0.6)';ctx.lineWidth=2;for(let i=1;i<this.trail.length;i++){const tx=ml+this.trail[i].x*scale,ty=h-mb-this.trail[i].y*scale;if(i===1)ctx.moveTo(ml+this.trail[0].x*scale,h-mb-this.trail[0].y*scale);ctx.lineTo(tx,ty)}ctx.stroke()}ctx.beginPath();ctx.arc(cx,cy,8,0,2*Math.PI);ctx.fillStyle=this.isActive?'#e74c3c':'#95a5a6';ctx.fill();if(this.isActive){const vs=3,vxp=this.currentVx*vs,vyp=-this.currentVy*vs;ctx.beginPath();ctx.moveTo(cx,cy);ctx.lineTo(cx+vxp,cy+vyp);ctx.strokeStyle='#27ae60';ctx.lineWidth=3;ctx.stroke();drawArrowHead(ctx,cx,cy,cx+vxp,cy+vyp,'#27ae60');ctx.fillStyle='#27ae60';ctx.font='bold 14px Arial';ctx.fillText('v',cx+vxp+5,cy+vyp-5);const gs=8,gl=this.g*gs;ctx.beginPath();ctx.moveTo(cx,cy);ctx.lineTo(cx,cy+gl);ctx.strokeStyle='#e74c3c';ctx.lineWidth=2;ctx.stroke();drawArrowHead(ctx,cx,cy,cx,cy+gl,'#e74c3c');ctx.fillStyle='#e74c3c';ctx.font='bold 14px Arial';ctx.fillText('g',cx+8,cy+gl/2)}}}
        
        function initCanvas(){canvas=document.getElementById('simulationCanvas');ctx=canvas.getContext('2d');velocityCanvas=document.getElementById('velocityGraph');velocityCtx=velocityCanvas.getContext('2d');heightCanvas=document.getElementById('heightGraph');heightCtx=heightCanvas.getContext('2d');resizeCanvas();drawSimulation();drawGraphs();updateTrajectoryInfo()}
        
        function resizeCanvas(){canvas.width=canvas.offsetWidth;canvas.height=canvas.offsetHeight;velocityCanvas.width=velocityCanvas.offsetWidth;velocityCanvas.height=velocityCanvas.offsetHeight;heightCanvas.width=heightCanvas.offsetWidth;heightCanvas.height=heightCanvas.offsetHeight;if(autoScale)updateScale()}
        
        function updateScale(){const tr=theta*Math.PI/180,mr=(v0**2*Math.sin(2*tr))/g,mh=(v0*Math.sin(tr))**2/(2*g),ml=25,mr2=30,mt=20,mb=25,aw=canvas.width-ml-mr2,ah=canvas.height-mt-mb,hs=aw/Math.max(mr*1.05,5),vs=ah/Math.max(mh*1.1,3);let os=Math.min(hs,vs);const ms=Math.min(aw/Math.max(mr*1.15,6),ah/Math.max(mh*1.25,3));os=Math.max(os,ms);scale=Math.max(0.1,Math.min(os,20));document.getElementById('scaleValue').textContent=scale.toFixed(1)+'x';document.getElementById('scaleSlider').value=scale}
        
        function drawSimulation(){ctx.clearRect(0,0,canvas.width,canvas.height);const mb=25;ctx.fillStyle='#8B4513';ctx.fillRect(0,canvas.height-mb,canvas.width,mb);ctx.fillStyle='#228B22';ctx.fillRect(0,canvas.height-mb-2,canvas.width,2);drawCannon();drawGrid();drawTrajectoryPrediction();projectiles.forEach(p=>p.draw(ctx,canvas.width,canvas.height));drawLabels();drawVectorLegend()}
        
        function drawCannon(){const cx=25,cy=canvas.height-25,ca=theta*Math.PI/180;ctx.save();ctx.translate(cx,cy);ctx.rotate(-ca);ctx.fillStyle='#34495e';ctx.fillRect(-25,-10,50,20);ctx.fillStyle='#2c3e50';ctx.fillRect(20,-4,30,8);ctx.restore()}
        
        function drawGrid(){const ml=25,mr=30,mt=20,mb=25,tr=theta*Math.PI/180,mxr=(v0**2*Math.sin(2*tr))/g,mh=(v0*Math.sin(tr))**2/(2*g),rs=Math.max(5,Math.round(mxr/8)),hs=Math.max(2,Math.round(mh/6));ctx.strokeStyle='rgba(0,0,0,0.12)';ctx.lineWidth=1;for(let d=0;d<=mxr*1.2;d+=rs){const x=ml+d*scale;if(x<canvas.width-mr){ctx.beginPath();ctx.moveTo(x,mt);ctx.lineTo(x,canvas.height-mb);ctx.stroke()}}ctx.strokeStyle='rgba(0,0,0,0.08)';for(let h=0;h<=mh*1.3;h+=hs){const y=canvas.height-mb-h*scale;if(y>mt){ctx.beginPath();ctx.moveTo(ml,y);ctx.lineTo(canvas.width-mr,y);ctx.stroke()}}}
        
        function drawTrajectoryPrediction(){const tr=theta*Math.PI/180,vx=v0*Math.cos(tr),vy=v0*Math.sin(tr),ft=(2*vy)/g,ml=25,mb=25;ctx.strokeStyle='rgba(52,152,219,0.7)';ctx.lineWidth=3;ctx.setLineDash([8,6]);ctx.beginPath();const ts=ft/50;for(let t=0;t<=ft;t+=ts){const x=vx*t,y=vy*t-0.5*g*t*t;if(y<0)break;const cx=ml+x*scale,cy=canvas.height-mb-y*scale;if(cx<canvas.width&&cy>0){if(t===0)ctx.moveTo(cx,cy);else ctx.lineTo(cx,cy)}}ctx.stroke();ctx.setLineDash([]);const ttm=vy/g,mhx=ml+(vx*ttm)*scale,mhy=canvas.height-mb-((vy*ttm-0.5*g*ttm*ttm))*scale;if(mhx<canvas.width&&mhy>0){ctx.beginPath();ctx.arc(mhx,mhy,6,0,2*Math.PI);ctx.fillStyle='rgba(52,152,219,0.8)';ctx.fill();ctx.strokeStyle='#3498db';ctx.lineWidth=2;ctx.stroke()}const lr=(v0**2*Math.sin(2*tr))/g,lx=ml+lr*scale,ly=canvas.height-mb;if(lx<canvas.width){ctx.beginPath();ctx.arc(lx,ly,6,0,2*Math.PI);ctx.fillStyle='rgba(231,76,60,0.8)';ctx.fill();ctx.strokeStyle='#e74c3c';ctx.lineWidth=2;ctx.stroke()}}
        
        function drawLabels(){const ml=25,mr=30,mt=20,mb=25,tr=theta*Math.PI/180,mxr=(v0**2*Math.sin(2*tr))/g,mh=(v0*Math.sin(tr))**2/(2*g),rs=Math.max(5,Math.round(mxr/8)),hs=Math.max(2,Math.round(mh/6));ctx.fillStyle='#2c3e50';ctx.font='11px Arial';ctx.fillText('0',ml-8,canvas.height-mb+15);for(let d=rs;d<=mxr*1.2;d+=rs){const x=ml+d*scale;if(x<canvas.width-mr)ctx.fillText(d+'m',x-8,canvas.height-mb+15)}for(let h=hs;h<=mh*1.3;h+=hs){const y=canvas.height-mb-h*scale;if(y>mt)ctx.fillText(h+'m',ml-20,y+3)}ctx.fillStyle='#e74c3c';ctx.font='bold 10px Arial';const mhy=canvas.height-mb-mh*scale;if(mhy>mt+20)ctx.fillText(`Maks: ${mh.toFixed(1)}m`,ml+10,mhy-5);const mxrx=ml+mxr*scale;if(mxrx<canvas.width-mr-80){ctx.fillStyle='#27ae60';ctx.font='bold 11px Arial';ctx.fillText(`Masofa: ${mxr.toFixed(1)}m`,mxrx-50,canvas.height-mb-10)}}
        
        function drawArrowHead(ctx,fx,fy,tx,ty,c){const hl=10,a=Math.atan2(ty-fy,tx-fx);ctx.beginPath();ctx.moveTo(tx,ty);ctx.lineTo(tx-hl*Math.cos(a-Math.PI/6),ty-hl*Math.sin(a-Math.PI/6));ctx.moveTo(tx,ty);ctx.lineTo(tx-hl*Math.cos(a+Math.PI/6),ty-hl*Math.sin(a+Math.PI/6));ctx.strokeStyle=c;ctx.lineWidth=2;ctx.stroke()}
        
        function drawVectorLegend(){const lx=canvas.width-150,ly=30;ctx.fillStyle='rgba(255,255,255,0.9)';ctx.fillRect(lx-10,ly-10,140,65);ctx.strokeStyle='rgba(0,0,0,0.2)';ctx.lineWidth=1;ctx.strokeRect(lx-10,ly-10,140,65);ctx.fillStyle='#2c3e50';ctx.font='bold 12px Arial';ctx.fillText('Vektorlar:',lx,ly+10);ctx.strokeStyle='#27ae60';ctx.lineWidth=3;ctx.beginPath();ctx.moveTo(lx,ly+25);ctx.lineTo(lx+25,ly+25);ctx.stroke();drawArrowHead(ctx,lx,ly+25,lx+25,ly+25,'#27ae60');ctx.fillStyle='#27ae60';ctx.font='11px Arial';ctx.fillText('v - tezlik',lx+30,ly+30);ctx.strokeStyle='#e74c3c';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(lx+5,ly+40);ctx.lineTo(lx+5,ly+55);ctx.stroke();drawArrowHead(ctx,lx+5,ly+40,lx+5,ly+55,'#e74c3c');ctx.fillStyle='#e74c3c';ctx.font='11px Arial';ctx.fillText('g - gravitatsiya',lx+15,ly+55)}
        
        function drawGraphs(){drawVelocityGraph();drawHeightGraph()}
        
        function drawVelocityGraph(){const c=velocityCtx,w=velocityCanvas.width,h=velocityCanvas.height;c.clearRect(0,0,w,h);c.strokeStyle='#2c3e50';c.lineWidth=2;c.beginPath();c.moveTo(50,h-30);c.lineTo(w-20,h-30);c.moveTo(50,h-30);c.lineTo(50,20);c.stroke();c.fillStyle='#2c3e50';c.font='12px Arial';c.fillText('t (s)',w-40,h-10);c.fillText('v (m/s)',5,15);c.strokeStyle='#ecf0f1';c.lineWidth=1;for(let i=1;i<=10;i++){const x=50+(i*(w-70)/10);c.beginPath();c.moveTo(x,h-30);c.lineTo(x,20);c.stroke();const y=20+(i*(h-50)/10);c.beginPath();c.moveTo(50,y);c.lineTo(w-20,y);c.stroke()}if(timeData.length>1){const mt=Math.max(...timeData,5),mv=Math.max(...vxData,...vyData,50);c.strokeStyle='#27ae60';c.lineWidth=3;c.beginPath();for(let i=0;i<timeData.length;i++){const x=50+(timeData[i]/mt)*(w-70),y=h-30-(vxData[i]/mv)*(h-50);if(i===0)c.moveTo(x,y);else c.lineTo(x,y)}c.stroke();c.strokeStyle='#e74c3c';c.lineWidth=3;c.beginPath();for(let i=0;i<timeData.length;i++){const x=50+(timeData[i]/mt)*(w-70),y=h-30-((vyData[i]+mv/2)/mv)*(h-50);if(i===0)c.moveTo(x,y);else c.lineTo(x,y)}c.stroke()}c.fillStyle='#27ae60';c.fillText('vx',w-60,30);c.fillStyle='#e74c3c';c.fillText('vy',w-60,45)}
        
        function drawHeightGraph(){const c=heightCtx,w=heightCanvas.width,h=heightCanvas.height;c.clearRect(0,0,w,h);c.strokeStyle='#2c3e50';c.lineWidth=2;c.beginPath();c.moveTo(50,h-30);c.lineTo(w-20,h-30);c.moveTo(50,h-30);c.lineTo(50,20);c.stroke();c.fillStyle='#2c3e50';c.font='12px Arial';c.fillText('t (s)',w-40,h-10);c.fillText('y (m)',5,15);c.strokeStyle='#ecf0f1';c.lineWidth=1;for(let i=1;i<=10;i++){const x=50+(i*(w-70)/10);c.beginPath();c.moveTo(x,h-30);c.lineTo(x,20);c.stroke();const y=20+(i*(h-50)/10);c.beginPath();c.moveTo(50,y);c.lineTo(w-20,y);c.stroke()}if(timeData.length>1){const mt=Math.max(...timeData,5),mh=Math.max(...heightData,50);c.strokeStyle='#3498db';c.lineWidth=3;c.beginPath();for(let i=0;i<timeData.length;i++){const x=50+(timeData[i]/mt)*(w-70),y=h-30-(heightData[i]/mh)*(h-50);if(i===0)c.moveTo(x,y);else c.lineTo(x,y)}c.stroke()}}
        
        function animate(){if(!isPlaying||isPaused)return;currentTime+=0.02*animationSpeed;projectiles.forEach(p=>{const d=p.update(currentTime);if(d){updateDisplayValues(d);timeData.push(d.t);vxData.push(d.vx);vyData.push(d.vy);heightData.push(Math.max(0,d.y));if(timeData.length>200){timeData.shift();vxData.shift();vyData.shift();heightData.shift()}}});projectiles=projectiles.filter(p=>p.isActive||currentTime<p.flightTime+2);drawSimulation();drawGraphs();animationId=requestAnimationFrame(animate)}
        
        function updateDisplayValues(d){document.getElementById('currentTime').textContent=d.t.toFixed(2)+' s';document.getElementById('currentX').textContent=d.x.toFixed(1)+' m';document.getElementById('currentY').textContent=Math.max(0,d.y).toFixed(1)+' m';document.getElementById('currentVx').textContent=d.vx.toFixed(1)+' m/s';document.getElementById('currentVy').textContent=d.vy.toFixed(1)+' m/s';document.getElementById('currentV').textContent=d.v.toFixed(1)+' m/s'}
        
        function updateTrajectoryInfo(){const tr=theta*Math.PI/180,mh=(v0*Math.sin(tr))**2/(2*g),mr=(v0**2*Math.sin(2*tr))/g,ft=(2*v0*Math.sin(tr))/g;document.getElementById('maxHeight').textContent=mh.toFixed(1);document.getElementById('maxRange').textContent=mr.toFixed(1);document.getElementById('flightTime').textContent=ft.toFixed(2)}
        
        function fireProjectile(){if(isPlaying&&!isPaused)return;const p=new Projectile(v0,theta,g);projectiles.push(p);timeData=[];vxData=[];vyData=[];heightData=[];currentTime=0;isPlaying=true;isPaused=false;animate()}
        
        function pauseAnimation(){isPaused=!isPaused;if(!isPaused&&isPlaying)animate()}
        
        function resetAnimation(){isPlaying=false;isPaused=false;currentTime=0;projectiles=[];trajectoryPoints=[];timeData=[];vxData=[];vyData=[];heightData=[];cancelAnimationFrame(animationId);drawSimulation();drawGraphs();document.getElementById('currentTime').textContent='0.0 s';document.getElementById('currentX').textContent='0.0 m';document.getElementById('currentY').textContent='0.0 m';document.getElementById('currentVx').textContent='0.0 m/s';document.getElementById('currentVy').textContent='0.0 m/s';document.getElementById('currentV').textContent='0.0 m/s'}
        
        function clearTrajectories(){projectiles=[];trajectoryPoints=[];drawSimulation()}
        
        function updateParameters(){v0=parseFloat(document.getElementById('v0Slider').value);theta=parseFloat(document.getElementById('thetaSlider').value);g=parseFloat(document.getElementById('gSlider').value);animationSpeed=parseFloat(document.getElementById('speedSlider').value);autoScale=document.getElementById('autoScaleCheck').checked;if(!autoScale)scale=parseFloat(document.getElementById('scaleSlider').value);document.getElementById('v0Value').textContent=v0.toFixed(0)+' m/s';document.getElementById('thetaValue').textContent=theta.toFixed(0)+'¬∞';document.getElementById('gValue').textContent=g.toFixed(1)+' m/s¬≤';document.getElementById('speedValue').textContent=animationSpeed.toFixed(1)+'x';if(autoScale)updateScale();else document.getElementById('scaleValue').textContent=scale.toFixed(1)+'x';updateTrajectoryInfo();if(!isPlaying)drawSimulation()}
        
        function initSensors(){if('DeviceOrientationEvent'in window){sensorSupported=true;document.getElementById('sensorBtn').style.display='block';if(typeof DeviceOrientationEvent.requestPermission==='function'){DeviceOrientationEvent.requestPermission().then(r=>{if(r==='granted')setupSensorListeners()}).catch(console.error)}else setupSensorListeners()}else{document.getElementById('sensorBtn').style.display='none';document.getElementById('sensorStatus').textContent='Sensor: Qo\'llab-quvvatlanmaydi'}}
        
        function setupSensorListeners(){window.addEventListener('deviceorientation',handleOrientation)}
        
        function handleOrientation(e){if(!sensorEnabled)return;deviceOrientation.alpha=e.alpha||0;deviceOrientation.beta=e.beta||0;deviceOrientation.gamma=e.gamma||0;let nt=Math.max(0,Math.min(90,45+deviceOrientation.gamma)),vm=1+(deviceOrientation.beta/180);vm=Math.max(0.3,Math.min(2,vm));let nv=50*vm;theta=nt;v0=Math.max(10,Math.min(100,nv));document.getElementById('thetaSlider').value=theta;document.getElementById('v0Slider').value=v0;updateParameters();document.getElementById('sensorStatus').innerHTML=`Sensor: Yoqilgan<br>Burchak: ${theta.toFixed(1)}¬∞<br>Tezlik: ${v0.toFixed(1)} m/s`}
        
        function toggleSensor(){if(!sensorSupported){alert('Sensor qo\'llab-quvvatlanmaydi');return}sensorEnabled=!sensorEnabled;const b=document.getElementById('sensorBtn'),s=document.getElementById('sensorStatus');if(sensorEnabled){b.textContent='üì± Sensorni o\'chirish';b.classList.remove('btn-primary');b.classList.add('btn-success');s.textContent='Sensor: Yoqilgan';if(typeof DeviceOrientationEvent.requestPermission==='function'){DeviceOrientationEvent.requestPermission().then(r=>{if(r!=='granted'){sensorEnabled=false;b.textContent='üì± Sensorni yoqish';b.classList.remove('btn-success');b.classList.add('btn-primary');s.textContent='Sensor: Ruxsat berilmagan'}}).catch(console.error)}}else{b.textContent='üì± Sensorni yoqish';b.classList.remove('btn-success');b.classList.add('btn-primary');s.textContent='Sensor: O\'chiq'}}
        
        function setPreset(a,v){theta=a;v0=v;document.getElementById('thetaSlider').value=a;document.getElementById('v0Slider').value=v;updateParameters()}
        
        function toggleTheory(){document.getElementById('theoryContent').classList.toggle('active')}
        
        function setupEventListeners(){document.getElementById('fireBtn').addEventListener('click',fireProjectile);document.getElementById('pauseBtn').addEventListener('click',pauseAnimation);document.getElementById('resetBtn').addEventListener('click',resetAnimation);document.getElementById('clearBtn').addEventListener('click',clearTrajectories);document.getElementById('v0Slider').addEventListener('input',updateParameters);document.getElementById('thetaSlider').addEventListener('input',updateParameters);document.getElementById('gSlider').addEventListener('input',updateParameters);document.getElementById('speedSlider').addEventListener('input',updateParameters);document.getElementById('scaleSlider').addEventListener('input',updateParameters);document.getElementById('autoScaleCheck').addEventListener('change',updateParameters);window.addEventListener('resize',()=>{resizeCanvas();drawSimulation();drawGraphs()});initSensors()}
        
        window.addEventListener('load',()=>{initCanvas();setupEventListeners();updateParameters();if(window.MathJax)MathJax.typesetPromise()});
        
        let touchStartX=0,touchStartY=0;canvas.addEventListener('touchstart',e=>{if(sensorEnabled)return;const t=e.touches[0];touchStartX=t.clientX;touchStartY=t.clientY});canvas.addEventListener('touchmove',e=>{if(sensorEnabled)return;e.preventDefault();const t=e.touches[0],dx=t.clientX-touchStartX,dy=t.clientY-touchStartY;if(Math.abs(dx)>Math.abs(dy)){const nv=v0+dx*0.1;if(nv>=10&&nv<=100){v0=nv;document.getElementById('v0Slider').value=v0;updateParameters()}}else{const nt=theta-dy*0.1;if(nt>=0&&nt<=90){theta=nt;document.getElementById('thetaSlider').value=theta;updateParameters()}}touchStartX=t.clientX;touchStartY=t.clientY});
        
        function vibrate(d=50){if('vibrate'in navigator)navigator.vibrate(d)}
        
        document.addEventListener('click',e=>{if(e.target.classList.contains('btn'))vibrate(30)});
        
        document.addEventListener('keydown',e=>{switch(e.key){case' ':e.preventDefault();fireProjectile();break;case'p':case'P':pauseAnimation();break;case'r':case'R':resetAnimation();break;case'c':case'C':clearTrajectories();break;case'ArrowUp':e.preventDefault();if(theta<90){theta+=1;document.getElementById('thetaSlider').value=theta;updateParameters()}break;case'ArrowDown':e.preventDefault();if(theta>0){theta-=1;document.getElementById('thetaSlider').value=theta;updateParameters()}break;case'ArrowLeft':e.preventDefault();if(v0>10){v0-=1;document.getElementById('v0Slider').value=v0;updateParameters()}break;case'ArrowRight':e.preventDefault();if(v0<100){v0+=1;document.getElementById('v0Slider').value=v0;updateParameters()}break}});
    </script>
</body>
</html>
