<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Aylanadigan Jism - Universal</title>
    <style>
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        body { 
            margin: 0; 
            padding: 0; 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            overflow: hidden; 
            touch-action: none; 
        }
        #container { 
            width: 100vw; 
            height: 100vh; 
            position: relative; 
        }
        #controls { 
            position: absolute; 
            top: 10px; 
            right: 10px; 
            z-index: 100; 
            background: rgba(255,255,255,0.95); 
            padding: 12px; 
            border-radius: 10px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); 
            width: 180px; 
            max-height: 85vh; 
            overflow-y: auto; 
        }
        button { 
            background: #4CAF50; 
            color: white; 
            border: none; 
            padding: 12px 8px; 
            margin: 3px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 13px; 
            transition: all 0.2s; 
            width: calc(50% - 6px); 
            touch-action: manipulation; 
        }
        button:hover { background: #45a049; }
        button:active { 
            background: #45a049; 
            transform: scale(0.95); 
        }
        button.active { background: #FF6B6B; }
        #info { 
            position: absolute; 
            bottom: 10px; 
            left: 10px; 
            color: white; 
            background: rgba(0,0,0,0.8); 
            padding: 8px 12px; 
            border-radius: 8px; 
            font-size: 12px; 
            max-width: calc(100% - 210px); 
        }
        h3 { 
            margin: 8px 0 5px 0; 
            font-size: 15px; 
            text-align: center;
        }
        h4 { 
            margin: 10px 0 5px 0; 
            font-size: 13px; 
        }
        select { 
            width: 100%; 
            padding: 10px; 
            border-radius: 8px; 
            border: 1px solid #ccc; 
            font-size: 13px; 
            margin-bottom: 8px; 
            touch-action: manipulation; 
        }
        #colorPalette { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 8px; 
            margin-top: 5px; 
        }
        .color-btn { 
            width: 45px; 
            height: 45px; 
            border-radius: 50%; 
            cursor: pointer; 
            border: 3px solid white; 
            transition: transform 0.2s; 
            touch-action: manipulation;
            margin: 0 auto;
        }
        .color-btn:hover { transform: scale(1.1); }
        .color-btn:active { transform: scale(0.9); }
        
        /* Desktop optimizatsiyasi */
        @media (min-width: 769px) {
            #container { 
                width: 100%; 
                height: 90vh; 
                margin: 20px auto;
                max-width: 1400px;
                border-radius: 15px;
                box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            }
            body {
                padding: 10px;
                overflow-y: auto;
            }
            #controls { 
                width: 200px; 
                padding: 15px;
                top: 20px;
                right: 20px;
            }
            #info {
                bottom: 20px;
                left: 20px;
                font-size: 13px;
            }
            button {
                font-size: 14px;
                padding: 10px;
            }
            h3 { font-size: 16px; }
            h4 { font-size: 14px; }
            select { 
                font-size: 14px;
                padding: 8px;
            }
        }
        
        /* Mobil optimizatsiyasi */
        @media (max-width: 480px) {
            #controls { 
                width: 150px; 
                padding: 10px; 
                top: 5px; 
                right: 5px;
                max-height: 80vh;
            }
            button { 
                font-size: 11px; 
                padding: 10px 6px; 
            }
            h3 { font-size: 14px; }
            h4 { font-size: 12px; }
            select { 
                font-size: 12px; 
                padding: 8px; 
            }
            #info { 
                font-size: 10px; 
                padding: 6px 10px; 
                bottom: 5px; 
                left: 5px; 
                max-width: calc(100% - 170px); 
            }
            .color-btn { 
                width: 38px; 
                height: 38px; 
            }
        }
        
        /* Tablet optimizatsiyasi */
        @media (min-width: 481px) and (max-width: 768px) {
            #controls { 
                width: 170px; 
            }
            button { 
                font-size: 12px; 
            }
            .color-btn { 
                width: 42px; 
                height: 42px; 
            }
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <div id="controls">
        <h3>Boshqaruv</h3>
        <button id="startRotation">Aylanish</button>
        <button id="stopRotation">To'xtat</button>
        <button id="resetView" style="width: calc(50% - 6px);">Reset</button>
        <button id="changeColor" style="width: calc(50% - 6px);">Rang</button>
        <h4>Shakl:</h4>
        <select id="shapeSelector">
            <option value="0">Kub</option>
            <option value="1">Shar</option>
            <option value="2">Silindr</option>
            <option value="3">Torus</option>
            <option value="4">Konus</option>
            <option value="5">Oktaedr</option>
            <option value="6">Dodekaedr</option>
            <option value="7">Ikosaedr</option>
            <option value="8">Tetraedr</option>
            <option value="9">Disk</option>
            <option value="10">Piramida</option>
            <option value="11">Prizma</option>
            <option value="12">Yulduz</option>
            <option value="13">Olmos</option>
        </select>
        <h4>Rang:</h4>
        <div id="colorPalette">
            <div class="color-btn" data-color="0" style="background: #4CAF50; border: 3px solid black;"></div>
            <div class="color-btn" data-color="1" style="background: #FF6B6B;"></div>
            <div class="color-btn" data-color="2" style="background: #3498DB;"></div>
            <div class="color-btn" data-color="3" style="background: #F39C12;"></div>
            <div class="color-btn" data-color="4" style="background: #9B59B6;"></div>
            <div class="color-btn" data-color="5" style="background: #E74C3C;"></div>
        </div>
    </div>
    <div id="info">
        <div id="controlHint">Barmoq/sichqoncha bilan aylantiring</div>
        <div id="zoomHint">Pinch/scroll qiling</div>
        <div><span id="rotationStatus">To'xtatilgan</span></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, cube, isRotating = false, currentShape = 0, currentColor = 0;
        const shapes = ['cube', 'sphere', 'cylinder', 'torus', 'cone', 'octahedron', 'dodecahedron', 'icosahedron', 'tetrahedron', 'ring', 'pyramid', 'prism', 'star', 'diamond'];
        const colors = [0x4CAF50, 0xFF6B6B, 0x3498DB, 0xF39C12, 0x9B59B6, 0xE74C3C];
        
        // Qurilma turini aniqlash
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        
        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x222222);
            
            const container = document.getElementById('container');
            const aspect = container.clientWidth / container.clientHeight;
            camera = new THREE.PerspectiveCamera(75, aspect, 0.1, 1000);
            camera.position.set(5, 5, 5);
            camera.lookAt(0, 0, 0);
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);
            
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            const pointLight = new THREE.PointLight(0x00ff00, 0.5, 100);
            pointLight.position.set(-10, 10, -10);
            scene.add(pointLight);
            
            createShape();
            
            const plane = new THREE.Mesh(
                new THREE.PlaneGeometry(20, 20), 
                new THREE.MeshLambertMaterial({ color: 0x333333 })
            );
            plane.rotation.x = -Math.PI / 2;
            plane.position.y = -3;
            plane.receiveShadow = true;
            scene.add(plane);
            
            setupControls();
            setupInputControls();
            updateHints();
            animate();
            
            window.addEventListener('resize', onWindowResize);
        }
        
        function createShape() {
            if (cube) scene.remove(cube);
            let geometry;
            switch(shapes[currentShape]) {
                case 'cube': geometry = new THREE.BoxGeometry(2, 2, 2); break;
                case 'sphere': geometry = new THREE.SphereGeometry(1.5, 32, 32); break;
                case 'cylinder': geometry = new THREE.CylinderGeometry(1, 1, 3, 32); break;
                case 'torus': geometry = new THREE.TorusGeometry(1.5, 0.5, 16, 100); break;
                case 'cone': geometry = new THREE.ConeGeometry(1.5, 3, 32); break;
                case 'octahedron': geometry = new THREE.OctahedronGeometry(1.8); break;
                case 'dodecahedron': geometry = new THREE.DodecahedronGeometry(1.5); break;
                case 'icosahedron': geometry = new THREE.IcosahedronGeometry(1.6); break;
                case 'tetrahedron': geometry = new THREE.TetrahedronGeometry(2); break;
                case 'ring': geometry = new THREE.RingGeometry(0.5, 2, 32); break;
                case 'pyramid': geometry = new THREE.ConeGeometry(2, 3, 4); break;
                case 'prism': geometry = new THREE.CylinderGeometry(1.5, 1.5, 2, 6); break;
                case 'star':
                    const starShape = new THREE.Shape();
                    for (let i = 0; i < 10; i++) {
                        const angle = (i / 10) * Math.PI * 2;
                        const radius = i % 2 === 0 ? 2 : 1;
                        const x = Math.cos(angle) * radius;
                        const y = Math.sin(angle) * radius;
                        if (i === 0) starShape.moveTo(x, y);
                        else starShape.lineTo(x, y);
                    }
                    starShape.closePath();
                    geometry = new THREE.ExtrudeGeometry(starShape, { depth: 0.5, bevelEnabled: false });
                    break;
                case 'diamond':
                    const top = new THREE.ConeGeometry(1.5, 2, 8);
                    const bottom = new THREE.ConeGeometry(1.5, 1, 8);
                    bottom.rotateX(Math.PI);
                    bottom.translate(0, -1, 0);
                    geometry = top;
                    break;
                default: geometry = new THREE.BoxGeometry(2, 2, 2);
            }
            const material = new THREE.MeshPhongMaterial({ 
                color: colors[currentColor], 
                shininess: 100, 
                specular: 0x222222 
            });
            cube = new THREE.Mesh(geometry, material);
            cube.castShadow = true;
            cube.receiveShadow = true;
            scene.add(cube);
        }
        
        function setupInputControls() {
            let isDragging = false, startX = 0, startY = 0;
            let lastDist = 0;
            
            const handleStart = (e) => {
                if (e.touches && e.touches.length === 2) {
                    const dx = e.touches[0].clientX - e.touches[1].clientX;
                    const dy = e.touches[0].clientY - e.touches[1].clientY;
                    lastDist = Math.sqrt(dx * dx + dy * dy);
                } else {
                    isDragging = true;
                    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                    startX = clientX;
                    startY = clientY;
                }
            };
            
            const handleMove = (e) => {
                if (e.touches && e.touches.length === 2) {
                    e.preventDefault();
                    const dx = e.touches[0].clientX - e.touches[1].clientX;
                    const dy = e.touches[0].clientY - e.touches[1].clientY;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (lastDist > 0) {
                        const scale = lastDist / dist;
                        camera.position.multiplyScalar(scale);
                        camera.position.clampLength(3, 20);
                    }
                    lastDist = dist;
                } else if (isDragging) {
                    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                    const deltaX = clientX - startX;
                    const deltaY = clientY - startY;
                    cube.rotation.y += deltaX * 0.01;
                    cube.rotation.x += deltaY * 0.01;
                    startX = clientX;
                    startY = clientY;
                }
            };
            
            const handleEnd = () => {
                isDragging = false;
                lastDist = 0;
            };
            
            // Touch events
            renderer.domElement.addEventListener('touchstart', handleStart, { passive: false });
            renderer.domElement.addEventListener('touchmove', handleMove, { passive: false });
            renderer.domElement.addEventListener('touchend', handleEnd);
            
            // Mouse events
            renderer.domElement.addEventListener('mousedown', handleStart);
            renderer.domElement.addEventListener('mousemove', handleMove);
            renderer.domElement.addEventListener('mouseup', handleEnd);
            renderer.domElement.addEventListener('mouseleave', handleEnd);
            
            // Wheel for desktop
            renderer.domElement.addEventListener('wheel', (e) => {
                e.preventDefault();
                const scale = e.deltaY > 0 ? 1.1 : 0.9;
                camera.position.multiplyScalar(scale);
                camera.position.clampLength(3, 20);
            }, { passive: false });
        }
        
        function setupControls() {
            document.getElementById('startRotation').addEventListener('click', () => {
                isRotating = true;
                document.getElementById('rotationStatus').textContent = 'Aylanmoqda';
                document.getElementById('startRotation').classList.add('active');
                document.getElementById('stopRotation').classList.remove('active');
            });
            
            document.getElementById('stopRotation').addEventListener('click', () => {
                isRotating = false;
                document.getElementById('rotationStatus').textContent = "To'xtatilgan";
                document.getElementById('stopRotation').classList.add('active');
                document.getElementById('startRotation').classList.remove('active');
            });
            
            document.getElementById('resetView').addEventListener('click', () => {
                camera.position.set(5, 5, 5);
                camera.lookAt(0, 0, 0);
                cube.rotation.set(0, 0, 0);
            });
            
            document.getElementById('shapeSelector').addEventListener('change', (e) => {
                currentShape = parseInt(e.target.value);
                createShape();
            });
            
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.color-btn').forEach(b => b.style.border = '3px solid white');
                    btn.style.border = '3px solid black';
                    currentColor = parseInt(btn.dataset.color);
                    createShape();
                });
            });
            
            document.getElementById('changeColor').addEventListener('click', () => {
                currentColor = (currentColor + 1) % colors.length;
                createShape();
                document.querySelectorAll('.color-btn').forEach(btn => {
                    btn.style.border = parseInt(btn.dataset.color) === currentColor ? '3px solid black' : '3px solid white';
                });
            });
        }
        
        function updateHints() {
            if (isTouchDevice) {
                document.getElementById('controlHint').textContent = 'Barmoq bilan aylantiring';
                document.getElementById('zoomHint').textContent = 'Pinch qilib zoom qiling';
            } else {
                document.getElementById('controlHint').textContent = 'Sichqoncha bilan aylantiring';
                document.getElementById('zoomHint').textContent = 'Scroll qilib zoom qiling';
            }
        }
        
        function animate() {
            requestAnimationFrame(animate);
            if (isRotating && cube) {
                cube.rotation.x += 0.01;
                cube.rotation.y += 0.01;
                cube.rotation.z += 0.005;
            }
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            const container = document.getElementById('container');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
        }
        
        init();
    </script>
</body>
</html>
