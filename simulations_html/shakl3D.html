<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Aylanadigan Jism</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow-x: auto;
        }
        #container {
            width: 100%;
            height: 80vh;
            min-height: 600px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            overflow: hidden;
            position: relative;
        }
        #controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(255,255,255,0.95);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            width: 200px;
            max-height: 60vh;
            overflow-y: auto;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        button:hover {
            background: #45a049;
        }
        button.active {
            background: #FF6B6B;
        }
        #info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    
    <div id="controls">
        <h3 style="margin-top: 0; font-size: 16px;">Boshqaruv</h3>
        <button id="startRotation" style="font-size: 12px; padding: 8px 10px;">Aylanish</button>
        <button id="stopRotation" style="font-size: 12px; padding: 8px 10px;">To'xtat</button>
        <br>
        <button id="resetView" style="font-size: 12px; padding: 8px 10px; margin-top: 5px;">Reset</button>
        <button id="changeColor" style="font-size: 12px; padding: 8px 10px; margin-top: 5px;">Rang</button>
        
        <div style="margin-top: 12px;">
            <h4 style="margin: 0 0 5px 0; font-size: 14px;">Shakl:</h4>
            <select id="shapeSelector" style="width: 100%; padding: 6px; border-radius: 5px; border: 1px solid #ccc; font-size: 12px;">
                <option value="0">Kub</option>
                <option value="1">Shar</option>
                <option value="2">Silindr</option>
                <option value="3">Torus</option>
                <option value="4">Konus</option>
                <option value="5">Oktaedr</option>
                <option value="6">Dodekaedr</option>
                <option value="7">Ikosaedr</option>
                <option value="8">Tetraedr</option>
                <option value="9">Disk</option>
                <option value="10">Kapsula</option>
                <option value="11">Piramida</option>
                <option value="12">Prizma</option>
                <option value="13">Yulduz</option>
                <option value="14">Olmos</option>
            </select>
        </div>
        
        <div style="margin-top: 12px;">
            <h4 style="margin: 0 0 5px 0; font-size: 14px;">Rang:</h4>
            <div id="colorPalette" style="display: flex; flex-wrap: wrap; gap: 4px; justify-content: center;">
                <div class="color-btn" data-color="0" style="width: 22px; height: 22px; background: #4CAF50; border-radius: 50%; cursor: pointer; border: 2px solid white;"></div>
                <div class="color-btn" data-color="1" style="width: 22px; height: 22px; background: #FF6B6B; border-radius: 50%; cursor: pointer; border: 2px solid white;"></div>
                <div class="color-btn" data-color="2" style="width: 22px; height: 22px; background: #3498DB; border-radius: 50%; cursor: pointer; border: 2px solid white;"></div>
                <div class="color-btn" data-color="3" style="width: 22px; height: 22px; background: #F39C12; border-radius: 50%; cursor: pointer; border: 2px solid white;"></div>
                <div class="color-btn" data-color="4" style="width: 22px; height: 22px; background: #9B59B6; border-radius: 50%; cursor: pointer; border: 2px solid white;"></div>
                <div class="color-btn" data-color="5" style="width: 22px; height: 22px; background: #E74C3C; border-radius: 50%; cursor: pointer; border: 2px solid white;"></div>
            </div>
        </div>
    </div>

    <div id="info">
        <div>Sichqoncha bilan aylantirishingiz mumkin</div>
        <div>Scroll qilib yaqinlashtiring/uzoqlashtiring</div>
        <div>Aylanish: <span id="rotationStatus">To'xtatilgan</span></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, cube, controls;
        let isRotating = false;
        let currentShape = 0;
        let currentColor = 0;
        
        const shapes = ['cube', 'sphere', 'cylinder', 'torus', 'cone', 'octahedron', 'dodecahedron', 'icosahedron', 'tetrahedron', 'ring', 'capsule', 'pyramid', 'prism', 'star', 'diamond'];
        const colors = [0x4CAF50, 0xFF6B6B, 0x3498DB, 0xF39C12, 0x9B59B6, 0xE74C3C];
        
        function init() {
            // Scene yaratish
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x222222);
            
            // Kamera sozlash - kengroq ko'rinish uchun
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(5, 5, 5);
            camera.lookAt(0, 0, 0);
            
            // Renderer yaratish - katta o'lcham
            renderer = new THREE.WebGLRenderer({ antialias: true });
            const container = document.getElementById('container');
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);
            
            // Yorug'lik qo'shish
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);
            
            // Nuqta yorug'lik qo'shish
            const pointLight = new THREE.PointLight(0x00ff00, 0.5, 100);
            pointLight.position.set(-10, 10, -10);
            scene.add(pointLight);
            
            // Jism yaratish
            createShape();
            
            // Pol qo'shish
            const planeGeometry = new THREE.PlaneGeometry(20, 20);
            const planeMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
            const plane = new THREE.Mesh(planeGeometry, planeMaterial);
            plane.rotation.x = -Math.PI / 2;
            plane.position.y = -3;
            plane.receiveShadow = true;
            scene.add(plane);
            
            // Sichqoncha boshqaruvi
            setupMouseControls();
            
            // Tugmalar hodisalari
            setupControls();
            
            // Animatsiya boshlash
            animate();
            
            // Responsive qilish
            window.addEventListener('resize', onWindowResize);
        }
        
        function createShape() {
            // Oldingi jismni o'chirish
            if (cube) {
                scene.remove(cube);
            }
            
            let geometry;
            switch(shapes[currentShape]) {
                case 'cube':
                    geometry = new THREE.BoxGeometry(2, 2, 2);
                    break;
                case 'sphere':
                    geometry = new THREE.SphereGeometry(1.5, 32, 32);
                    break;
                case 'cylinder':
                    geometry = new THREE.CylinderGeometry(1, 1, 3, 32);
                    break;
                case 'torus':
                    geometry = new THREE.TorusGeometry(1.5, 0.5, 16, 100);
                    break;
                case 'cone':
                    geometry = new THREE.ConeGeometry(1.5, 3, 32);
                    break;
                case 'octahedron':
                    geometry = new THREE.OctahedronGeometry(1.8);
                    break;
                case 'dodecahedron':
                    geometry = new THREE.DodecahedronGeometry(1.5);
                    break;
                case 'icosahedron':
                    geometry = new THREE.IcosahedronGeometry(1.6);
                    break;
                case 'tetrahedron':
                    geometry = new THREE.TetrahedronGeometry(2);
                    break;
                case 'ring':
                    geometry = new THREE.RingGeometry(0.5, 2, 32);
                    break;
                case 'capsule':
                    geometry = new THREE.CylinderGeometry(1, 1, 2, 32);
                    const sphereTop = new THREE.SphereGeometry(1, 32, 16, 0, Math.PI * 2, 0, Math.PI / 2);
                    sphereTop.translate(0, 1, 0);
                    const sphereBottom = new THREE.SphereGeometry(1, 32, 16, 0, Math.PI * 2, Math.PI / 2, Math.PI / 2);
                    sphereBottom.translate(0, -1, 0);
                    geometry = THREE.BufferGeometryUtils ? 
                        THREE.BufferGeometryUtils.mergeBufferGeometries([geometry, sphereTop, sphereBottom]) : 
                        geometry;
                    break;
                case 'pyramid':
                    geometry = new THREE.ConeGeometry(2, 3, 4);
                    break;
                case 'prism':
                    geometry = new THREE.CylinderGeometry(1.5, 1.5, 2, 6);
                    break;
                case 'star':
                    // Yulduz shakli uchun maxsus geometriya
                    const starShape = new THREE.Shape();
                    const outerRadius = 2;
                    const innerRadius = 1;
                    const spikes = 5;
                    for (let i = 0; i < spikes * 2; i++) {
                        const angle = (i / (spikes * 2)) * Math.PI * 2;
                        const radius = i % 2 === 0 ? outerRadius : innerRadius;
                        const x = Math.cos(angle) * radius;
                        const y = Math.sin(angle) * radius;
                        if (i === 0) starShape.moveTo(x, y);
                        else starShape.lineTo(x, y);
                    }
                    starShape.closePath();
                    geometry = new THREE.ExtrudeGeometry(starShape, { depth: 0.5, bevelEnabled: false });
                    break;
                case 'diamond':
                    const diamondGeometry = new THREE.ConeGeometry(1.5, 2, 8);
                    const diamondBottom = new THREE.ConeGeometry(1.5, 1, 8);
                    diamondBottom.rotateX(Math.PI);
                    diamondBottom.translate(0, -1, 0);
                    geometry = THREE.BufferGeometryUtils ? 
                        THREE.BufferGeometryUtils.mergeBufferGeometries([diamondGeometry, diamondBottom]) : 
                        diamondGeometry;
                    break;
                default:
                    geometry = new THREE.BoxGeometry(2, 2, 2);
            }
            
            const material = new THREE.MeshPhongMaterial({ 
                color: colors[currentColor],
                shininess: 100,
                specular: 0x222222
            });
            
            cube = new THREE.Mesh(geometry, material);
            cube.castShadow = true;
            cube.receiveShadow = true;
            scene.add(cube);
        }
        
        function setupMouseControls() {
            let mouseDown = false;
            let mouseX = 0;
            let mouseY = 0;
            
            renderer.domElement.addEventListener('mousedown', (event) => {
                mouseDown = true;
                mouseX = event.clientX;
                mouseY = event.clientY;
            });
            
            renderer.domElement.addEventListener('mouseup', () => {
                mouseDown = false;
            });
            
            renderer.domElement.addEventListener('mousemove', (event) => {
                if (!mouseDown) return;
                
                const deltaX = event.clientX - mouseX;
                const deltaY = event.clientY - mouseY;
                
                cube.rotation.y += deltaX * 0.01;
                cube.rotation.x += deltaY * 0.01;
                
                mouseX = event.clientX;
                mouseY = event.clientY;
            });
            
            // Zoom uchun wheel hodisasi
            renderer.domElement.addEventListener('wheel', (event) => {
                event.preventDefault();
                const scale = event.deltaY > 0 ? 1.1 : 0.9;
                camera.position.multiplyScalar(scale);
            });
        }
        
        function setupControls() {
            document.getElementById('startRotation').addEventListener('click', () => {
                isRotating = true;
                document.getElementById('rotationStatus').textContent = 'Aylanmoqda';
                document.getElementById('startRotation').classList.add('active');
                document.getElementById('stopRotation').classList.remove('active');
            });
            
            document.getElementById('stopRotation').addEventListener('click', () => {
                isRotating = false;
                document.getElementById('rotationStatus').textContent = 'To\'xtatilgan';
                document.getElementById('stopRotation').classList.add('active');
                document.getElementById('startRotation').classList.remove('active');
            });
            
            document.getElementById('resetView').addEventListener('click', () => {
                camera.position.set(5, 5, 5);
                camera.lookAt(0, 0, 0);
                cube.rotation.set(0, 0, 0);
            });
            
            // Shakl tanlash dropdown
            document.getElementById('shapeSelector').addEventListener('change', (event) => {
                currentShape = parseInt(event.target.value);
                createShape();
            });
            
            // Rang tanlash tugmalari
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // Avvalgi tanlangan rangni olib tashlash
                    document.querySelectorAll('.color-btn').forEach(b => b.style.border = '2px solid white');
                    // Yangi tanlangan rangni belgilash
                    btn.style.border = '3px solid black';
                    
                    currentColor = parseInt(btn.dataset.color);
                    createShape();
                });
            });
            
            // Rang o'zgarish tugmasi (eski usul)
            document.getElementById('changeColor').addEventListener('click', () => {
                currentColor = (currentColor + 1) % colors.length;
                createShape();
                // Ranglar paletidagi belgilanishni yangilash
                document.querySelectorAll('.color-btn').forEach(btn => {
                    if (parseInt(btn.dataset.color) === currentColor) {
                        document.querySelectorAll('.color-btn').forEach(b => b.style.border = '2px solid white');
                        btn.style.border = '3px solid black';
                    }
                });
            });
            
            // Boshlang'ich rang belgilash
            document.querySelector('.color-btn[data-color="0"]').style.border = '3px solid black';
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            if (isRotating && cube) {
                cube.rotation.x += 0.01;
                cube.rotation.y += 0.01;
                cube.rotation.z += 0.005;
            }
            
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            const container = document.getElementById('container');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
        
        // Dasturni ishga tushirish
        init();
    </script>
</body>
</html>