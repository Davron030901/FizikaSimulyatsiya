<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vertikal Prujina-Massa Tizimi | Physics Simulation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00d9ff;
            --secondary: #ff006e;
            --accent: #ffbe0b;
            --dark: #0a0e27;
            --darker: #05070f;
            --mid: #1a1f3a;
            --light: #e8f4f8;
            --success: #06ffa5;
            --energy-kinetic: #ff006e;
            --energy-potential: #00d9ff;
            --energy-elastic: #ffbe0b;
            --text: #ffffff;
            --text-dim: rgba(255, 255, 255, 0.7);
        }

        @font-face {
            font-family: 'Orbitron';
            font-weight: 700;
            font-display: swap;
            src: local('Orbitron Bold'), local('Orbitron-Bold');
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 50%, #0f1428 100%);
            color: var(--text);
            overflow-x: hidden;
            min-height: 100vh;
            line-height: 1.6;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(0, 217, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 0, 110, 0.08) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            padding: 30px 20px;
            margin-bottom: 30px;
            background: linear-gradient(135deg, rgba(0, 217, 255, 0.1) 0%, rgba(255, 0, 110, 0.1) 100%);
            border-radius: 20px;
            border: 1px solid rgba(0, 217, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        h1 {
            font-size: clamp(1.8rem, 5vw, 3rem);
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: var(--text-dim);
            font-size: clamp(0.9rem, 2vw, 1.1rem);
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(26, 31, 58, 0.6);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(0, 217, 255, 0.15);
            backdrop-filter: blur(10px);
        }

        .canvas-container {
            position: relative;
            background: rgba(10, 14, 39, 0.4);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(0, 217, 255, 0.1);
        }

        canvas {
            display: block;
            width: 100%;
            height: auto;
            touch-action: none;
        }

        .controls-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .control-group {
            background: rgba(10, 14, 39, 0.3);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(0, 217, 255, 0.1);
        }

        .control-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.95rem;
            color: var(--text-dim);
        }

        .control-value {
            color: var(--primary);
            font-weight: 600;
            font-size: 1.05rem;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(0, 217, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
            transition: transform 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
        }

        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
            background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(255, 0, 110, 0.2));
            color: var(--text);
            border: 1px solid rgba(0, 217, 255, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 217, 255, 0.3);
            border-color: var(--primary);
        }

        button:active {
            transform: translateY(0);
        }

        button.primary {
            background: linear-gradient(135deg, var(--primary), #0099cc);
            border-color: var(--primary);
        }

        button.secondary {
            background: linear-gradient(135deg, var(--secondary), #cc0055);
            border-color: var(--secondary);
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .preset-buttons button {
            padding: 8px 12px;
            font-size: 0.85rem;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
        }

        .info-card {
            background: rgba(10, 14, 39, 0.3);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(0, 217, 255, 0.1);
        }

        .info-label {
            font-size: 0.85rem;
            color: var(--text-dim);
            margin-bottom: 4px;
        }

        .info-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .info-unit {
            font-size: 0.9rem;
            color: var(--text-dim);
            margin-left: 4px;
        }

        .energy-display {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .energy-bar-container {
            position: relative;
        }

        .energy-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .energy-bar {
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            overflow: hidden;
            position: relative;
        }

        .energy-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.2s;
            position: relative;
            overflow: hidden;
        }

        .energy-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            background: rgba(10, 14, 39, 0.3);
            padding: 5px;
            border-radius: 10px;
        }

        .tab {
            flex: 1;
            padding: 10px;
            border: none;
            background: transparent;
            color: var(--text-dim);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .tab.active {
            background: linear-gradient(135deg, var(--primary), rgba(0, 153, 204, 0.8));
            color: var(--text);
            box-shadow: 0 2px 10px rgba(0, 217, 255, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .theory-section {
            background: rgba(10, 14, 39, 0.3);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(0, 217, 255, 0.1);
            margin-bottom: 15px;
        }

        .theory-section h3 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .formula {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 3px solid var(--primary);
            overflow-x: auto;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .comparison-card {
            background: rgba(10, 14, 39, 0.3);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(0, 217, 255, 0.1);
        }

        .comparison-card h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .comparison-item {
            margin: 8px 0;
            padding-left: 15px;
            position: relative;
            font-size: 0.9rem;
            color: var(--text-dim);
        }

        .comparison-item::before {
            content: '‚Üí';
            position: absolute;
            left: 0;
            color: var(--accent);
        }

        .help-button {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(0, 217, 255, 0.2);
            border: 1px solid var(--primary);
            color: var(--primary);
            font-size: 0.85rem;
            cursor: help;
            padding: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-left: 8px;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: var(--dark);
            color: var(--text);
            text-align: left;
            border-radius: 8px;
            padding: 12px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid var(--primary);
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            header {
                padding: 20px 15px;
            }

            .comparison-grid {
                grid-template-columns: 1fr;
            }

            .info-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .button-group {
                grid-template-columns: 1fr;
            }

            .tooltip .tooltiptext {
                width: 200px;
                margin-left: -100px;
            }
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .speed-label {
            font-size: 0.9rem;
            color: var(--text-dim);
            white-space: nowrap;
        }

        .view-toggle {
            display: flex;
            gap: 5px;
            background: rgba(10, 14, 39, 0.3);
            padding: 5px;
            border-radius: 8px;
        }

        .view-toggle button {
            flex: 1;
            padding: 8px 12px;
            font-size: 0.85rem;
            background: transparent;
            border: 1px solid transparent;
        }

        .view-toggle button.active {
            background: linear-gradient(135deg, var(--primary), rgba(0, 153, 204, 0.8));
            border-color: var(--primary);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .recording {
            animation: pulse 1s infinite;
        }

        footer {
            text-align: center;
            padding: 30px 20px;
            margin-top: 40px;
            color: var(--text-dim);
            font-size: 0.9rem;
            border-top: 1px solid rgba(0, 217, 255, 0.1);
        }

        .keyboard-shortcuts {
            background: rgba(10, 14, 39, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border: 1px solid rgba(0, 217, 255, 0.1);
        }

        .keyboard-shortcuts h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 0.85rem;
        }

        .key {
            background: rgba(0, 217, 255, 0.2);
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
            color: var(--primary);
            border: 1px solid rgba(0, 217, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîß Vertikal Prujina-Massa Tizimi</h1>
            <p class="subtitle">Interaktiv fizika simulyatsiyasi - Gravitatsiya ta'siri ostida tebranishlar</p>
        </header>

        <div class="main-grid">
            <div class="panel">
                <div class="tabs">
                    <button class="tab active" data-tab="simulation">Simulyatsiya</button>
                    <button class="tab" data-tab="comparison">Taqqoslash</button>
                    <button class="tab" data-tab="lissajous">Lissajous</button>
                </div>

                <div id="simulation-tab" class="tab-content active">
                    <div class="canvas-container">
                        <canvas id="simulationCanvas" width="800" height="600"></canvas>
                    </div>
                </div>

                <div id="comparison-tab" class="tab-content">
                    <div class="canvas-container">
                        <canvas id="comparisonCanvas" width="800" height="600"></canvas>
                    </div>
                </div>

                <div id="lissajous-tab" class="tab-content">
                    <div class="canvas-container">
                        <canvas id="lissajousCanvas" width="800" height="600"></canvas>
                    </div>
                </div>

                <div class="button-group" style="margin-top: 15px;">
                    <button id="playPauseBtn" class="primary">‚ñ∂ Boshlash</button>
                    <button id="resetBtn">‚Üª Qayta yuklash</button>
                    <button id="stepBtn">‚Üí Qadam</button>
                    <button id="exportBtn">üíæ Eksport</button>
                </div>

                <div class="speed-control">
                    <span class="speed-label">Tezlik:</span>
                    <input type="range" id="speedSlider" min="10" max="500" value="100" step="10">
                    <span id="speedValue" class="control-value">1.0x</span>
                </div>

                <div class="view-toggle" style="margin-top: 15px;">
                    <button id="showVectors" class="active">Vektorlar</button>
                    <button id="showTrails">Iz</button>
                    <button id="showEnergy">Energiya</button>
                    <button id="showGrid">Grid</button>
                </div>
            </div>

            <div class="controls-panel">
                <div class="control-group">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">Parametrlar</h3>
                    
                    <div class="control-label">
                        <span>Massa (m)
                            <span class="tooltip">
                                <button class="help-button">?</button>
                                <span class="tooltiptext">Jism massasi kilogrammda. Katta massa sekinroq tebranadi va ko'proq energiya talab qiladi.</span>
                            </span>
                        </span>
                        <span class="control-value"><span id="massValue">1.0</span> kg</span>
                    </div>
                    <input type="range" id="massSlider" min="0.1" max="5" value="1" step="0.1">

                    <div class="control-label" style="margin-top: 15px;">
                        <span>Bikrlik (k)
                            <span class="tooltip">
                                <button class="help-button">?</button>
                                <span class="tooltiptext">Prujina bikrligi N/m da. Yuqori qiymat qattiqroq prujina va tezroq tebranishni anglatadi.</span>
                            </span>
                        </span>
                        <span class="control-value"><span id="springValue">50</span> N/m</span>
                    </div>
                    <input type="range" id="springSlider" min="10" max="200" value="50" step="5">

                    <div class="control-label" style="margin-top: 15px;">
                        <span>So'nish (b)
                            <span class="tooltip">
                                <button class="help-button">?</button>
                                <span class="tooltiptext">Qarshilik koeffitsienti. Yuqori qiymat tebranishlarni tezroq so'ndiradi.</span>
                            </span>
                        </span>
                        <span class="control-value"><span id="dampingValue">0.5</span> Ns/m</span>
                    </div>
                    <input type="range" id="dampingSlider" min="0" max="3" value="0.5" step="0.1">

                    <div class="control-label" style="margin-top: 15px;">
                        <span>Amplituda (A)
                            <span class="tooltip">
                                <button class="help-button">?</button>
                                <span class="tooltiptext">Boshlang'ich siljish metrda. Muvozanat holatidan qanchalik uzoqlikda boshlanadi.</span>
                            </span>
                        </span>
                        <span class="control-value"><span id="amplitudeValue">0.3</span> m</span>
                    </div>
                    <input type="range" id="amplitudeSlider" min="0.05" max="1" value="0.3" step="0.05">

                    <div class="preset-buttons">
                        <button data-preset="light">Engil</button>
                        <button data-preset="heavy">Og'ir</button>
                        <button data-preset="stiff">Qattiq</button>
                        <button data-preset="soft">Yumshoq</button>
                    </div>
                </div>

                <div class="control-group">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">Real vaqt ma'lumotlari</h3>
                    <div class="info-grid">
                        <div class="info-card">
                            <div class="info-label">Pozitsiya</div>
                            <div class="info-value"><span id="position">0.00</span><span class="info-unit">m</span></div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Tezlik</div>
                            <div class="info-value"><span id="velocity">0.00</span><span class="info-unit">m/s</span></div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Tezlanish</div>
                            <div class="info-value"><span id="acceleration">0.00</span><span class="info-unit">m/s¬≤</span></div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Davr (T)</div>
                            <div class="info-value"><span id="period">0.00</span><span class="info-unit">s</span></div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Chastota (f)</div>
                            <div class="info-value"><span id="frequency">0.00</span><span class="info-unit">Hz</span></div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">x‚ÇÄ (Muvozanat)</div>
                            <div class="info-value"><span id="equilibrium">0.00</span><span class="info-unit">m</span></div>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">Energiya tahlili</h3>
                    <div class="energy-display">
                        <div class="energy-bar-container">
                            <div class="energy-label">
                                <span style="color: var(--energy-kinetic);">‚óè Kinetik (K)</span>
                                <span id="kineticValue">0.00 J</span>
                            </div>
                            <div class="energy-bar">
                                <div id="kineticBar" class="energy-fill" style="background: linear-gradient(90deg, var(--energy-kinetic), #ff3388); width: 0%;"></div>
                            </div>
                        </div>
                        <div class="energy-bar-container">
                            <div class="energy-label">
                                <span style="color: var(--energy-potential);">‚óè Potensial (U_g)</span>
                                <span id="potentialValue">0.00 J</span>
                            </div>
                            <div class="energy-bar">
                                <div id="potentialBar" class="energy-fill" style="background: linear-gradient(90deg, var(--energy-potential), #00aacc); width: 0%;"></div>
                            </div>
                        </div>
                        <div class="energy-bar-container">
                            <div class="energy-label">
                                <span style="color: var(--energy-elastic);">‚óè Elastik (U_e)</span>
                                <span id="elasticValue">0.00 J</span>
                            </div>
                            <div class="energy-bar">
                                <div id="elasticBar" class="energy-fill" style="background: linear-gradient(90deg, var(--energy-elastic), #ffd700); width: 0%;"></div>
                            </div>
                        </div>
                        <div class="energy-bar-container">
                            <div class="energy-label">
                                <span style="color: var(--success);">‚óè Umumiy (E)</span>
                                <span id="totalValue">0.00 J</span>
                            </div>
                            <div class="energy-bar">
                                <div id="totalBar" class="energy-fill" style="background: linear-gradient(90deg, var(--success), #00dd88); width: 0%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel">
            <div class="tabs">
                <button class="tab active" data-tab="theory">Nazariya</button>
                <button class="tab" data-tab="formulas">Formulalar</button>
                <button class="tab" data-tab="help">Yordam</button>
            </div>

            <div id="theory-tab" class="tab-content active">
                <div class="theory-section">
                    <h3>Vertikal prujina-massa tizimi</h3>
                    <p style="color: var(--text-dim); margin-top: 10px;">
                        Vertikal prujinada osilib turgan massa gravitatsiya ta'siri ostida tebranadi. 
                        Gorizontal tizimd–∞–Ω farqli ravishda, bu yerda og'irlik kuchi va elastik kuch birgalikda harakat qiladi.
                    </p>
                    <div class="formula">
                        $$F_{total} = -kx + mg$$
                        $$ma = -k(x - x_0)$$
                        $$x_0 = \frac{mg}{k}$$
                    </div>
                </div>

                <div class="comparison-grid">
                    <div class="comparison-card">
                        <h4>Vertikal tizim</h4>
                        <div class="comparison-item">Muvozanat x‚ÇÄ = mg/k</div>
                        <div class="comparison-item">Gravitatsiya ta'siri</div>
                        <div class="comparison-item">Og'irlik + elastik kuch</div>
                        <div class="comparison-item">Pastga siljigan x‚ÇÄ</div>
                        <div class="comparison-item">Potensial energiya 2 turi</div>
                    </div>
                    <div class="comparison-card">
                        <h4>Gorizontal tizim</h4>
                        <div class="comparison-item">Muvozanat x‚ÇÄ = 0</div>
                        <div class="comparison-item">Gravitatsiya yo'q</div>
                        <div class="comparison-item">Faqat elastik kuch</div>
                        <div class="comparison-item">Markazda x‚ÇÄ</div>
                        <div class="comparison-item">Faqat elastik energiya</div>
                    </div>
                </div>

                <div class="theory-section" style="margin-top: 15px;">
                    <h3>Lissajous figuralari</h3>
                    <p style="color: var(--text-dim); margin-top: 10px;">
                        Ikki perpendikulyar harmonik tebranishlarning qo'shilishidan hosil bo'lgan egri chiziqlar. 
                        Chastotalar nisbati va faza farqi figuraning shaklini belgilaydi.
                    </p>
                    <div class="formula">
                        $$x(t) = A_x \sin(\omega_x t + \phi_x)$$
                        $$y(t) = A_y \sin(\omega_y t + \phi_y)$$
                    </div>
                </div>
            </div>

            <div id="formulas-tab" class="tab-content">
                <div class="theory-section">
                    <h3>Asosiy formulalar</h3>
                    <div class="formula">
                        <strong>Harakat tenglamasi:</strong>
                        $$m\frac{d^2x}{dt^2} + b\frac{dx}{dt} + kx = mg$$
                    </div>
                    <div class="formula">
                        <strong>Muvozanat pozitsiyasi:</strong>
                        $$x_0 = \frac{mg}{k}$$
                    </div>
                    <div class="formula">
                        <strong>Davr va chastota:</strong>
                        $$T = 2\pi\sqrt{\frac{m}{k}}$$
                        $$f = \frac{1}{T} = \frac{1}{2\pi}\sqrt{\frac{k}{m}}$$
                    </div>
                    <div class="formula">
                        <strong>Kinetik energiya:</strong>
                        $$K = \frac{1}{2}mv^2$$
                    </div>
                    <div class="formula">
                        <strong>Gravitatsion potensial energiya:</strong>
                        $$U_g = mgh = mg(x_0 - x)$$
                    </div>
                    <div class="formula">
                        <strong>Elastik potensial energiya:</strong>
                        $$U_e = \frac{1}{2}kx^2$$
                    </div>
                    <div class="formula">
                        <strong>Umumiy energiya:</strong>
                        $$E = K + U_g + U_e$$
                    </div>
                </div>
            </div>

            <div id="help-tab" class="tab-content">
                <div class="keyboard-shortcuts">
                    <h4>‚å®Ô∏è Klaviatura yorliqlari</h4>
                    <div class="shortcut-item">
                        <span>Boshlash/To'xtatish</span>
                        <span class="key">Space</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Qayta yuklash</span>
                        <span class="key">R</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Qadam</span>
                        <span class="key">S</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Vektorlar ko'rsatish</span>
                        <span class="key">V</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Iz ko'rsatish</span>
                        <span class="key">T</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Grid ko'rsatish</span>
                        <span class="key">G</span>
                    </div>
                </div>

                <div class="theory-section" style="margin-top: 15px;">
                    <h3>Qanday foydalanish</h3>
                    <p style="color: var(--text-dim); line-height: 1.8;">
                        1. <strong>Parametrlarni sozlang:</strong> Massa, bikrlik, so'nish va amplitudani tanglama yordamida o'zgartiring.<br>
                        2. <strong>Boshlash:</strong> "Boshlash" tugmasini bosing yoki Space tugmasini bosing.<br>
                        3. <strong>Kuzatish:</strong> Real vaqt ma'lumotlari va energiya tahlilini kuzatib boring.<br>
                        4. <strong>Taqqoslash:</strong> "Taqqoslash" tabida vertikal va gorizontal tizimlarni solishtiring.<br>
                        5. <strong>Lissajous:</strong> Ikki tebranishning kombinatsiyasini "Lissajous" tabida ko'ring.<br>
                        6. <strong>Eksport:</strong> Ma'lumotlarni CSV formatida eksport qiling.
                    </p>
                </div>
            </div>
        </div>

        <footer>
            <p>Interaktiv fizika simulyatsiyasi | Vertikal prujina-massa tizimi</p>
            <p style="margin-top: 10px; font-size: 0.85rem;">Ma'lumotlar real vaqtda yangilanadi ‚Ä¢ Barcha hisob-kitoblar aniq</p>
        </footer>
    </div>

    <script>
        // Configuration and State
        const config = {
            g: 9.81, // Gravitatsiya tezlanishi (m/s¬≤)
            dt: 0.016, // Vaqt qadami (s)
            scale: 200, // Piksel/metr
            maxTrailPoints: 300,
        };

        const state = {
            m: 1.0,        // Massa (kg)
            k: 50,         // Bikrlik (N/m)
            b: 0.5,        // So'nish (Ns/m)
            A: 0.3,        // Amplituda (m)
            x: 0,          // Pozitsiya (m)
            v: 0,          // Tezlik (m/s)
            a: 0,          // Tezlanish (m/s¬≤)
            t: 0,          // Vaqt (s)
            x0: 0,         // Muvozanat pozitsiyasi (m)
            isRunning: false,
            showVectors: true,
            showTrails: true,
            showEnergy: true,
            showGrid: true,
            speed: 1.0,
            trail: [],
            energyHistory: [],
            dataPoints: [],
        };

        // Canvas Setup
        const canvas = document.getElementById('simulationCanvas');
        const ctx = canvas.getContext('2d');
        const compCanvas = document.getElementById('comparisonCanvas');
        const compCtx = compCanvas.getContext('2d');
        const lissCanvas = document.getElementById('lissajousCanvas');
        const lissCtx = lissCanvas.getContext('2d');

        // Responsive canvas sizing
        function resizeCanvas() {
            const container = canvas.parentElement;
            const width = container.clientWidth;
            const height = Math.min(600, width * 0.75);
            
            [canvas, compCanvas, lissCanvas].forEach(c => {
                c.width = width;
                c.height = height;
                c.style.width = width + 'px';
                c.style.height = height + 'px';
            });
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Physics Calculations
        function calculateEquilibrium() {
            state.x0 = (state.m * config.g) / state.k;
        }

        function calculatePeriodFrequency() {
            const T = 2 * Math.PI * Math.sqrt(state.m / state.k);
            const f = 1 / T;
            return { T, f };
        }

        function calculateEnergies() {
            const K = 0.5 * state.m * state.v * state.v;
            const Ug = state.m * config.g * (state.x0 - state.x);
            const Ue = 0.5 * state.k * state.x * state.x;
            const E = K + Ug + Ue;
            return { K, Ug, Ue, E };
        }

        function updatePhysics() {
            // Elastik kuch va og'irlik kuchi
            const F_spring = -state.k * state.x;
            const F_gravity = state.m * config.g;
            const F_damping = -state.b * state.v;
            const F_total = F_spring + F_gravity + F_damping;
            
            // Tezlanish
            state.a = F_total / state.m;
            
            // Verlet integratsiyasi (aniqroq)
            const dt = config.dt * state.speed;
            state.v += state.a * dt;
            state.x += state.v * dt;
            state.t += dt;
            
            // Trail qo'shish
            if (state.showTrails) {
                state.trail.push({ x: state.x, t: state.t });
                if (state.trail.length > config.maxTrailPoints) {
                    state.trail.shift();
                }
            }

            // Energiya tarixi
            const energies = calculateEnergies();
            state.energyHistory.push({ t: state.t, ...energies });
            if (state.energyHistory.length > 500) {
                state.energyHistory.shift();
            }

            // Ma'lumotlar uchun
            state.dataPoints.push({
                time: state.t.toFixed(3),
                position: state.x.toFixed(4),
                velocity: state.v.toFixed(4),
                acceleration: state.a.toFixed(4),
                ...energies
            });
        }

        // Drawing Functions
        function drawGrid(context, width, height) {
            if (!state.showGrid) return;
            
            context.strokeStyle = 'rgba(0, 217, 255, 0.1)';
            context.lineWidth = 1;
            
            const gridSize = 50;
            for (let x = 0; x < width; x += gridSize) {
                context.beginPath();
                context.moveTo(x, 0);
                context.lineTo(x, height);
                context.stroke();
            }
            for (let y = 0; y < height; y += gridSize) {
                context.beginPath();
                context.moveTo(0, y);
                context.lineTo(width, y);
                context.stroke();
            }
        }

        function drawSpring(context, x1, y1, x2, y2, coils = 15) {
            const dx = x2 - x1;
            const dy = y2 - y1;
            const length = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx);
            const amplitude = 15;
            
            context.save();
            context.translate(x1, y1);
            context.rotate(angle);
            
            const gradient = context.createLinearGradient(0, 0, length, 0);
            gradient.addColorStop(0, '#00d9ff');
            gradient.addColorStop(0.5, '#ff006e');
            gradient.addColorStop(1, '#ffbe0b');
            
            context.strokeStyle = gradient;
            context.lineWidth = 3;
            context.beginPath();
            context.moveTo(0, 0);
            
            for (let i = 0; i <= coils; i++) {
                const x = (i / coils) * length;
                const y = amplitude * Math.sin(i * Math.PI);
                context.lineTo(x, y);
            }
            
            context.stroke();
            context.restore();
        }

        function drawMass(context, x, y, radius) {
            const gradient = context.createRadialGradient(x - radius/3, y - radius/3, 0, x, y, radius);
            gradient.addColorStop(0, '#ff006e');
            gradient.addColorStop(1, '#cc0055');
            
            context.fillStyle = gradient;
            context.beginPath();
            context.arc(x, y, radius, 0, Math.PI * 2);
            context.fill();
            
            context.strokeStyle = '#ff3388';
            context.lineWidth = 2;
            context.stroke();
            
            // Highlight
            context.fillStyle = 'rgba(255, 255, 255, 0.3)';
            context.beginPath();
            context.arc(x - radius/3, y - radius/3, radius/3, 0, Math.PI * 2);
            context.fill();
        }

        function drawVector(context, x, y, vx, vy, color, label) {
            if (!state.showVectors) return;
            
            const length = Math.sqrt(vx * vx + vy * vy);
            if (length < 0.01) return;
            
            const scale = 50;
            const dx = vx * scale;
            const dy = vy * scale;
            
            context.strokeStyle = color;
            context.fillStyle = color;
            context.lineWidth = 2;
            
            // Arrow line
            context.beginPath();
            context.moveTo(x, y);
            context.lineTo(x + dx, y + dy);
            context.stroke();
            
            // Arrow head
            const angle = Math.atan2(dy, dx);
            const headLen = 10;
            context.beginPath();
            context.moveTo(x + dx, y + dy);
            context.lineTo(
                x + dx - headLen * Math.cos(angle - Math.PI / 6),
                y + dy - headLen * Math.sin(angle - Math.PI / 6)
            );
            context.lineTo(
                x + dx - headLen * Math.cos(angle + Math.PI / 6),
                y + dy - headLen * Math.sin(angle + Math.PI / 6)
            );
            context.closePath();
            context.fill();
            
            // Label
            if (label) {
                context.font = 'bold 12px sans-serif';
                context.fillText(label, x + dx + 15, y + dy);
            }
        }

        function drawSimulation() {
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = 'rgba(10, 14, 39, 0.8)';
            ctx.fillRect(0, 0, width, height);
            
            drawGrid(ctx, width, height);
            
            const centerX = width / 2;
            const topY = 100;
            
            // Muvozanat chizig'i
            const equilibriumY = topY + state.x0 * config.scale;
            ctx.strokeStyle = 'rgba(0, 217, 255, 0.3)';
            ctx.setLineDash([5, 5]);
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(centerX - 100, equilibriumY);
            ctx.lineTo(centerX + 100, equilibriumY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = '#00d9ff';
            ctx.font = 'bold 12px sans-serif';
            ctx.fillText('x‚ÇÄ (Muvozanat)', centerX + 110, equilibriumY + 5);
            
            // Massa pozitsiyasi
            const massY = topY + state.x * config.scale;
            const massRadius = 20 + state.m * 5;
            
            // Trail
            if (state.showTrails && state.trail.length > 1) {
                ctx.strokeStyle = 'rgba(255, 0, 110, 0.5)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                for (let i = 0; i < state.trail.length; i++) {
                    const point = state.trail[i];
                    const y = topY + point.x * config.scale;
                    const alpha = i / state.trail.length;
                    ctx.globalAlpha = alpha * 0.5;
                    if (i === 0) {
                        ctx.moveTo(centerX + 150, y);
                    } else {
                        ctx.lineTo(centerX + 150, y);
                    }
                }
                ctx.stroke();
                ctx.globalAlpha = 1;
            }
            
            // Prujina
            drawSpring(ctx, centerX, topY, centerX, massY - massRadius, 20);
            
            // Massa
            drawMass(ctx, centerX, massY, massRadius);
            
            // Vektorlar
            drawVector(ctx, centerX, massY, 0, state.v, '#00d9ff', 'v');
            drawVector(ctx, centerX, massY, 0, state.a, '#ffbe0b', 'a');
            
            // Kuchlar
            const F_spring = -state.k * state.x;
            const F_gravity = state.m * config.g;
            drawVector(ctx, centerX - 40, massY, 0, F_spring / (state.m * 10), '#ff006e', 'F_e');
            drawVector(ctx, centerX + 40, massY, 0, F_gravity / (state.m * 10), '#06ffa5', 'F_g');
            
            // Energiya grafik
            if (state.showEnergy && state.energyHistory.length > 1) {
                const graphX = width - 250;
                const graphY = 50;
                const graphW = 200;
                const graphH = 120;
                
                ctx.fillStyle = 'rgba(10, 14, 39, 0.8)';
                ctx.fillRect(graphX, graphY, graphW, graphH);
                ctx.strokeStyle = 'rgba(0, 217, 255, 0.3)';
                ctx.strokeRect(graphX, graphY, graphW, graphH);
                
                const maxE = Math.max(...state.energyHistory.map(e => e.E), 1);
                
                // Draw energy curves
                const colors = {
                    K: '#ff006e',
                    Ug: '#00d9ff',
                    Ue: '#ffbe0b',
                    E: '#06ffa5'
                };
                
                Object.keys(colors).forEach(key => {
                    ctx.strokeStyle = colors[key];
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    state.energyHistory.forEach((point, i) => {
                        const x = graphX + (i / state.energyHistory.length) * graphW;
                        const y = graphY + graphH - (point[key] / maxE) * graphH;
                        if (i === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                    });
                    ctx.stroke();
                });
                
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 11px sans-serif';
                ctx.fillText('Energiya grafigi', graphX + 5, graphY + 15);
            }
        }

        function drawComparison() {
            const width = compCanvas.width;
            const height = compCanvas.height;
            
            compCtx.fillStyle = 'rgba(10, 14, 39, 0.8)';
            compCtx.fillRect(0, 0, width, height);
            
            drawGrid(compCtx, width, height);
            
            const leftX = width / 4;
            const rightX = 3 * width / 4;
            const centerY = height / 2;
            
            // Labels
            compCtx.fillStyle = '#00d9ff';
            compCtx.font = 'bold 16px sans-serif';
            compCtx.fillText('Vertikal', leftX - 30, 30);
            compCtx.fillText('Gorizontal', rightX - 40, 30);
            
            // Vertikal tizim
            const topY = 100;
            const verticalY = topY + state.x * config.scale;
            drawSpring(compCtx, leftX, topY, leftX, verticalY - 15, 20);
            drawMass(compCtx, leftX, verticalY, 15);
            
            // Muvozanat chizig'i
            const eqY = topY + state.x0 * config.scale;
            compCtx.strokeStyle = 'rgba(0, 217, 255, 0.3)';
            compCtx.setLineDash([5, 5]);
            compCtx.beginPath();
            compCtx.moveTo(leftX - 50, eqY);
            compCtx.lineTo(leftX + 50, eqY);
            compCtx.stroke();
            compCtx.setLineDash([]);
            
            // Gorizontal tizim (muvozanat markaz)
            const horizX = rightX + state.x * config.scale;
            drawSpring(compCtx, rightX - 100, centerY, horizX - 15, centerY, 20);
            drawMass(compCtx, horizX, centerY, 15);
            
            // Muvozanat chizig'i (gorizontal)
            compCtx.strokeStyle = 'rgba(255, 190, 11, 0.3)';
            compCtx.setLineDash([5, 5]);
            compCtx.beginPath();
            compCtx.moveTo(rightX, centerY - 50);
            compCtx.lineTo(rightX, centerY + 50);
            compCtx.stroke();
            compCtx.setLineDash([]);
            
            // Taqqoslash ma'lumotlari
            compCtx.fillStyle = 'rgba(10, 14, 39, 0.9)';
            compCtx.fillRect(width/2 - 150, height - 150, 300, 130);
            compCtx.strokeStyle = 'rgba(0, 217, 255, 0.3)';
            compCtx.strokeRect(width/2 - 150, height - 150, 300, 130);
            
            compCtx.fillStyle = '#ffffff';
            compCtx.font = 'bold 14px sans-serif';
            compCtx.fillText('Asosiy farqlar:', width/2 - 140, height - 125);
            
            compCtx.font = '12px sans-serif';
            compCtx.fillStyle = '#00d9ff';
            compCtx.fillText(`Vertikal x‚ÇÄ = ${state.x0.toFixed(3)} m`, width/2 - 140, height - 105);
            compCtx.fillStyle = '#ffbe0b';
            compCtx.fillText('Gorizontal x‚ÇÄ = 0 m', width/2 - 140, height - 85);
            
            compCtx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            compCtx.fillText('Bir xil davr: T = 2œÄ‚àö(m/k)', width/2 - 140, height - 60);
            compCtx.fillText('Farqli energiya taqsimoti', width/2 - 140, height - 40);
        }

        function drawLissajous() {
            const width = lissCanvas.width;
            const height = lissCanvas.height;
            
            lissCtx.fillStyle = 'rgba(10, 14, 39, 0.95)';
            lissCtx.fillRect(0, 0, width, height);
            
            const centerX = width / 2;
            const centerY = height / 2;
            const scale = Math.min(width, height) / 3;
            
            // Lissajous parametrlari
            const A_x = state.A;
            const A_y = state.A * 0.8;
            const omega_x = Math.sqrt(state.k / state.m);
            const omega_y = omega_x * 1.5; // Chastota nisbati 3:2
            const phi = Math.PI / 4; // Faza farqi
            
            // Chizish
            lissCtx.strokeStyle = 'rgba(0, 217, 255, 0.8)';
            lissCtx.lineWidth = 2;
            lissCtx.beginPath();
            
            const points = 1000;
            for (let i = 0; i <= points; i++) {
                const t = (i / points) * 4 * Math.PI;
                const x = A_x * Math.sin(omega_x * t) * scale;
                const y = A_y * Math.sin(omega_y * t + phi) * scale;
                
                if (i === 0) {
                    lissCtx.moveTo(centerX + x, centerY + y);
                } else {
                    lissCtx.lineTo(centerX + x, centerY + y);
                }
            }
            lissCtx.stroke();
            
            // Hozirgi nuqta
            const t = state.t;
            const current_x = A_x * Math.sin(omega_x * t) * scale;
            const current_y = A_y * Math.sin(omega_y * t + phi) * scale;
            
            const gradient = lissCtx.createRadialGradient(
                centerX + current_x, centerY + current_y, 0,
                centerX + current_x, centerY + current_y, 10
            );
            gradient.addColorStop(0, '#ff006e');
            gradient.addColorStop(1, 'rgba(255, 0, 110, 0)');
            
            lissCtx.fillStyle = gradient;
            lissCtx.beginPath();
            lissCtx.arc(centerX + current_x, centerY + current_y, 10, 0, Math.PI * 2);
            lissCtx.fill();
            
            // O'qlar
            lissCtx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            lissCtx.lineWidth = 1;
            lissCtx.beginPath();
            lissCtx.moveTo(0, centerY);
            lissCtx.lineTo(width, centerY);
            lissCtx.moveTo(centerX, 0);
            lissCtx.lineTo(centerX, height);
            lissCtx.stroke();
            
            // Ma'lumotlar
            lissCtx.fillStyle = 'rgba(10, 14, 39, 0.9)';
            lissCtx.fillRect(20, 20, 200, 100);
            lissCtx.strokeStyle = 'rgba(0, 217, 255, 0.3)';
            lissCtx.strokeRect(20, 20, 200, 100);
            
            lissCtx.fillStyle = '#ffffff';
            lissCtx.font = 'bold 14px sans-serif';
            lissCtx.fillText('Lissajous figurasi', 30, 40);
            
            lissCtx.font = '12px sans-serif';
            lissCtx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            lissCtx.fillText(`œâ_x : œâ_y = 2 : 3`, 30, 65);
            lissCtx.fillText(`œÜ = œÄ/4`, 30, 85);
            lissCtx.fillText(`A_x = ${A_x.toFixed(2)} m`, 30, 105);
        }

        // Update UI
        function updateUI() {
            document.getElementById('position').textContent = state.x.toFixed(3);
            document.getElementById('velocity').textContent = state.v.toFixed(3);
            document.getElementById('acceleration').textContent = state.a.toFixed(3);
            
            const { T, f } = calculatePeriodFrequency();
            document.getElementById('period').textContent = T.toFixed(3);
            document.getElementById('frequency').textContent = f.toFixed(3);
            document.getElementById('equilibrium').textContent = state.x0.toFixed(3);
            
            const { K, Ug, Ue, E } = calculateEnergies();
            const maxE = Math.max(K, Ug, Ue, E, 1);
            
            document.getElementById('kineticValue').textContent = K.toFixed(3) + ' J';
            document.getElementById('potentialValue').textContent = Ug.toFixed(3) + ' J';
            document.getElementById('elasticValue').textContent = Ue.toFixed(3) + ' J';
            document.getElementById('totalValue').textContent = E.toFixed(3) + ' J';
            
            document.getElementById('kineticBar').style.width = (K / maxE * 100) + '%';
            document.getElementById('potentialBar').style.width = (Ug / maxE * 100) + '%';
            document.getElementById('elasticBar').style.width = (Ue / maxE * 100) + '%';
            document.getElementById('totalBar').style.width = (E / maxE * 100) + '%';
        }

        // Animation Loop
        let animationId;
        function animate() {
            if (state.isRunning) {
                updatePhysics();
                updateUI();
            }
            
            const activeTab = document.querySelector('.tab.active').dataset.tab;
            if (activeTab === 'simulation') {
                drawSimulation();
            } else if (activeTab === 'comparison') {
                drawComparison();
            } else if (activeTab === 'lissajous') {
                drawLissajous();
            }
            
            animationId = requestAnimationFrame(animate);
        }

        // Control Functions
        function reset() {
            state.x = state.A;
            state.v = 0;
            state.a = 0;
            state.t = 0;
            state.trail = [];
            state.energyHistory = [];
            state.dataPoints = [];
            calculateEquilibrium();
            updateUI();
        }

        function togglePlayPause() {
            state.isRunning = !state.isRunning;
            const btn = document.getElementById('playPauseBtn');
            btn.textContent = state.isRunning ? '‚è∏ To\'xtatish' : '‚ñ∂ Boshlash';
            btn.classList.toggle('recording', state.isRunning);
        }

        function step() {
            updatePhysics();
            updateUI();
            drawSimulation();
        }

        function exportData() {
            if (state.dataPoints.length === 0) {
                alert('Ma\'lumotlar mavjud emas. Simulyatsiyani ishga tushiring.');
                return;
            }
            
            let csv = 'Time(s),Position(m),Velocity(m/s),Acceleration(m/s¬≤),Kinetic(J),Potential_g(J),Elastic(J),Total(J)\n';
            state.dataPoints.forEach(point => {
                csv += `${point.time},${point.position},${point.velocity},${point.acceleration},${point.K.toFixed(4)},${point.Ug.toFixed(4)},${point.Ue.toFixed(4)},${point.E.toFixed(4)}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'vertical-spring-data.csv';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Event Listeners
        document.getElementById('playPauseBtn').addEventListener('click', togglePlayPause);
        document.getElementById('resetBtn').addEventListener('click', reset);
        document.getElementById('stepBtn').addEventListener('click', step);
        document.getElementById('exportBtn').addEventListener('click', exportData);

        // Sliders
        document.getElementById('massSlider').addEventListener('input', (e) => {
            state.m = parseFloat(e.target.value);
            document.getElementById('massValue').textContent = state.m.toFixed(1);
            calculateEquilibrium();
            updateUI();
        });

        document.getElementById('springSlider').addEventListener('input', (e) => {
            state.k = parseFloat(e.target.value);
            document.getElementById('springValue').textContent = state.k.toFixed(0);
            calculateEquilibrium();
            updateUI();
        });

        document.getElementById('dampingSlider').addEventListener('input', (e) => {
            state.b = parseFloat(e.target.value);
            document.getElementById('dampingValue').textContent = state.b.toFixed(1);
        });

        document.getElementById('amplitudeSlider').addEventListener('input', (e) => {
            state.A = parseFloat(e.target.value);
            document.getElementById('amplitudeValue').textContent = state.A.toFixed(2);
            if (!state.isRunning) {
                state.x = state.A;
            }
        });

        document.getElementById('speedSlider').addEventListener('input', (e) => {
            state.speed = parseFloat(e.target.value) / 100;
            document.getElementById('speedValue').textContent = state.speed.toFixed(1) + 'x';
        });

        // Presets
        document.querySelectorAll('[data-preset]').forEach(btn => {
            btn.addEventListener('click', () => {
                const preset = btn.dataset.preset;
                switch(preset) {
                    case 'light':
                        state.m = 0.5;
                        state.k = 80;
                        state.b = 0.3;
                        state.A = 0.4;
                        break;
                    case 'heavy':
                        state.m = 3.0;
                        state.k = 40;
                        state.b = 0.8;
                        state.A = 0.2;
                        break;
                    case 'stiff':
                        state.m = 1.0;
                        state.k = 150;
                        state.b = 0.5;
                        state.A = 0.15;
                        break;
                    case 'soft':
                        state.m = 1.0;
                        state.k = 20;
                        state.b = 0.5;
                        state.A = 0.5;
                        break;
                }
                
                document.getElementById('massSlider').value = state.m;
                document.getElementById('massValue').textContent = state.m.toFixed(1);
                document.getElementById('springSlider').value = state.k;
                document.getElementById('springValue').textContent = state.k.toFixed(0);
                document.getElementById('dampingSlider').value = state.b;
                document.getElementById('dampingValue').textContent = state.b.toFixed(1);
                document.getElementById('amplitudeSlider').value = state.A;
                document.getElementById('amplitudeValue').textContent = state.A.toFixed(2);
                
                reset();
            });
        });

        // View toggles
        document.getElementById('showVectors').addEventListener('click', function() {
            state.showVectors = !state.showVectors;
            this.classList.toggle('active');
        });

        document.getElementById('showTrails').addEventListener('click', function() {
            state.showTrails = !state.showTrails;
            this.classList.toggle('active');
            if (!state.showTrails) state.trail = [];
        });

        document.getElementById('showEnergy').addEventListener('click', function() {
            state.showEnergy = !state.showEnergy;
            this.classList.toggle('active');
        });

        document.getElementById('showGrid').addEventListener('click', function() {
            state.showGrid = !state.showGrid;
            this.classList.toggle('active');
        });

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.dataset.tab;
                
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabName + '-tab').classList.add('active');
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            switch(e.key.toLowerCase()) {
                case ' ':
                    e.preventDefault();
                    togglePlayPause();
                    break;
                case 'r':
                    reset();
                    break;
                case 's':
                    step();
                    break;
                case 'v':
                    document.getElementById('showVectors').click();
                    break;
                case 't':
                    document.getElementById('showTrails').click();
                    break;
                case 'g':
                    document.getElementById('showGrid').click();
                    break;
            }
        });

        // Touch support
        let touchStartX = 0;
        canvas.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touchX = e.touches[0].clientX;
            const deltaX = touchX - touchStartX;
            
            if (Math.abs(deltaX) > 50) {
                if (deltaX > 0) {
                    state.A = Math.min(state.A + 0.05, 1);
                } else {
                    state.A = Math.max(state.A - 0.05, 0.05);
                }
                document.getElementById('amplitudeSlider').value = state.A;
                document.getElementById('amplitudeValue').textContent = state.A.toFixed(2);
                touchStartX = touchX;
            }
        });

        // Initialize
        calculateEquilibrium();
        reset();
        animate();

        // MathJax rendering
        if (window.MathJax) {
            MathJax.typesetPromise();
        }
    </script>
</body>
</html>
