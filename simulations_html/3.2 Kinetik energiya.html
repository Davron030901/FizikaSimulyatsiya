<!DOCTYPE html>
<html lang="uz">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3.2 Kinetik Energiya Simulyatsiyasi</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .formula-box {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.5em;
            font-weight: bold;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .simulation-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

        .animation-container {
            background: #000;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            height: 400px;
            border: 3px solid #333;
        }

        .control-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }

        input[type="range"] {
            width: 100%;
            margin-bottom: 10px;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .value-display {
            font-size: 1.1em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .energy-display {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .object {
            position: absolute;
            width: 60px;
            height: 30px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            border-radius: 10px;
            border: 2px solid #fff;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.7em;
            z-index: 10;
        }

        .object::before {
            content: '';
            position: absolute;
            top: -5px;
            left: 10px;
            width: 8px;
            height: 8px;
            background: #333;
            border-radius: 50%;
            border: 1px solid #fff;
        }

        .object::after {
            content: '';
            position: absolute;
            top: -5px;
            right: 10px;
            width: 8px;
            height: 8px;
            background: #333;
            border-radius: 50%;
            border: 1px solid #fff;
        }

        .car-wheels {
            position: absolute;
            bottom: -8px;
            left: 5px;
            right: 5px;
            height: 8px;
            display: flex;
            justify-content: space-between;
        }

        .wheel {
            width: 12px;
            height: 12px;
            background: #333;
            border-radius: 50%;
            border: 2px solid #fff;
            animation: spin 0.5s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .object.ball {
            border-radius: 50%;
            width: 40px;
            height: 40px;
        }

        .object.ball::before,
        .object.ball::after {
            display: none;
        }

        .object.rocket {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            border-radius: 20px 5px 5px 20px;
            position: relative;
        }

        .object.rocket::before {
            content: 'ðŸš€';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2em;
            border: none;
            background: none;
            width: auto;
            height: auto;
        }

        .object.rocket::after {
            display: none;
        }

        .trail {
            position: absolute;
            height: 2px;
            background: linear-gradient(to right, transparent, #ff6b6b);
            border-radius: 1px;
            opacity: 0.7;
        }

        .chart-container {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

        .chart {
            width: 100%;
            height: 300px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .comparison-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .comparison-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
            text-align: center;
        }

        .comparison-object {
            width: 40px;
            height: 40px;
            margin: 10px auto;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .info-box {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-top: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .info-box h3 {
            margin-top: 0;
            font-size: 1.3em;
        }

        .info-box ul {
            list-style: none;
            padding: 0;
        }

        .info-box li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }

        .info-box li:before {
            content: "âš¡";
            position: absolute;
            left: 0;
            font-size: 1.2em;
        }

        .button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin: 5px;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .double-speed-effect {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .units-display {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .grid-lines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.1;
            pointer-events: none;
        }

        .speed-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.9);
            padding: 10px;
            border-radius: 10px;
            font-weight: bold;
            color: #333;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulsing {
            animation: pulse 0.5s ease-in-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>3.2 Kinetik Energiya Simulyatsiyasi</h1>
        
        <div class="formula-box">
            <div>Eâ‚– = Â½mvÂ²</div>
            <div style="font-size: 0.8em; margin-top: 10px; opacity: 0.9;">
                Kinetik energiya massa va tezlikning kvadratiga bog'liq
            </div>
        </div>

        <div class="simulation-area">
            <div class="controls">
                <div class="control-group">
                    <label for="objectType">Jism turi:</label>
                    <select id="objectType" style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ddd; font-size: 1em;">
                        <option value="car">ðŸš— Mashina</option>
                        <option value="ball">âš½ To'p</option>
                        <option value="rocket">ðŸš€ Raketa</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="mass">Massa (kg):</label>
                    <input type="range" id="mass" min="0.1" max="10" step="0.1" value="2">
                    <div class="value-display">Massa: <span id="massValue">2.0</span> kg</div>
                </div>

                <div class="control-group">
                    <label for="velocity">Tezlik (m/s):</label>
                    <input type="range" id="velocity" min="0" max="20" step="0.1" value="5">
                    <div class="value-display">Tezlik: <span id="velocityValue">5.0</span> m/s</div>
                </div>

                <div class="energy-display">
                    <div>Kinetik Energiya</div>
                    <div id="energyValue">25.0 J</div>
                </div>

                <div class="double-speed-effect">
                    <div>Tezlik 2 baravar oshsa:</div>
                    <div>Energiya <span id="quadrupleEffect">4</span> baravar oshadi!</div>
                    <div style="font-size: 0.9em; margin-top: 5px;">
                        <span id="doubleSpeedEnergy">100.0 J</span> bo'ladi
                    </div>
                </div>

                <div class="units-display">
                    <div>Energiya birliklari:</div>
                    <div>1 Joule = 1 kgâ‹…mÂ²/sÂ²</div>
                </div>

                <div style="margin-top: 20px;">
                    <button class="button" onclick="startAnimation()">Animatsiyani Boshlash</button>
                    <button class="button" onclick="resetAnimation()">Qayta Boshlash</button>
                </div>
            </div>

            <div class="animation-container" id="animationContainer">
                <div class="speed-indicator" id="speedIndicator">
                    Tezlik: 5.0 m/s
                </div>
                <canvas id="trailCanvas" width="600" height="400" style="position: absolute; top: 0; left: 0;"></canvas>
                <div class="object car" id="movingObject">
                    <div>2kg</div>
                    <div class="car-wheels">
                        <div class="wheel"></div>
                        <div class="wheel"></div>
                    </div>
                </div>
                <div class="grid-lines">
                    <svg width="100%" height="100%">
                        <defs>
                            <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                                <path d="M 20 0 L 0 0 0 20" fill="none" stroke="white" stroke-width="0.5"/>
                            </pattern>
                        </defs>
                        <rect width="100%" height="100%" fill="url(#grid)" />
                    </svg>
                </div>
                <div style="position: absolute; bottom: 10px; left: 10px; color: white; font-size: 0.9em;">
                    <div>Pozitsiya: <span id="positionDisplay">0</span> m</div>
                    <div>Vaqt: <span id="timeDisplay">0.0</span> s</div>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <h3>Energiya-Tezlik Grafigi (Parabola)</h3>
            <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center;">
                <label>Grafik masshtab:</label>
                <button class="button" onclick="setGraphScale('auto')" style="padding: 5px 10px; font-size: 0.8em;">Avtomatik</button>
                <button class="button" onclick="setGraphScale('fixed')" style="padding: 5px 10px; font-size: 0.8em;">Qat'iy</button>
                <button class="button" onclick="setGraphScale('zoom')" style="padding: 5px 10px; font-size: 0.8em;">Kattalashtirish</button>
                <span id="scaleInfo" style="font-size: 0.9em; color: #666;">Avtomatik masshtab</span>
            </div>
            <canvas id="energyChart" width="800" height="300"></canvas>
            <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                <div>Joriy nuqta: (<span id="currentPoint">0, 0</span>)</div>
                <div>Maksimal energiya: <span id="maxEnergyDisplay">0</span> J</div>
                <div>Grafik diapazoni: 0-<span id="velocityRange">20</span> m/s</div>
            </div>
        </div>

        <div class="comparison-area">
            <div class="comparison-box">
                <h3>Engil Jism</h3>
                <div class="comparison-object" style="background: linear-gradient(135deg, #74b9ff, #0984e3); width: 30px; height: 30px;"></div>
                <div>Massa: <span id="lightMass">1.0</span> kg</div>
                <div>Tezlik: <span id="lightVelocity">5.0</span> m/s</div>
                <div style="font-weight: bold; color: #0984e3;">
                    Energiya: <span id="lightEnergy">12.5</span> J
                </div>
            </div>

            <div class="comparison-box">
                <h3>Og'ir Jism</h3>
                <div class="comparison-object" style="background: linear-gradient(135deg, #ff6b6b, #ee5a24); width: 50px; height: 50px;"></div>
                <div>Massa: <span id="heavyMass">5.0</span> kg</div>
                <div>Tezlik: <span id="heavyVelocity">5.0</span> m/s</div>
                <div style="font-weight: bold; color: #ee5a24;">
                    Energiya: <span id="heavyEnergy">62.5</span> J
                </div>
            </div>
        </div>

        <div class="info-box">
            <h3>Kinetik Energiya Haqida Ma'lumotlar</h3>
            <ul>
                <li>Kinetik energiya harakatdagi jismning energiyasidir</li>
                <li>Tezlik ikki baravar oshsa, energiya 4 baravar oshadi</li>
                <li>Massa ikki baravar oshsa, energiya 2 baravar oshadi</li>
                <li>Energiya har doim musbat qiymat (skalyar kattalik)</li>
                <li>Joule (J) - energiyaning xalqaro birligi</li>
                <li>1 J = 1 kgâ‹…mÂ²/sÂ² (kilogramm-metr kvadrat sekundiga)</li>
            </ul>
        </div>
    </div>

    <script>
        let animationId;
        let objectPosition = 0;
        let isAnimating = false;
        let trails = [];
        let animationStartTime = 0;
        let currentTime = 0;
        let graphScale = 'auto'; // 'auto', 'fixed', 'zoom'
        let zoomLevel = 1;

        // DOM elementlari
        const massSlider = document.getElementById('mass');
        const velocitySlider = document.getElementById('velocity');
        const objectTypeSelect = document.getElementById('objectType');
        const massValue = document.getElementById('massValue');
        const velocityValue = document.getElementById('velocityValue');
        const energyValue = document.getElementById('energyValue');
        const movingObject = document.getElementById('movingObject');
        const trailCanvas = document.getElementById('trailCanvas');
        const trailCtx = trailCanvas.getContext('2d');
        const speedIndicator = document.getElementById('speedIndicator');
        const doubleSpeedEnergy = document.getElementById('doubleSpeedEnergy');
        const quadrupleEffect = document.getElementById('quadrupleEffect');
        const positionDisplay = document.getElementById('positionDisplay');
        const timeDisplay = document.getElementById('timeDisplay');

        // Grafik
        const chartCanvas = document.getElementById('energyChart');
        const chartCtx = chartCanvas.getContext('2d');

        // Kinetik energiya hisoblagich
        function calculateKineticEnergy(mass, velocity) {
            return 0.5 * mass * velocity * velocity;
        }

        // Obyekt turini o'zgartirish
        function updateObjectType() {
            const objectType = objectTypeSelect.value;
            const mass = parseFloat(massSlider.value);
            
            movingObject.className = `object ${objectType}`;
            
            // Obyekt o'lchamini va ko'rinishini o'zgartirish
            if (objectType === 'car') {
                const size = Math.max(50, 30 + mass * 5);
                movingObject.style.width = size + 'px';
                movingObject.style.height = '30px';
                movingObject.innerHTML = `<div>${mass}kg</div><div class="car-wheels"><div class="wheel"></div><div class="wheel"></div></div>`;
            } else if (objectType === 'ball') {
                const size = Math.max(30, 20 + mass * 4);
                movingObject.style.width = size + 'px';
                movingObject.style.height = size + 'px';
                movingObject.innerHTML = `<div>${mass}kg</div>`;
            } else if (objectType === 'rocket') {
                const size = Math.max(60, 40 + mass * 3);
                movingObject.style.width = size + 'px';
                movingObject.style.height = '25px';
                movingObject.innerHTML = `<div style="font-size: 0.6em;">${mass}kg</div>`;
            }
        }

        // Qiymatlarni yangilash
        function updateValues() {
            const mass = parseFloat(massSlider.value);
            const velocity = parseFloat(velocitySlider.value);
            const energy = calculateKineticEnergy(mass, velocity);
            const doubleSpeedEn = calculateKineticEnergy(mass, velocity * 2);

            massValue.textContent = mass.toFixed(1);
            velocityValue.textContent = velocity.toFixed(1);
            energyValue.textContent = energy.toFixed(1);
            doubleSpeedEnergy.textContent = doubleSpeedEn.toFixed(1);
            quadrupleEffect.textContent = (doubleSpeedEn / energy).toFixed(1);

            // Obyekt turini yangilash
            updateObjectType();

            // Tezlik indikatori
            speedIndicator.textContent = `Tezlik: ${velocity.toFixed(1)} m/s`;

            // Taqqoslash jismlari
            updateComparisonObjects();

            // Grafik
            drawEnergyChart();

            // Pulsatsiya effekti
            if (energy > 0) {
                energyValue.parentElement.classList.add('pulsing');
                setTimeout(() => {
                    energyValue.parentElement.classList.remove('pulsing');
                }, 500);
            }
        }

        // Taqqoslash jismlarini yangilash
        function updateComparisonObjects() {
            const velocity = parseFloat(velocitySlider.value);
            const lightMass = 1.0;
            const heavyMass = 5.0;
            
            const lightEnergy = calculateKineticEnergy(lightMass, velocity);
            const heavyEnergy = calculateKineticEnergy(heavyMass, velocity);

            document.getElementById('lightMass').textContent = lightMass.toFixed(1);
            document.getElementById('lightVelocity').textContent = velocity.toFixed(1);
            document.getElementById('lightEnergy').textContent = lightEnergy.toFixed(1);

            document.getElementById('heavyMass').textContent = heavyMass.toFixed(1);
            document.getElementById('heavyVelocity').textContent = velocity.toFixed(1);
            document.getElementById('heavyEnergy').textContent = heavyEnergy.toFixed(1);
        }

        // Grafik masshtabini o'rnatish
        function setGraphScale(type) {
            graphScale = type;
            const scaleInfo = document.getElementById('scaleInfo');
            
            switch(type) {
                case 'auto':
                    scaleInfo.textContent = 'Avtomatik masshtab';
                    break;
                case 'fixed':
                    scaleInfo.textContent = 'Qat\'iy masshtab (0-20 m/s)';
                    break;
                case 'zoom':
                    scaleInfo.textContent = 'Kattalashtirish rejimi';
                    break;
            }
            
            drawEnergyChart();
        }

        // Moslashuvchi grafik chizish
        function drawEnergyChart() {
            chartCtx.clearRect(0, 0, chartCanvas.width, chartCanvas.height);
            
            const mass = parseFloat(massSlider.value);
            const currentVelocity = parseFloat(velocitySlider.value);
            const currentEnergy = calculateKineticEnergy(mass, currentVelocity);
            
            // Masshtab hisoblash
            let maxVelocity, maxEnergy;
            
            switch(graphScale) {
                case 'auto':
                    // Avtomatik masshtab - joriy qiymatga qarab
                    maxVelocity = Math.max(20, currentVelocity * 1.5, 10);
                    maxEnergy = calculateKineticEnergy(mass, maxVelocity);
                    break;
                case 'fixed':
                    // Qat'iy masshtab
                    maxVelocity = 20;
                    maxEnergy = calculateKineticEnergy(mass, maxVelocity);
                    break;
                case 'zoom':
                    // Kattalashtirish rejimi - joriy qiymat atrofida
                    const zoomRange = Math.max(3, currentVelocity * 0.8);
                    maxVelocity = currentVelocity + zoomRange;
                    maxEnergy = calculateKineticEnergy(mass, maxVelocity);
                    break;
            }
            
            // Ma'lumotlarni yangilash
            document.getElementById('currentPoint').textContent = 
                `${currentVelocity.toFixed(1)}, ${currentEnergy.toFixed(1)}`;
            document.getElementById('maxEnergyDisplay').textContent = maxEnergy.toFixed(1);
            document.getElementById('velocityRange').textContent = maxVelocity.toFixed(1);
            
            // Koordinata o'qlari
            chartCtx.strokeStyle = '#333';
            chartCtx.lineWidth = 2;
            
            // X o'qi
            chartCtx.beginPath();
            chartCtx.moveTo(60, chartCanvas.height - 50);
            chartCtx.lineTo(chartCanvas.width - 30, chartCanvas.height - 50);
            chartCtx.stroke();
            
            // Y o'qi
            chartCtx.beginPath();
            chartCtx.moveTo(60, chartCanvas.height - 50);
            chartCtx.lineTo(60, 30);
            chartCtx.stroke();

            // O'q yorliqlari
            chartCtx.fillStyle = '#333';
            chartCtx.font = '14px Arial';
            chartCtx.fillText('Tezlik (m/s)', chartCanvas.width - 120, chartCanvas.height - 10);
            chartCtx.save();
            chartCtx.translate(15, chartCanvas.height / 2);
            chartCtx.rotate(-Math.PI / 2);
            chartCtx.fillText('Energiya (J)', 0, 0);
            chartCtx.restore();

            // Dinamik shkala belgilari
            chartCtx.fillStyle = '#666';
            chartCtx.font = '11px Arial';
            
            // X o'qi shkala (tezlik)
            const xSteps = 8;
            for (let i = 0; i <= xSteps; i++) {
                const v = (maxVelocity * i) / xSteps;
                const x = 60 + (i / xSteps) * (chartCanvas.width - 90);
                
                // Shkala chizig'i
                chartCtx.strokeStyle = '#ddd';
                chartCtx.lineWidth = 1;
                chartCtx.beginPath();
                chartCtx.moveTo(x, chartCanvas.height - 50);
                chartCtx.lineTo(x, chartCanvas.height - 45);
                chartCtx.stroke();
                
                // Qiymat
                chartCtx.fillStyle = '#666';
                chartCtx.textAlign = 'center';
                chartCtx.fillText(v.toFixed(1), x, chartCanvas.height - 25);
                
                // Grid chiziqlari
                if (i > 0) {
                    chartCtx.strokeStyle = '#f0f0f0';
                    chartCtx.lineWidth = 0.5;
                    chartCtx.beginPath();
                    chartCtx.moveTo(x, chartCanvas.height - 50);
                    chartCtx.lineTo(x, 30);
                    chartCtx.stroke();
                }
            }
            
            // Y o'qi shkala (energiya)
            const ySteps = 6;
            for (let i = 0; i <= ySteps; i++) {
                const energy = (maxEnergy * i) / ySteps;
                const y = chartCanvas.height - 50 - (i / ySteps) * (chartCanvas.height - 80);
                
                // Shkala chizig'i
                chartCtx.strokeStyle = '#ddd';
                chartCtx.lineWidth = 1;
                chartCtx.beginPath();
                chartCtx.moveTo(60, y);
                chartCtx.lineTo(65, y);
                chartCtx.stroke();
                
                // Qiymat
                chartCtx.fillStyle = '#666';
                chartCtx.textAlign = 'right';
                chartCtx.fillText(energy.toFixed(1), 55, y + 4);
                
                // Grid chiziqlari
                if (i > 0) {
                    chartCtx.strokeStyle = '#f0f0f0';
                    chartCtx.lineWidth = 0.5;
                    chartCtx.beginPath();
                    chartCtx.moveTo(60, y);
                    chartCtx.lineTo(chartCanvas.width - 30, y);
                    chartCtx.stroke();
                }
            }
            
            // Parabola chizish
            chartCtx.strokeStyle = '#667eea';
            chartCtx.lineWidth = 3;
            chartCtx.beginPath();
            
            const step = maxVelocity / 200;
            for (let v = 0; v <= maxVelocity; v += step) {
                const energy = calculateKineticEnergy(mass, v);
                const x = 60 + (v / maxVelocity) * (chartCanvas.width - 90);
                const y = chartCanvas.height - 50 - (energy / maxEnergy) * (chartCanvas.height - 80);
                
                if (v === 0) {
                    chartCtx.moveTo(x, y);
                } else {
                    chartCtx.lineTo(x, y);
                }
            }
            chartCtx.stroke();

            // Joriy nuqta
            const currentX = 60 + (currentVelocity / maxVelocity) * (chartCanvas.width - 90);
            const currentY = chartCanvas.height - 50 - (currentEnergy / maxEnergy) * (chartCanvas.height - 80);
            
            // Nuqta halo effekti
            chartCtx.fillStyle = 'rgba(255, 107, 107, 0.3)';
            chartCtx.beginPath();
            chartCtx.arc(currentX, currentY, 12, 0, 2 * Math.PI);
            chartCtx.fill();
            
            // Asosiy nuqta
            chartCtx.fillStyle = '#ff6b6b';
            chartCtx.beginPath();
            chartCtx.arc(currentX, currentY, 8, 0, 2 * Math.PI);
            chartCtx.fill();
            
            // Nuqta markazidagi oq doira
            chartCtx.fillStyle = '#fff';
            chartCtx.beginPath();
            chartCtx.arc(currentX, currentY, 3, 0, 2 * Math.PI);
            chartCtx.fill();

            // Nuqta qiymati
            chartCtx.fillStyle = '#333';
            chartCtx.font = '12px Arial';
            chartCtx.textAlign = 'left';
            const labelX = currentX + 15;
            const labelY = Math.max(40, Math.min(chartCanvas.height - 60, currentY - 10));
            
            // Yozuv foni
            const text = `(${currentVelocity.toFixed(1)}, ${currentEnergy.toFixed(1)})`;
            const textWidth = chartCtx.measureText(text).width;
            chartCtx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            chartCtx.fillRect(labelX - 5, labelY - 15, textWidth + 10, 20);
            chartCtx.strokeStyle = '#ddd';
            chartCtx.lineWidth = 1;
            chartCtx.strokeRect(labelX - 5, labelY - 15, textWidth + 10, 20);
            
            // Yozuv
            chartCtx.fillStyle = '#333';
            chartCtx.fillText(text, labelX, labelY);
            
            // Nuqtadan yozuvga chiziq
            chartCtx.strokeStyle = '#ff6b6b';
            chartCtx.lineWidth = 1;
            chartCtx.setLineDash([3, 3]);
            chartCtx.beginPath();
            chartCtx.moveTo(currentX + 8, currentY);
            chartCtx.lineTo(labelX - 5, labelY - 5);
            chartCtx.stroke();
            chartCtx.setLineDash([]);
            
            // Masshtab ma'lumoti
            chartCtx.fillStyle = '#999';
            chartCtx.font = '10px Arial';
            chartCtx.textAlign = 'right';
            chartCtx.fillText(`Masshtab: ${graphScale}`, chartCanvas.width - 10, 20);
        }

        // Animatsiya (maydondan chiqmaslik uchun)
        function startAnimation() {
            if (isAnimating) return;
            
            isAnimating = true;
            objectPosition = 0;
            trails = [];
            animationStartTime = Date.now();
            trailCtx.clearRect(0, 0, trailCanvas.width, trailCanvas.height);
            
            const velocity = parseFloat(velocitySlider.value);
            const speed = Math.max(0.5, velocity * 1.5); // Animatsiya tezligi
            
            function animate() {
                if (!isAnimating) return;
                
                currentTime = (Date.now() - animationStartTime) / 1000;
                timeDisplay.textContent = currentTime.toFixed(1);
                
                objectPosition += speed;
                
                // Obyekt pozitsiyasi - maydondan chiqmaslik uchun
                const container = document.getElementById('animationContainer');
                const containerWidth = container.offsetWidth;
                const objectWidth = movingObject.offsetWidth;
                const maxPosition = containerWidth - objectWidth - 20;
                
                if (objectPosition > maxPosition) {
                    objectPosition = -objectWidth;
                    // Izlarni tozalash
                    trails = [];
                    trailCtx.clearRect(0, 0, trailCanvas.width, trailCanvas.height);
                    animationStartTime = Date.now(); // Vaqtni qayta boshlash
                }
                
                // Pozitsiya ko'rsatish
                const realPosition = (objectPosition / maxPosition) * 100;
                positionDisplay.textContent = Math.max(0, realPosition).toFixed(1);
                
                movingObject.style.left = objectPosition + 'px';
                movingObject.style.top = (container.offsetHeight / 2 - movingObject.offsetHeight / 2) + 'px';
                
                // Iz qoldirish
                if (velocity > 0) {
                    trails.push({
                        x: objectPosition + objectWidth / 2,
                        y: container.offsetHeight / 2,
                        time: Date.now(),
                        velocity: velocity
                    });
                    
                    // Eski izlarni olib tashlash
                    trails = trails.filter(trail => Date.now() - trail.time < 1500);
                    
                    // Izlarni chizish
                    trailCtx.clearRect(0, 0, trailCanvas.width, trailCanvas.height);
                    trails.forEach((trail, index) => {
                        const age = Date.now() - trail.time;
                        const alpha = Math.max(0, 1 - age / 1500);
                        const intensity = Math.min(1, trail.velocity / 10);
                        
                        // Tezlikga qarab rang
                        const red = Math.floor(255 * intensity);
                        const green = Math.floor(107 * intensity);
                        const blue = Math.floor(107 * intensity);
                        
                        trailCtx.fillStyle = `rgba(${red}, ${green}, ${blue}, ${alpha})`;
                        trailCtx.fillRect(trail.x - 3, trail.y - 2, 6, 4);
                    });
                }
                
                animationId = requestAnimationFrame(animate);
            }
            
            animate();
        }

        function resetAnimation() {
            isAnimating = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            objectPosition = 0;
            trails = [];
            currentTime = 0;
            trailCtx.clearRect(0, 0, trailCanvas.width, trailCanvas.height);
            movingObject.style.left = '10px';
            movingObject.style.top = '175px';
            timeDisplay.textContent = '0.0';
            positionDisplay.textContent = '0';
        }

        // Event listenerlar
        massSlider.addEventListener('input', updateValues);
        velocitySlider.addEventListener('input', updateValues);
        objectTypeSelect.addEventListener('change', updateValues);

        // Grafik interaktivligi
        chartCanvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            if (graphScale === 'zoom') {
                zoomLevel += e.deltaY > 0 ? -0.1 : 0.1;
                zoomLevel = Math.max(0.5, Math.min(5, zoomLevel));
                drawEnergyChart();
            }
        });

        // Grafik ustiga sichqoncha harakati
        chartCanvas.addEventListener('mousemove', (e) => {
            const rect = chartCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Grafik hududi ichida ekanligini tekshirish
            if (x >= 60 && x <= chartCanvas.width - 30 && y >= 30 && y <= chartCanvas.height - 50) {
                chartCanvas.style.cursor = 'crosshair';
                
                // Sichqoncha pozitsiyasiga mos keladigan qiymatlarni hisoblash
                const mass = parseFloat(massSlider.value);
                let maxVelocity;
                
                switch(graphScale) {
                    case 'auto':
                        maxVelocity = Math.max(20, parseFloat(velocitySlider.value) * 1.5, 10);
                        break;
                    case 'fixed':
                        maxVelocity = 20;
                        break;
                    case 'zoom':
                        const currentVelocity = parseFloat(velocitySlider.value);
                        const zoomRange = Math.max(3, currentVelocity * 0.8);
                        maxVelocity = currentVelocity + zoomRange;
                        break;
                }
                
                const mouseVelocity = ((x - 60) / (chartCanvas.width - 90)) * maxVelocity;
                const mouseEnergy = calculateKineticEnergy(mass, mouseVelocity);
                
                // Tooltip ko'rsatish
                const tooltip = document.getElementById('chartTooltip') || createTooltip();
                tooltip.style.display = 'block';
                tooltip.style.left = (e.clientX + 10) + 'px';
                tooltip.style.top = (e.clientY - 10) + 'px';
                tooltip.innerHTML = `Tezlik: ${mouseVelocity.toFixed(1)} m/s<br>Energiya: ${mouseEnergy.toFixed(1)} J`;
            } else {
                chartCanvas.style.cursor = 'default';
                const tooltip = document.getElementById('chartTooltip');
                if (tooltip) tooltip.style.display = 'none';
            }
        });

        chartCanvas.addEventListener('mouseleave', () => {
            chartCanvas.style.cursor = 'default';
            const tooltip = document.getElementById('chartTooltip');
            if (tooltip) tooltip.style.display = 'none';
        });

        // Tooltip yaratish
        function createTooltip() {
            const tooltip = document.createElement('div');
            tooltip.id = 'chartTooltip';
            tooltip.style.cssText = `
                position: absolute;
                background: rgba(0,0,0,0.8);
                color: white;
                padding: 8px 12px;
                border-radius: 6px;
                font-size: 12px;
                pointer-events: none;
                z-index: 1000;
                display: none;
                border: 1px solid #555;
            `;
            document.body.appendChild(tooltip);
            return tooltip;
        }

        // Boshlang'ich qiymatlarni o'rnatish
        updateValues();

        // Real vaqt energiya hisoblagichi
        setInterval(() => {
            if (isAnimating) {
                const currentTime = new Date().toLocaleTimeString();
                const mass = parseFloat(massSlider.value);
                const velocity = parseFloat(velocitySlider.value);
                const energy = calculateKineticEnergy(mass, velocity);
                
                console.log(`${currentTime}: Massa=${mass}kg, Tezlik=${velocity}m/s, Energiya=${energy.toFixed(2)}J`);
            }
        }, 1000);

        // Klaviatura boshqaruvi
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowUp':
                    velocitySlider.value = Math.min(20, parseFloat(velocitySlider.value) + 0.5);
                    updateValues();
                    break;
                case 'ArrowDown':
                    velocitySlider.value = Math.max(0, parseFloat(velocitySlider.value) - 0.5);
                    updateValues();
                    break;
                case 'ArrowRight':
                    massSlider.value = Math.min(10, parseFloat(massSlider.value) + 0.1);
                    updateValues();
                    break;
                case 'ArrowLeft':
                    massSlider.value = Math.max(0.1, parseFloat(massSlider.value) - 0.1);
                    updateValues();
                    break;
                case ' ':
                    e.preventDefault();
                    if (isAnimating) {
                        resetAnimation();
                    } else {
                        startAnimation();
                    }
                    break;
            }
        });
    </script>
</body>
</html>

