<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, touch-action=manipulation">
    <title>2.4 Statik ishqalanish kuchi</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --accent-color: #ff6b6b;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --error-color: #f44336;
            --text-color: #333;
            --bg-color: #f5f5f5;
            --white: #ffffff;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            padding: 8px;
            color: var(--text-color);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 16px);
        }

        .header {
            background: linear-gradient(135deg, var(--accent-color), #ee5a24);
            color: var(--white);
            padding: 16px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 12px;
            gap: 16px;
        }

        .simulation-area {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 16px;
            box-shadow: var(--shadow);
            order: 1;
        }

        .canvas-container {
            position: relative;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            overflow: hidden;
            touch-action: none;
        }

        #simulationCanvas {
            width: 100%;
            height: 280px;
            display: block;
            cursor: crosshair;
        }

        .controls-section {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 16px;
            box-shadow: var(--shadow);
            order: 2;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }

        .control-group {
            background: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 16px;
            border: 1px solid #e9ecef;
        }

        .control-group h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .slider-container {
            position: relative;
            margin-bottom: 16px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .slider-value {
            background: var(--primary-color);
            color: var(--white);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            min-width: 60px;
            text-align: center;
        }

        .slider {
            width: 100%;
            height: 44px;
            -webkit-appearance: none;
            appearance: none;
            background: #ddd;
            border-radius: 22px;
            outline: none;
            cursor: pointer;
            position: relative;
            transition: var(--transition);
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 44px;
            height: 44px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
        }

        .slider::-webkit-slider-thumb:hover {
            background: var(--secondary-color);
            transform: scale(1.1);
        }

        .slider::-moz-range-thumb {
            width: 44px;
            height: 44px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
        }

        .button-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            min-width: 80px;
            padding: 12px 16px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            touch-action: manipulation;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .btn-primary {
            background: var(--primary-color);
            color: var(--white);
        }

        .btn-primary:hover, .btn-primary:focus {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .btn-secondary {
            background: #6c757d;
            color: var(--white);
        }

        .btn-secondary:hover, .btn-secondary:focus {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success-color);
            color: var(--white);
        }

        .btn-success:hover, .btn-success:focus {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: var(--warning-color);
            color: var(--white);
        }

        .btn-warning:hover, .btn-warning:focus {
            background: #f57c00;
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .data-display {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 16px;
            box-shadow: var(--shadow);
            order: 3;
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }

        .data-item {
            background: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 12px;
            text-align: center;
            border: 1px solid #e9ecef;
            transition: var(--transition);
        }

        .data-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .data-label {
            font-size: 0.8rem;
            color: #6c757d;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .data-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-color);
        }

        .data-unit {
            font-size: 0.8rem;
            color: #6c757d;
            margin-left: 4px;
        }

        .chart-container {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 16px;
            box-shadow: var(--shadow);
            order: 4;
        }

        #chartCanvas {
            width: 100%;
            height: 200px;
            border-radius: var(--border-radius);
            background: #f8f9fa;
        }

        .info-panels {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            order: 5;
        }

        .info-panel {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 16px;
            box-shadow: var(--shadow);
        }

        .info-panel h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .formula-box {
            background: #f8f9fa;
            border-left: 4px solid var(--primary-color);
            padding: 12px;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            margin: 12px 0;
            font-family: 'Courier New', monospace;
        }

        .color-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: #f8f9fa;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid var(--white);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 8px;
        }

        .status-static {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success-color);
        }

        .status-moving {
            background: rgba(255, 152, 0, 0.1);
            color: var(--warning-color);
        }

        .status-critical {
            background: rgba(244, 67, 54, 0.1);
            color: var(--error-color);
        }

        .help-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: var(--primary-color);
            color: var(--white);
            border: none;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
            z-index: 1000;
        }

        .help-button:hover {
            background: var(--secondary-color);
            transform: scale(1.1);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 24px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e9ecef;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6c757d;
            padding: 4px;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-color);
            color: var(--white);
            padding: 12px 24px;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            z-index: 3000;
            opacity: 0;
            transition: var(--transition);
        }

        .toast.show {
            opacity: 1;
        }

        .loading-spinner {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .accessibility-skip {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--text-color);
            color: var(--white);
            padding: 8px;
            text-decoration: none;
            border-radius: var(--border-radius);
            z-index: 1000;
            transition: var(--transition);
        }

        .accessibility-skip:focus {
            top: 6px;
        }

        /* Tablet styles */
        @media (min-width: 768px) {
            body {
                padding: 16px;
            }

            .header {
                padding: 24px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .main-content {
                padding: 20px;
                gap: 20px;
            }

            .controls-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            #simulationCanvas {
                height: 400px;
            }

            #chartCanvas {
                height: 300px;
            }

            .info-panels {
                grid-template-columns: repeat(2, 1fr);
            }

            .modal-content {
                max-width: 600px;
            }
        }

        /* Desktop styles */
        @media (min-width: 1024px) {
            body {
                padding: 24px;
            }

            .main-content {
                flex-direction: row;
                flex-wrap: wrap;
                align-items: flex-start;
            }

            .simulation-area {
                flex: 2;
                min-width: 0;
                order: 1;
            }

            .controls-section {
                flex: 1;
                min-width: 300px;
                order: 2;
            }

            .data-display {
                flex: 1;
                min-width: 300px;
                order: 3;
            }

            .chart-container {
                flex: 2;
                min-width: 0;
                order: 4;
            }

            .info-panels {
                flex: 3;
                order: 5;
            }

            #simulationCanvas {
                height: 500px;
            }

            .controls-grid {
                grid-template-columns: 1fr;
            }

            .info-panels {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Large desktop */
        @media (min-width: 1440px) {
            .container {
                max-width: 1400px;
            }

            #simulationCanvas {
                height: 600px;
            }

            #chartCanvas {
                height: 400px;
            }
        }

        /* High DPI displays */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            #simulationCanvas,
            #chartCanvas {
                image-rendering: pixelated;
            }
        }

        /* Landscape orientation on mobile */
        @media (orientation: landscape) and (max-height: 600px) {
            .main-content {
                flex-direction: row;
                flex-wrap: wrap;
            }

            .simulation-area {
                flex: 1;
                min-width: 50%;
            }

            .controls-section {
                flex: 1;
                min-width: 50%;
            }

            #simulationCanvas {
                height: 250px;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --text-color: #e0e0e0;
                --bg-color: #121212;
                --white: #1e1e1e;
            }

            .control-group,
            .data-item,
            .formula-box,
            .legend-item {
                background: #2a2a2a;
                border-color: #444;
            }

            .canvas-container,
            #chartCanvas {
                background: #2a2a2a;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* High contrast support */
        @media (prefers-contrast: high) {
            :root {
                --primary-color: #0066cc;
                --secondary-color: #004499;
                --accent-color: #cc0000;
            }

            .btn {
                border: 2px solid currentColor;
            }
        }
    </style>

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .simulation-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
        }

        .canvas-container {
            position: relative;
            background: #e8f4f8;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #3498db;
        }

        canvas {
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            display: block;
            margin: 0 auto;
            cursor: pointer;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .control-group {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .control-group h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .slider-container {
            margin: 15px 0;
        }

        .slider-container label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .value-display {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            margin-left: 10px;
            font-weight: bold;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(149, 165, 166, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .info-panel {
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
        }

        .info-panel h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .graph-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .status-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .status-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .status-item .label {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .status-item .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
        }

        .formula-display {
            background: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            margin: 15px 0;
            text-align: center;
        }

        .moving {
            animation: shake 0.5s ease-in-out infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        .theory-section {
            background: #f8f9fa;
            padding: 25px;
            margin: 20px 0;
            border-radius: 10px;
            border-left: 4px solid #e74c3c;
        }

        .theory-section h3 {
            color: #c0392b;
            margin-bottom: 15px;
        }

        .theory-section p {
            line-height: 1.6;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .controls {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="accessibility-skip">Skip to main content</a>
    
    <div class="container">
        <div class="header">
            <h1>2.4 Statik ishqalanish kuchi</h1>
            <p>Interaktiv simulyatsiya va ta'lim tizimi</p>
        </div>

        <div class="main-content" id="main-content">
            <div class="simulation-area">
                <h2>🔬 Simulyatsiya</h2>
                <div class="canvas-container">
                    <canvas id="simulationCanvas" width="800" height="400" 
                            role="img" 
                            aria-label="Statik ishqalanish kuchi simulyatsiyasi"
                            tabindex="0">
                        Brauzeringiz canvas elementini qo'llab-quvvatlamaydi
                    </canvas>
                    <div class="loading-spinner" id="loadingSpinner"></div>
                </div>
                <div class="status-indicator" id="statusIndicator">
                    <span id="statusText">Harakatsiz</span>
                </div>
            </div>

            <div class="controls-section">
                <div class="controls-grid">
                    <div class="control-group">
                        <h3>⚙️ Parametrlar</h3>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Massa (m)</span>
                                <span class="slider-value" id="massValue">5.0 kg</span>
                            </div>
                            <input type="range" class="slider" id="massSlider" 
                                   min="1" max="20" value="5" step="0.1"
                                   aria-label="Jism massasi"
                                   aria-describedby="massValue">
                        </div>

                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Ishqalanish koeffitsienti (μₛ)</span>
                                <span class="slider-value" id="muValue">0.30</span>
                            </div>
                            <input type="range" class="slider" id="muSlider" 
                                   min="0.1" max="1.0" value="0.3" step="0.01"
                                   aria-label="Statik ishqalanish koeffitsienti"
                                   aria-describedby="muValue">
                        </div>

                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Qo'llangan kuch (F)</span>
                                <span class="slider-value" id="forceValue">0.0 N</span>
                            </div>
                            <input type="range" class="slider" id="forceSlider" 
                                   min="0" max="50" value="0" step="0.1"
                                   aria-label="Qo'llangan kuch"
                                   aria-describedby="forceValue">
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>🎮 Boshqaruv</h3>
                        
                        <div class="button-group">
                            <button class="btn btn-primary" id="playBtn" 
                                    aria-label="Simulyatsiyani boshlash">
                                ▶️ Boshlash
                            </button>
                            <button class="btn btn-secondary" id="pauseBtn" 
                                    aria-label="Simulyatsiyani pauza qilish">
                                ⏸️ Pauza
                            </button>
                            <button class="btn btn-warning" id="resetBtn" 
                                    aria-label="Simulyatsiyani qayta boshlash">
                                🔄 Reset
                            </button>
                        </div>

                        <div class="button-group">
                            <button class="btn btn-secondary" id="stepBtn" 
                                    aria-label="Qadam-qadam ko'rsatish">
                                ⏭️ Qadam
                            </button>
                            <button class="btn btn-secondary" id="toggleVectorsBtn" 
                                    aria-label="Vektorlarni ko'rsatish/yashirish">
                                🔍 Vektorlar
                            </button>
                            <button class="btn btn-secondary" id="toggleGraphBtn" 
                                    aria-label="Grafikni ko'rsatish/yashirish">
                                📊 Grafik
                            </button>
                        </div>

                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Animatsiya tezligi</span>
                                <span class="slider-value" id="speedValue">1.0x</span>
                            </div>
                            <input type="range" class="slider" id="speedSlider" 
                                   min="0.1" max="3.0" value="1.0" step="0.1"
                                   aria-label="Animatsiya tezligi"
                                   aria-describedby="speedValue">
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <h3>📥 Eksport</h3>
                    <div class="button-group">
                        <button class="btn btn-success" id="exportDataBtn" 
                                aria-label="Ma'lumotlarni eksport qilish">
                            💾 Ma'lumotlar
                        </button>
                        <button class="btn btn-success" id="screenshotBtn" 
                                aria-label="Skrinshot olish">
                            📸 Rasm
                        </button>
                    </div>
                </div>
            </div>

            <div class="data-display">
                <h3>📊 Real vaqt ma'lumotlari</h3>
                <div class="data-grid">
                    <div class="data-item">
                        <div class="data-label">Normal kuch</div>
                        <div class="data-value" id="normalForce">49.0<span class="data-unit">N</span></div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Maksimal statik ishqalanish</div>
                        <div class="data-value" id="maxStaticFriction">14.7<span class="data-unit">N</span></div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Joriy ishqalanish</div>
                        <div class="data-value" id="currentFriction">0.0<span class="data-unit">N</span></div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Natijaviy kuch</div>
                        <div class="data-value" id="netForce">0.0<span class="data-unit">N</span></div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Kritik nuqtagacha</div>
                        <div class="data-value" id="criticalDistance">14.7<span class="data-unit">N</span></div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Holat</div>
                        <div class="data-value" id="objectStatus">Harakatsiz</div>
                    </div>
                </div>
            </div>

            <div class="chart-container" id="chartContainer">
                <h3>📈 Kuch vs Ishqalanish grafigi</h3>
                <canvas id="chartCanvas" width="800" height="300" 
                        role="img" 
                        aria-label="Kuch va ishqalanish o'zgarishi grafigi"
                        tabindex="0">
                    Brauzeringiz canvas elementini qo'llab-quvvatlamaydi
                </canvas>
            </div>

            <div class="info-panels">
                <div class="info-panel">
                    <h3>📚 Nazariy asoslar</h3>
                    <p><strong>Statik ishqalanish kuchi</strong> - bu jism harakat qilmagan holda, unga ta'sir etuvchi kuchga qarshi turadigan ishqalanish kuchi.</p>
                    
                    <div class="formula-box">
                        <strong>Asosiy formulalar:</strong><br>
                        $f_s \leq \mu_s N$<br>
                        $N = mg$ (gorizontal sirtda)<br>
                        $f_{s,max} = \mu_s N$
                    </div>
                    
                    <p><strong>Bu yerda:</strong></p>
                    <ul>
                        <li>$f_s$ - statik ishqalanish kuchi</li>
                        <li>$\mu_s$ - statik ishqalanish koeffitsienti</li>
                        <li>$N$ - normal kuch</li>
                        <li>$m$ - jism massasi</li>
                        <li>$g$ - og'irlik kuchi tezlanishi (9.8 m/s²)</li>
                    </ul>
                </div>

                <div class="info-panel">
                    <h3>🎯 Ishqalanish turlari</h3>
                    <p><strong>Statik ishqalanish:</strong> Jism harakatsiz holatda bo'lganda yuzaga keladi.</p>
                    <p><strong>Kinetik ishqalanish:</strong> Jism harakatda bo'lganda paydo bo'ladi.</p>
                    <p><strong>Muhim:</strong> Statik ishqalanish koeffitsienti odatda kinetik ishqalanish koeffitsientidan katta bo'ladi.</p>
                    
                    <div class="formula-box">
                        <strong>Kritik shart:</strong><br>
                        Agar $F > f_{s,max}$ bo'lsa, jism harakatga keladi
                    </div>
                </div>

                <div class="info-panel">
                    <h3>🌈 Ranglar ma'nosi</h3>
                    <div class="color-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #4CAF50;"></div>
                            <span>Statik holat</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #FF9800;"></div>
                            <span>Kritik nuqta</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #F44336;"></div>
                            <span>Harakat boshlanishi</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #2196F3;"></div>
                            <span>Qo'llangan kuch</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #9C27B0;"></div>
                            <span>Ishqalanish kuchi</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button class="help-button" id="helpBtn" aria-label="Yordam" title="Yordam">
        ❓
    </button>

    <div class="modal" id="helpModal" role="dialog" aria-labelledby="helpModalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="helpModalTitle">📖 Yordam va ko'rsatmalar</h2>
                <button class="modal-close" id="closeHelpModal" aria-label="Yopish">&times;</button>
            </div>
            <div class="modal-body">
                <h3>🎮 Boshqaruv usullari</h3>
                <ul>
                    <li><strong>Slayder:</strong> Parametrlarni o'zgartirish uchun</li>
                    <li><strong>Tugmalar:</strong> Simulyatsiyani boshqarish uchun</li>
                    <li><strong>Canvas:</strong> Sensorli ekranlarda teginish orqali kuch o'zgartirish</li>
                </ul>
                
                <h3>⌨️ Klaviatura yorliqlari</h3>
                <ul>
                    <li><strong>Space:</strong> Boshlash/Pauza</li>
                    <li><strong>R:</strong> Reset</li>
                    <li><strong>S:</strong> Qadam-qadam</li>
                    <li><strong>V:</strong> Vektorlarni ko'rsatish/yashirish</li>
                    <li><strong>G:</strong> Grafikni ko'rsatish/yashirish</li>
                </ul>
                
                <h3>📱 Mobil foydalanish</h3>
                <ul>
                    <li>Barcha tugmalar va slayderlar sensorli ekranlar uchun optimallashtirilgan</li>
                    <li>Gorizontal va vertikal orientatsiyalarni qo'llab-quvvatlaydi</li>
                    <li>Pinch-to-zoom va swipe gesture'lari</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="toast" id="toast" role="alert" aria-live="polite"></div>
                    <li><strong>Kinetik ishqalanish (fₖ):</strong> Chap tomonga ← (harakatga qarshi)</li>
                    <li><strong>Normal kuch (N):</strong> Yuqoriga ↑ (sirtga perpendikulyar)</li>
                    <li><strong>Og'irlik kuchi (mg):</strong> Pastga ↓ (gravitatsiya yo'nalishi)</li>
                </ul>
                <p><strong>Fizika qonunlari:</strong></p>
                <ul style="margin-left: 20px; line-height: 1.6;">
                    <li><strong>Statik holat:</strong> F = fₛ ≤ μₛN (muvozanat)</li>
                    <li><strong>Harakat boshlanishi:</strong> F > fₛ,max = μₛN</li>
                    <li><strong>Harakatda:</strong> F - fₖ = ma (Nyutonning II qonuni)</li>
                    <li><strong>Vertikal muvozanat:</strong> N = mg</li>
                </ul>
            </div>

            <div class="info-panel">
                <h3>Simulyatsiya haqida</h3>
                <p><strong>Qanday ishlaydi:</strong></p>
                <ul style="margin-left: 20px; line-height: 1.6;">
                    <li>Slayderlar yordamida massa va ishqalanish koeffitsientini o'zgartiring</li>
                    <li>"Kuchni oshirish" tugmasi bilan kuch asta-sekin oshadi</li>
                    <li>"Kuch diagrammasi" tugmasi bilan barcha kuchlarni ko'ring</li>
                    <li>"Qadam-qadam" rejimi har bir qadamda to'xtaydi</li>
                    <li>Grafik kuch va ishqalanish o'rtasidagi bog'liqlikni ko'rsatadi</li>
                </ul>
                <p><strong>Ranglar va yo'nalishlar:</strong></p>
                <ul style="margin-left: 20px; line-height: 1.6;">
                    <li>🔵 Ko'k blok - statik holat</li>
                    <li>🔴 Qizil blok - harakatda</li>
                    <li>🟢 Yashil strelka (→) - tortish kuchi (o'ngga)</li>
                    <li>🔴 Qizil strelka (←) - ishqalanish kuchi (chapga)</li>
                    <li>🔵 Ko'k strelka (↑) - normal kuch (yuqoriga)</li>
                    <li>🟦 To'q ko'k strelka (↓) - og'irlik kuchi (pastga)</li>
                    <li>🟡 Sariq chegara - kritik nuqta</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        class StaticFrictionSimulation {
            constructor() {
                this.canvas = document.getElementById('simulationCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.graphCanvas = document.getElementById('chartCanvas');
                this.graphCtx = this.graphCanvas.getContext('2d');
                
                // Physics parameters
                this.mass = 5.0;
                this.mu = 0.3;
                this.appliedForce = 0.0;
                this.gravity = 9.8;
                this.isRunning = false;
                this.animationId = null;
                this.forceIncrement = 0.1;
                this.animationSpeed = 1.0;
                this.stepMode = false;
                
                // Visual parameters
                this.blockX = 200;
                this.blockY = 200;
                this.blockWidth = 80;
                this.blockHeight = 60;
                this.surfaceY = 260;
                this.showVectors = true;
                this.showGraph = true;
                this.isMoving = false;
                this.velocity = 0;
                this.acceleration = 0;
                
                // Data storage
                this.graphData = [];
                this.maxDataPoints = 100;
                
                // Touch/mouse interaction
                this.isDragging = false;
                this.lastTouchX = 0;
                this.lastTouchY = 0;
                
                // Accessibility
                this.announceChanges = true;
                this.lastAnnouncement = '';
                
                // Initialize
                this.setupCanvas();
                this.initializeEventListeners();
                this.updateDisplay();
                this.draw();
                this.drawGraph();
                this.setupMathJax();
            }
            
            setupCanvas() {
                // Set up high DPI support
                const dpr = window.devicePixelRatio || 1;
                const rect = this.canvas.getBoundingClientRect();
                
                this.canvas.width = rect.width * dpr;
                this.canvas.height = rect.height * dpr;
                this.ctx.scale(dpr, dpr);
                
                // Graph canvas
                const graphRect = this.graphCanvas.getBoundingClientRect();
                this.graphCanvas.width = graphRect.width * dpr;
                this.graphCanvas.height = graphRect.height * dpr;
                this.graphCtx.scale(dpr, dpr);
                
                // Handle window resize
                window.addEventListener('resize', () => {
                    setTimeout(() => this.setupCanvas(), 100);
                });
            }
            
            setupMathJax() {
                // Initialize MathJax when available
                if (window.MathJax) {
                    window.MathJax.typesetPromise().then(() => {
                        console.log('MathJax formulalar yuklandi');
                    });
                }
            }
            
            initializeEventListeners() {
                // Slider controls
                document.getElementById('massSlider').addEventListener('input', (e) => {
                    this.mass = parseFloat(e.target.value);
                    this.updateDisplay();
                    this.draw();
                    this.announceChange(`Massa: ${this.mass.toFixed(1)} kg`);
                });
                
                document.getElementById('muSlider').addEventListener('input', (e) => {
                    this.mu = parseFloat(e.target.value);
                    this.updateDisplay();
                    this.draw();
                    this.announceChange(`Ishqalanish koeffitsienti: ${this.mu.toFixed(2)}`);
                });
                
                document.getElementById('forceSlider').addEventListener('input', (e) => {
                    this.appliedForce = parseFloat(e.target.value);
                    this.updateDisplay();
                    this.draw();
                    this.updateGraph();
                    this.announceChange(`Qo'llangan kuch: ${this.appliedForce.toFixed(1)} N`);
                });
                
                document.getElementById('speedSlider').addEventListener('input', (e) => {
                    this.animationSpeed = parseFloat(e.target.value);
                    document.getElementById('speedValue').textContent = this.animationSpeed.toFixed(1) + 'x';
                });
                
                // Button controls
                document.getElementById('playBtn').addEventListener('click', () => {
                    this.startSimulation();
                });
                
                document.getElementById('pauseBtn').addEventListener('click', () => {
                    this.pauseSimulation();
                });
                
                document.getElementById('resetBtn').addEventListener('click', () => {
                    this.resetSimulation();
                });
                
                document.getElementById('stepBtn').addEventListener('click', () => {
                    this.stepSimulation();
                });
                
                document.getElementById('toggleVectorsBtn').addEventListener('click', () => {
                    this.showVectors = !this.showVectors;
                    this.draw();
                    this.announceChange(`Vektorlar ${this.showVectors ? 'ko\'rsatilmoqda' : 'yashirilmoqda'}`);
                });
                
                document.getElementById('toggleGraphBtn').addEventListener('click', () => {
                    this.showGraph = !this.showGraph;
                    const chartContainer = document.getElementById('chartContainer');
                    chartContainer.style.display = this.showGraph ? 'block' : 'none';
                    this.announceChange(`Grafik ${this.showGraph ? 'ko\'rsatilmoqda' : 'yashirilmoqda'}`);
                });
                
                document.getElementById('exportDataBtn').addEventListener('click', () => {
                    this.exportData();
                });
                
                document.getElementById('screenshotBtn').addEventListener('click', () => {
                    this.takeScreenshot();
                });
                
                // Canvas touch/mouse interaction
                this.setupCanvasInteraction();
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'BUTTON') return;
                    
                    switch(e.key) {
                        case ' ':
                            e.preventDefault();
                            this.isRunning ? this.pauseSimulation() : this.startSimulation();
                            break;
                        case 'r':
                        case 'R':
                            this.resetSimulation();
                            break;
                        case 's':
                        case 'S':
                            this.stepSimulation();
                            break;
                        case 'v':
                        case 'V':
                            this.showVectors = !this.showVectors;
                            this.draw();
                            break;
                        case 'g':
                        case 'G':
                            this.showGraph = !this.showGraph;
                            const chartContainer = document.getElementById('chartContainer');
                            chartContainer.style.display = this.showGraph ? 'block' : 'none';
                            break;
                    }
                });
                
                // Modal controls
                document.getElementById('helpBtn').addEventListener('click', () => {
                    this.showHelpModal();
                });
                
                document.getElementById('closeHelpModal').addEventListener('click', () => {
                    this.hideHelpModal();
                });
                
                // Close modal on outside click
                document.getElementById('helpModal').addEventListener('click', (e) => {
                    if (e.target === document.getElementById('helpModal')) {
                        this.hideHelpModal();
                    }
                });
                
                // Preset scenarios
                this.createPresetButtons();
            }
            
            setupCanvasInteraction() {
                // Mouse events
                this.canvas.addEventListener('mousedown', (e) => this.handleInteractionStart(e));
                this.canvas.addEventListener('mousemove', (e) => this.handleInteractionMove(e));
                this.canvas.addEventListener('mouseup', () => this.handleInteractionEnd());
                this.canvas.addEventListener('mouseleave', () => this.handleInteractionEnd());
                
                // Touch events
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.handleInteractionStart(e.touches[0]);
                });
                
                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    this.handleInteractionMove(e.touches[0]);
                });
                
                this.canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.handleInteractionEnd();
                });
                
                // Keyboard navigation for canvas
                this.canvas.addEventListener('keydown', (e) => {
                    const step = 0.5;
                    switch(e.key) {
                        case 'ArrowUp':
                            this.appliedForce = Math.min(50, this.appliedForce + step);
                            break;
                        case 'ArrowDown':
                            this.appliedForce = Math.max(0, this.appliedForce - step);
                            break;
                        case 'ArrowLeft':
                            this.mu = Math.max(0.1, this.mu - 0.01);
                            break;
                        case 'ArrowRight':
                            this.mu = Math.min(1.0, this.mu + 0.01);
                            break;
                    }
                    this.updateDisplay();
                    this.draw();
                    this.updateGraph();
                });
            }
            
            handleInteractionStart(e) {
                this.isDragging = true;
                const rect = this.canvas.getBoundingClientRect();
                this.lastTouchX = e.clientX - rect.left;
                this.lastTouchY = e.clientY - rect.top;
                
                // Provide haptic feedback if available
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
            }
            
            handleInteractionMove(e) {
                if (!this.isDragging) return;
                
                const rect = this.canvas.getBoundingClientRect();
                const currentX = e.clientX - rect.left;
                const currentY = e.clientY - rect.top;
                
                // Calculate force based on horizontal movement
                const deltaX = currentX - this.lastTouchX;
                const forceChange = deltaX * 0.1;
                
                this.appliedForce = Math.max(0, Math.min(50, this.appliedForce + forceChange));
                
                this.lastTouchX = currentX;
                this.lastTouchY = currentY;
                
                this.updateDisplay();
                this.draw();
                this.updateGraph();
            }
            
            handleInteractionEnd() {
                this.isDragging = false;
            }
            
            createPresetButtons() {
                const controlGroup = document.createElement('div');
                controlGroup.className = 'control-group';
                controlGroup.innerHTML = `
                    <h3>🎯 Tayyor stsenariylar</h3>
                    <div class="button-group">
                        <button class="btn btn-secondary" id="preset1">Engil jism</button>
                        <button class="btn btn-secondary" id="preset2">Og'ir jism</button>
                        <button class="btn btn-secondary" id="preset3">Yuqori ishqalanish</button>
                    </div>
                `;
                
                document.querySelector('.controls-section .controls-grid').appendChild(controlGroup);
                
                document.getElementById('preset1').addEventListener('click', () => {
                    this.setPreset(2.0, 0.2, 0);
                });
                
                document.getElementById('preset2').addEventListener('click', () => {
                    this.setPreset(15.0, 0.4, 0);
                });
                
                document.getElementById('preset3').addEventListener('click', () => {
                    this.setPreset(5.0, 0.8, 0);
                });
            }
            
            setPreset(mass, mu, force) {
                this.mass = mass;
                this.mu = mu;
                this.appliedForce = force;
                
                document.getElementById('massSlider').value = mass;
                document.getElementById('muSlider').value = mu;
                document.getElementById('forceSlider').value = force;
                
                this.updateDisplay();
                this.draw();
                this.updateGraph();
                this.showToast('Tayyor stsenariy yuklandi');
            }
            
            startSimulation() {
                this.isRunning = true;
                document.getElementById('playBtn').textContent = '⏸️ Pauza';
                document.getElementById('playBtn').classList.remove('btn-primary');
                document.getElementById('playBtn').classList.add('btn-secondary');
                this.animate();
            }
            
            pauseSimulation() {
                this.isRunning = false;
                document.getElementById('playBtn').textContent = '▶️ Boshlash';
                document.getElementById('playBtn').classList.remove('btn-secondary');
                document.getElementById('playBtn').classList.add('btn-primary');
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                }
            }
            
            resetSimulation() {
                this.pauseSimulation();
                this.appliedForce = 0;
                this.isMoving = false;
                this.velocity = 0;
                this.acceleration = 0;
                this.blockX = 200;
                this.graphData = [];
                
                document.getElementById('forceSlider').value = 0;
                this.updateDisplay();
                this.draw();
                this.drawGraph();
                this.showToast('Simulyatsiya qayta boshlandi');
            }
            
            stepSimulation() {
                if (!this.isRunning) {
                    this.appliedForce += this.forceIncrement * this.animationSpeed;
                    if (this.appliedForce > 50) {
                        this.appliedForce = 50;
                    }
                    
                    document.getElementById('forceSlider').value = this.appliedForce;
                    this.updateDisplay();
                    this.draw();
                    this.updateGraph();
                }
            }
            
            animate() {
                if (!this.isRunning) return;
                
                this.appliedForce += this.forceIncrement * this.animationSpeed;
                
                if (this.appliedForce > 50) {
                    this.appliedForce = 50;
                    this.pauseSimulation();
                }
                
                document.getElementById('forceSlider').value = this.appliedForce;
                this.updateDisplay();
                this.draw();
                this.updateGraph();
                
                this.animationId = requestAnimationFrame(() => this.animate());
            }
            
            updateDisplay() {
                const normalForce = this.mass * this.gravity;
                const maxStaticFriction = this.mu * normalForce;
                const currentFriction = Math.min(this.appliedForce, maxStaticFriction);
                const netForce = this.appliedForce - currentFriction;
                const criticalDistance = maxStaticFriction - this.appliedForce;
                
                this.isMoving = this.appliedForce > maxStaticFriction;
                
                // Update slider values
                document.getElementById('massValue').textContent = this.mass.toFixed(1) + ' kg';
                document.getElementById('muValue').textContent = this.mu.toFixed(2);
                document.getElementById('forceValue').textContent = this.appliedForce.toFixed(1) + ' N';
                
                // Update data display
                document.getElementById('normalForce').innerHTML = normalForce.toFixed(1) + '<span class="data-unit">N</span>';
                document.getElementById('maxStaticFriction').innerHTML = maxStaticFriction.toFixed(1) + '<span class="data-unit">N</span>';
                document.getElementById('currentFriction').innerHTML = currentFriction.toFixed(1) + '<span class="data-unit">N</span>';
                document.getElementById('netForce').innerHTML = netForce.toFixed(1) + '<span class="data-unit">N</span>';
                document.getElementById('criticalDistance').innerHTML = Math.max(0, criticalDistance).toFixed(1) + '<span class="data-unit">N</span>';
                
                // Update status
                const statusText = this.isMoving ? 'Harakatda' : 'Harakatsiz';
                const statusClass = this.isMoving ? 'status-moving' : 'status-static';
                const criticalStatus = Math.abs(criticalDistance) < 1 ? 'status-critical' : statusClass;
                
                document.getElementById('objectStatus').textContent = statusText;
                document.getElementById('statusIndicator').className = `status-indicator ${criticalStatus}`;
                document.getElementById('statusText').textContent = statusText;
                
                // Update block position if moving
                if (this.isMoving) {
                    this.blockX += 0.5;
                    if (this.blockX > this.canvas.width - this.blockWidth) {
                        this.blockX = this.canvas.width - this.blockWidth;
                    }
                }
            }
            
            draw() {
                const ctx = this.ctx;
                const rect = this.canvas.getBoundingClientRect();
                const width = rect.width;
                const height = rect.height;
                
                // Clear canvas
                ctx.clearRect(0, 0, width, height);
                
                // Draw background
                const gradient = ctx.createLinearGradient(0, 0, 0, height);
                gradient.addColorStop(0, '#e3f2fd');
                gradient.addColorStop(1, '#bbdefb');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, width, height);
                
                // Draw surface
                ctx.fillStyle = '#8d6e63';
                ctx.fillRect(0, this.surfaceY, width, height - this.surfaceY);
                
                // Draw surface texture
                ctx.strokeStyle = '#5d4037';
                ctx.lineWidth = 2;
                for (let i = 0; i < width; i += 20) {
                    ctx.beginPath();
                    ctx.moveTo(i, this.surfaceY);
                    ctx.lineTo(i + 10, this.surfaceY - 5);
                    ctx.stroke();
                }
                
                // Draw block
                const blockColor = this.isMoving ? '#f44336' : '#2196f3';
                ctx.fillStyle = blockColor;
                ctx.fillRect(this.blockX, this.blockY, this.blockWidth, this.blockHeight);
                
                // Draw block border
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 3;
                ctx.strokeRect(this.blockX, this.blockY, this.blockWidth, this.blockHeight);
                
                // Draw block details
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 14px Inter';
                ctx.textAlign = 'center';
                ctx.fillText(`${this.mass.toFixed(1)} kg`, this.blockX + this.blockWidth/2, this.blockY + this.blockHeight/2 + 5);
                
                // Draw force vectors if enabled
                if (this.showVectors) {
                    this.drawVectors(ctx);
                }
                
                // Draw critical point indicator
                const maxStaticFriction = this.mu * this.mass * this.gravity;
                if (Math.abs(this.appliedForce - maxStaticFriction) < 2) {
                    ctx.strokeStyle = '#ff9800';
                    ctx.lineWidth = 4;
                    ctx.setLineDash([10, 5]);
                    ctx.strokeRect(this.blockX - 5, this.blockY - 5, this.blockWidth + 10, this.blockHeight + 10);
                    ctx.setLineDash([]);
                }
            }
            
            drawVectors(ctx) {
                const centerX = this.blockX + this.blockWidth / 2;
                const centerY = this.blockY + this.blockHeight / 2;
                const scale = 3;
                
                // Applied force (right)
                if (this.appliedForce > 0) {
                    this.drawArrow(ctx, centerX, centerY, centerX + this.appliedForce * scale, centerY, '#4caf50', 'F = ' + this.appliedForce.toFixed(1) + ' N');
                }
                
                // Friction force (left)
                const currentFriction = Math.min(this.appliedForce, this.mu * this.mass * this.gravity);
                if (currentFriction > 0) {
                    this.drawArrow(ctx, centerX, centerY, centerX - currentFriction * scale, centerY, '#9c27b0', 'fₛ = ' + currentFriction.toFixed(1) + ' N');
                }
                
                // Normal force (up)
                const normalForce = this.mass * this.gravity;
                this.drawArrow(ctx, centerX, centerY, centerX, centerY - normalForce * scale * 0.5, '#2196f3', 'N = ' + normalForce.toFixed(1) + ' N');
                
                // Weight (down)
                this.drawArrow(ctx, centerX, centerY, centerX, centerY + normalForce * scale * 0.5, '#ff5722', 'mg = ' + normalForce.toFixed(1) + ' N');
            }
            
            drawArrow(ctx, x1, y1, x2, y2, color, label) {
                const headlen = 15;
                const dx = x2 - x1;
                const dy = y2 - y1;
                const angle = Math.atan2(dy, dx);
                
                ctx.strokeStyle = color;
                ctx.fillStyle = color;
                ctx.lineWidth = 4;
                
                // Draw line
                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.stroke();
                
                // Draw arrow head
                ctx.beginPath();
                ctx.moveTo(x2, y2);
                ctx.lineTo(x2 - headlen * Math.cos(angle - Math.PI/6), y2 - headlen * Math.sin(angle - Math.PI/6));
                ctx.lineTo(x2 - headlen * Math.cos(angle + Math.PI/6), y2 - headlen * Math.sin(angle + Math.PI/6));
                ctx.closePath();
                ctx.fill();
                
                // Draw label
                ctx.fillStyle = color;
                ctx.font = 'bold 12px Inter';
                ctx.textAlign = 'center';
                
                const labelX = x2 + (dx > 0 ? 20 : -20);
                const labelY = y2 + (dy > 0 ? 20 : -20);
                
                // Draw label background
                const metrics = ctx.measureText(label);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                ctx.fillRect(labelX - metrics.width/2 - 5, labelY - 10, metrics.width + 10, 20);
                
                ctx.fillStyle = color;
                ctx.fillText(label, labelX, labelY + 5);
            }
            
            updateGraph() {
                const maxStaticFriction = this.mu * this.mass * this.gravity;
                const currentFriction = Math.min(this.appliedForce, maxStaticFriction);
                
                this.graphData.push({
                    appliedForce: this.appliedForce,
                    friction: currentFriction,
                    isMoving: this.isMoving
                });
                
                if (this.graphData.length > this.maxDataPoints) {
                    this.graphData.shift();
                }
                
                this.drawGraph();
            }
            
            drawGraph() {
                const ctx = this.graphCtx;
                const rect = this.graphCanvas.getBoundingClientRect();
                const width = rect.width;
                const height = rect.height;
                const padding = 40;
                
                // Clear canvas
                ctx.clearRect(0, 0, width, height);
                
                // Draw background
                ctx.fillStyle = '#f8f9fa';
                ctx.fillRect(0, 0, width, height);
                
                // Draw grid
                ctx.strokeStyle = '#e0e0e0';
                ctx.lineWidth = 1;
                
                // Vertical lines
                for (let i = 0; i <= 10; i++) {
                    const x = padding + (width - 2 * padding) * i / 10;
                    ctx.beginPath();
                    ctx.moveTo(x, padding);
                    ctx.lineTo(x, height - padding);
                    ctx.stroke();
                }
                
                // Horizontal lines
                for (let i = 0; i <= 10; i++) {
                    const y = padding + (height - 2 * padding) * i / 10;
                    ctx.beginPath();
                    ctx.moveTo(padding, y);
                    ctx.lineTo(width - padding, y);
                    ctx.stroke();
                }
                
                // Draw axes
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                
                // X-axis
                ctx.beginPath();
                ctx.moveTo(padding, height - padding);
                ctx.lineTo(width - padding, height - padding);
                ctx.stroke();
                
                // Y-axis
                ctx.beginPath();
                ctx.moveTo(padding, padding);
                ctx.lineTo(padding, height - padding);
                ctx.stroke();
                
                // Labels
                ctx.fillStyle = '#333';
                ctx.font = '12px Inter';
                ctx.textAlign = 'center';
                ctx.fillText('Qo\'llangan kuch (N)', width / 2, height - 10);
                
                ctx.save();
                ctx.translate(15, height / 2);
                ctx.rotate(-Math.PI / 2);
                ctx.fillText('Ishqalanish kuchi (N)', 0, 0);
                ctx.restore();
                
                // Draw ideal line (static friction)
                const maxStaticFriction = this.mu * this.mass * this.gravity;
                ctx.strokeStyle = '#4caf50';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                
                ctx.beginPath();
                ctx.moveTo(padding, height - padding);
                
                const criticalX = padding + (width - 2 * padding) * maxStaticFriction / 50;
                const criticalY = height - padding - (height - 2 * padding) * maxStaticFriction / 50;
                
                ctx.lineTo(criticalX, criticalY);
                ctx.lineTo(width - padding, criticalY);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Draw actual data
                if (this.graphData.length > 1) {
                    ctx.strokeStyle = '#2196f3';
                    ctx.lineWidth = 3;
                    
                    ctx.beginPath();
                    for (let i = 0; i < this.graphData.length; i++) {
                        const data = this.graphData[i];
                        const x = padding + (width - 2 * padding) * data.appliedForce / 50;
                        const y = height - padding - (height - 2 * padding) * data.friction / 50;
                        
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                        
                        // Draw point
                        ctx.fillStyle = data.isMoving ? '#f44336' : '#2196f3';
                        ctx.beginPath();
                        ctx.arc(x, y, 3, 0, 2 * Math.PI);
                        ctx.fill();
                    }
                    ctx.stroke();
                }
                
                // Draw legend
                ctx.fillStyle = '#333';
                ctx.font = '11px Inter';
                ctx.textAlign = 'left';
                
                ctx.fillStyle = '#4caf50';
                ctx.fillRect(width - 150, 20, 15, 3);
                ctx.fillStyle = '#333';
                ctx.fillText('Nazariy (fₛ = μₛN)', width - 130, 27);
                
                ctx.fillStyle = '#2196f3';
                ctx.fillRect(width - 150, 35, 15, 3);
                ctx.fillStyle = '#333';
                ctx.fillText('Haqiqiy', width - 130, 42);
                
                ctx.fillStyle = '#f44336';
                ctx.beginPath();
                ctx.arc(width - 142, 52, 3, 0, 2 * Math.PI);
                ctx.fill();
                ctx.fillStyle = '#333';
                ctx.fillText('Harakat', width - 130, 57);
            }
            
            exportData() {
                const data = {
                    parameters: {
                        mass: this.mass,
                        frictionCoefficient: this.mu,
                        gravity: this.gravity
                    },
                    measurements: this.graphData
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'statik_ishqalanish_data.json';
                a.click();
                URL.revokeObjectURL(url);
                
                this.showToast('Ma\'lumotlar eksport qilindi');
            }
            
            takeScreenshot() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = this.canvas.width;
                canvas.height = this.canvas.height;
                
                ctx.drawImage(this.canvas, 0, 0);
                
                canvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'statik_ishqalanish_screenshot.png';
                    a.click();
                    URL.revokeObjectURL(url);
                });
                
                this.showToast('Skrinshot saqlandi');
            }
            
            showHelpModal() {
                const modal = document.getElementById('helpModal');
                modal.style.display = 'block';
                modal.setAttribute('aria-hidden', 'false');
                document.body.style.overflow = 'hidden';
            }
            
            hideHelpModal() {
                const modal = document.getElementById('helpModal');
                modal.style.display = 'none';
                modal.setAttribute('aria-hidden', 'true');
                document.body.style.overflow = 'auto';
            }
            
            showToast(message) {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
            
            announceChange(message) {
                if (!this.announceChanges || this.lastAnnouncement === message) return;
                
                this.lastAnnouncement = message;
                
                // Use Web Speech API if available
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(message);
                    utterance.rate = 0.8;
                    utterance.volume = 0.3;
                    speechSynthesis.speak(utterance);
                }
                
                // Also show in toast for visual feedback
                this.showToast(message);
            }
        }
        
        // Initialize simulation when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Show loading spinner
            const loadingSpinner = document.getElementById('loadingSpinner');
            if (loadingSpinner) {
                loadingSpinner.style.display = 'block';
            }
            
            // Initialize simulation
            setTimeout(() => {
                window.simulation = new StaticFrictionSimulation();
                
                // Hide loading spinner
                if (loadingSpinner) {
                    loadingSpinner.style.display = 'none';
                }
                
                // Show welcome message
                if (window.simulation) {
                    window.simulation.showToast('Simulyatsiya tayyor!');
                }
            }, 500);
        });
        
        // Service Worker for offline support
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(console.error);
        }
    </script>
</body>
</html>
