<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noelastik To'qnashish</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 10px; }
        .container { max-width: 1200px; margin: 0 auto; background: rgba(255,255,255,0.95); border-radius: 20px; padding: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 20px; font-size: clamp(1.5rem, 4vw, 2.5rem); }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
        .panel { background: #f8f9fa; border-radius: 15px; padding: 20px; border: 2px solid #e9ecef; }
        .canvas-box { position: relative; width: 100%; height: 300px; background: #fff; border-radius: 10px; border: 2px solid #dee2e6; overflow: hidden; margin-bottom: 20px; }
        canvas { width: 100%; height: 100%; display: block; }
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px; }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; font-weight: 500; transition: all 0.3s; }
        .btn-primary { background: #007bff; color: white; }
        .btn-primary:hover { background: #0056b3; transform: translateY(-2px); }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; transform: translateY(-2px); }
        .btn-danger { background: #dc3545; color: white; }
        .btn-danger:hover { background: #c82333; transform: translateY(-2px); }
        .control { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .ctrl-box { background: #fff; padding: 15px; border-radius: 10px; border: 1px solid #dee2e6; }
        .ctrl-box h3 { color: #495057; margin-bottom: 10px; font-size: 1.1rem; }
        .input-grp { margin-bottom: 15px; }
        .input-grp label { display: block; margin-bottom: 5px; color: #6c757d; font-weight: 500; }
        input[type="range"] { width: 100%; height: 6px; border-radius: 3px; background: #e9ecef; outline: none; -webkit-appearance: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #007bff; cursor: pointer; }
        input[type="number"] { width: 100%; padding: 8px 12px; border: 2px solid #e9ecef; border-radius: 5px; font-size: 1rem; margin-top: 5px; }
        .data-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .data-item { background: #fff; padding: 10px; border-radius: 8px; border: 1px solid #dee2e6; text-align: center; }
        .data-item .label { color: #6c757d; font-size: 0.9rem; margin-bottom: 5px; }
        .data-item .value { color: #212529; font-size: 1.2rem; font-weight: bold; }
        .preset { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-bottom: 15px; }
        .preset-btn { padding: 8px 12px; border: 2px solid #007bff; background: transparent; color: #007bff; border-radius: 5px; cursor: pointer; transition: all 0.3s; font-size: 0.9rem; }
        .preset-btn:hover { background: #007bff; color: white; }
        .formula-box { background: #fff; border-radius: 10px; padding: 15px; border: 1px solid #dee2e6; margin-bottom: 15px; }
        .formula { background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 10px; text-align: center; }
        .theory { background: #e8f4f8; border-radius: 10px; padding: 15px; border: 1px solid #b8daff; }
        .theory h4 { color: #0c63e4; margin-bottom: 10px; }
        .theory p { color: #495057; line-height: 1.6; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Noelastik To'qnashish Simulyatsiyasi</h1>
        
        <div class="grid">
            <div class="panel">
                <h2>Simulyatsiya</h2>
                <div class="canvas-box">
                    <canvas id="canvas"></canvas>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" id="start">‚ñ∂Ô∏è Boshlash</button>
                    <button class="btn btn-secondary" id="pause">‚è∏Ô∏è Pauza</button>
                    <button class="btn btn-danger" id="reset">üîÑ Qayta</button>
                </div>
                
                <div class="input-grp">
                    <label>Tezlik: <span id="speedVal">1.0x</span></label>
                    <input type="range" id="speed" min="0.1" max="5" step="0.1" value="1">
                </div>
                
                <div class="preset">
                    <button class="preset-btn" onclick="setPreset('equal')">Teng</button>
                    <button class="preset-btn" onclick="setPreset('heavy')">Og'ir+Yengil</button>
                    <button class="preset-btn" onclick="setPreset('light')">Yengil+Og'ir</button>
                    <button class="preset-btn" onclick="setPreset('fast')">Tez</button>
                </div>
            </div>
            
            <div class="panel">
                <h3>üìä Ma'lumotlar</h3>
                <div class="data-grid">
                    <div class="data-item"><div class="label">Impuls</div><div class="value" id="p">0</div></div>
                    <div class="data-item"><div class="label">Bosh E</div><div class="value" id="e0">0</div></div>
                    <div class="data-item"><div class="label">Oxir E</div><div class="value" id="e1">0</div></div>
                    <div class="data-item"><div class="label">Yo'qolish</div><div class="value" id="loss">0</div></div>
                    <div class="data-item"><div class="label">V final</div><div class="value" id="vf">0</div></div>
                    <div class="data-item"><div class="label">Deform</div><div class="value" id="def">0%</div></div>
                </div>
                <div class="canvas-box" style="height:200px;">
                    <canvas id="chart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="control">
            <div class="ctrl-box">
                <h3>üî¥ Birinchi Jism</h3>
                <div class="input-grp">
                    <label>Massa (kg)</label>
                    <input type="range" id="m1" min="0.1" max="10" step="0.1" value="2">
                    <input type="number" id="m1n" min="0.1" max="10" step="0.1" value="2">
                </div>
                <div class="input-grp">
                    <label>Tezlik (m/s)</label>
                    <input type="range" id="v1" min="-10" max="10" step="0.1" value="3">
                    <input type="number" id="v1n" min="-10" max="10" step="0.1" value="3">
                </div>
            </div>
            
            <div class="ctrl-box">
                <h3>üîµ Ikkinchi Jism</h3>
                <div class="input-grp">
                    <label>Massa (kg)</label>
                    <input type="range" id="m2" min="0.1" max="10" step="0.1" value="3">
                    <input type="number" id="m2n" min="0.1" max="10" step="0.1" value="3">
                </div>
                <div class="input-grp">
                    <label>Tezlik (m/s)</label>
                    <input type="range" id="v2" min="-10" max="10" step="0.1" value="-2">
                    <input type="number" id="v2n" min="-10" max="10" step="0.1" value="-2">
                </div>
            </div>
        </div>
        
        <div class="formula-box">
            <h4>üìê Formulalar</h4>
            <div class="formula"><strong>Impuls:</strong> m‚ÇÅv‚ÇÅ + m‚ÇÇv‚ÇÇ = (m‚ÇÅ + m‚ÇÇ)v'</div>
            <div class="formula"><strong>V final:</strong> v' = (m‚ÇÅv‚ÇÅ + m‚ÇÇv‚ÇÇ) / (m‚ÇÅ + m‚ÇÇ)</div>
            <div class="formula"><strong>ŒîE:</strong> ¬Ωm‚ÇÅv‚ÇÅ¬≤ + ¬Ωm‚ÇÇv‚ÇÇ¬≤ - ¬Ω(m‚ÇÅ + m‚ÇÇ)v'¬≤</div>
        </div>
        
        <div class="theory">
            <h4>üìö Nazariya</h4>
            <p><strong>Noelastik to'qnashish</strong> - jismlar birlashib ketadigan to'qnashish. Impuls saqlanadi, energiya yo'qoladi.</p>
            <p><strong>e = 0</strong> - to'liq noelastik to'qnashish koeffitsienti.</p>
            <p><strong>Misollar:</strong> Loy to'pi, avtohalokatlar, meteor qulashi.</p>
        </div>
    </div>

    <script>
        class Sim {
            constructor() {
                this.c = document.getElementById('canvas');
                this.ctx = this.c.getContext('2d');
                this.ch = document.getElementById('chart');
                this.chx = this.ch.getContext('2d');
                this.resize();
                window.addEventListener('resize', () => this.resize());
                
                this.o1 = {x:100, x0:100, y:150, r:30, c:'#ff4757', m:2, v:3, v0:3};
                this.o2 = {x:400, x0:400, y:150, r:30, c:'#3742fa', m:3, v:-2, v0:-2};
                this.run = false;
                this.t = 0;
                this.spd = 1;
                this.hit = false;
                this.hitPt = null;
                this.dfm = 0;
                this.eData = [];
                
                this.setupEvents();
                this.calc();
                this.draw();
            }
            
            resize() {
                this.c.width = this.c.parentElement.offsetWidth;
                this.c.height = this.c.parentElement.offsetHeight;
                this.ch.width = this.ch.parentElement.offsetWidth;
                this.ch.height = this.ch.parentElement.offsetHeight;
            }
            
            setupEvents() {
                document.getElementById('start').onclick = () => this.start();
                document.getElementById('pause').onclick = () => this.pause();
                document.getElementById('reset').onclick = () => this.reset();
                
                const spd = document.getElementById('speed');
                spd.oninput = (e) => {
                    this.spd = parseFloat(e.target.value);
                    document.getElementById('speedVal').textContent = this.spd.toFixed(1) + 'x';
                };
                
                this.syncInput('m1'); this.syncInput('v1');
                this.syncInput('m2'); this.syncInput('v2');
                
                ['m1','v1','m2','v2'].forEach(id => {
                    document.getElementById(id).oninput = () => {
                        this.calc();
                        if(!this.run) this.draw();
                    };
                });
            }
            
            syncInput(n) {
                const s = document.getElementById(n);
                const i = document.getElementById(n + 'n');
                s.oninput = () => i.value = s.value;
                i.oninput = () => s.value = i.value;
            }
            
            calc() {
                this.o1.m = parseFloat(document.getElementById('m1').value);
                this.o1.v = this.o1.v0 = parseFloat(document.getElementById('v1').value);
                this.o2.m = parseFloat(document.getElementById('m2').value);
                this.o2.v = this.o2.v0 = parseFloat(document.getElementById('v2').value);
                
                this.o1.r = Math.max(15, Math.min(50, 15 + this.o1.m * 5));
                this.o2.r = Math.max(15, Math.min(50, 15 + this.o2.m * 5));
                
                const m1=this.o1.m, m2=this.o2.m, v1=this.o1.v0, v2=this.o2.v0;
                this.pm = m1*v1 + m2*v2;
                this.vf = this.pm / (m1+m2);
                this.ke0 = 0.5*m1*v1*v1 + 0.5*m2*v2*v2;
                this.ke1 = 0.5*(m1+m2)*this.vf*this.vf;
                this.loss = this.ke0 - this.ke1;
                
                document.getElementById('p').textContent = this.pm.toFixed(2);
                document.getElementById('e0').textContent = this.ke0.toFixed(2);
                document.getElementById('e1').textContent = this.ke1.toFixed(2);
                document.getElementById('loss').textContent = this.loss.toFixed(2);
                document.getElementById('vf').textContent = this.vf.toFixed(2);
            }
            
            start() {
                if(!this.run) {
                    this.run = true;
                    this.anim();
                }
            }
            
            pause() {
                this.run = false;
                if(this.aid) cancelAnimationFrame(this.aid);
            }
            
            reset() {
                this.pause();
                this.t = 0;
                this.hit = false;
                this.hitPt = null;
                this.dfm = 0;
                this.eData = [];
                this.o1.x = this.o1.x0;
                this.o1.v = this.o1.v0;
                this.o2.x = this.o2.x0;
                this.o2.v = this.o2.v0;
                document.getElementById('def').textContent = '0%';
                this.calc();
                this.draw();
                this.drawChart();
            }
            
            anim() {
                if(!this.run) return;
                this.update();
                this.draw();
                this.aid = requestAnimationFrame(() => this.anim());
            }
            
            update() {
                const dt = 0.016 * this.spd;
                this.t += dt;
                
                if(!this.hit) {
                    this.o1.x += this.o1.v * dt * 50;
                    this.o2.x += this.o2.v * dt * 50;
                    
                    const d = Math.abs(this.o1.x - this.o2.x);
                    if(d <= this.o1.r + this.o2.r) {
                        this.hit = true;
                        this.hitPt = {x:(this.o1.x+this.o2.x)/2, y:(this.o1.y+this.o2.y)/2};
                        this.dfm = 1;
                        this.o1.v = this.o2.v = this.vf;
                        this.particles = [];
                        for(let i=0; i<20; i++) {
                            this.particles.push({
                                x:this.hitPt.x, y:this.hitPt.y,
                                vx:(Math.random()-0.5)*100, vy:(Math.random()-0.5)*100,
                                life:1, c:`hsl(${Math.random()*60+20},70%,60%)`
                            });
                        }
                    }
                    this.eData.push({t:this.t, e:this.ke0});
                } else {
                    this.o1.x += this.vf * dt * 50;
                    this.o2.x += this.vf * dt * 50;
                    this.dfm = Math.max(0, this.dfm - dt*2);
                    this.eData.push({t:this.t, e:this.ke1});
                }
                
                if(this.eData.length > 100) this.eData.shift();
                document.getElementById('def').textContent = (this.dfm*100).toFixed(1) + '%';
                this.drawChart();
            }
            
            draw() {
                const c = this.ctx;
                c.clearRect(0, 0, this.c.width, this.c.height);
                
                // Grid
                c.strokeStyle = '#e9ecef';
                c.lineWidth = 1;
                for(let x=0; x<this.c.width; x+=50) {
                    c.beginPath(); c.moveTo(x,0); c.lineTo(x,this.c.height); c.stroke();
                }
                for(let y=0; y<this.c.height; y+=50) {
                    c.beginPath(); c.moveTo(0,y); c.lineTo(this.c.width,y); c.stroke();
                }
                
                // Ground
                c.strokeStyle = '#6c757d';
                c.lineWidth = 3;
                const gy = this.c.height * 0.7;
                c.beginPath(); c.moveTo(0,gy); c.lineTo(this.c.width,gy); c.stroke();
                
                // Vectors
                if(!this.hit) {
                    this.drawVec(this.o1, this.o1.v, this.o1.c);
                    this.drawVec(this.o2, this.o2.v, this.o2.c);
                } else {
                    this.drawVec(this.o1, this.vf, '#2ed573');
                    this.drawVec(this.o2, this.vf, '#2ed573');
                }
                
                // Objects
                this.drawObj(this.o1);
                this.drawObj(this.o2);
                
                // Effects
                if(this.particles) {
                    this.particles.forEach(p => {
                        p.x += p.vx*0.016; p.y += p.vy*0.016; p.life -= 0.032;
                        if(p.life>0) {
                            c.fillStyle = p.c; c.globalAlpha = p.life;
                            c.beginPath(); c.arc(p.x,p.y,3,0,2*Math.PI); c.fill();
                        }
                    });
                    c.globalAlpha = 1;
                }
                
                if(this.hit && this.dfm>0) {
                    c.fillStyle = 'rgba(255,71,87,0.3)';
                    c.beginPath(); c.arc(this.hitPt.x,this.hitPt.y,30*this.dfm,0,2*Math.PI); c.fill();
                }
            }
            
            drawObj(o) {
                const c = this.ctx;
                let rx = o.r, ry = o.r;
                if(this.hit && this.dfm>0) {
                    rx = o.r * (1 + this.dfm*0.3);
                    ry = o.r * (1 - this.dfm*0.2);
                }
                
                c.fillStyle = 'rgba(0,0,0,0.2)';
                c.beginPath(); c.ellipse(o.x+5,o.y+5,rx,ry,0,0,2*Math.PI); c.fill();
                
                c.fillStyle = o.c; c.strokeStyle = '#fff'; c.lineWidth = 3;
                c.beginPath(); c.ellipse(o.x,o.y,rx,ry,0,0,2*Math.PI); c.fill(); c.stroke();
                
                c.fillStyle = '#fff'; c.font = 'bold 14px Arial'; c.textAlign = 'center';
                c.fillText(o.m+'kg', o.x, o.y+5);
            }
            
            drawVec(o, v, col) {
                const c = this.ctx;
                const sx = o.x, sy = o.y - o.r - 10;
                const ex = sx + v * 20;
                
                c.strokeStyle = col; c.lineWidth = 3;
                c.beginPath(); c.moveTo(sx,sy); c.lineTo(ex,sy); c.stroke();
                
                c.beginPath();
                c.moveTo(ex,sy); c.lineTo(ex-10,sy-5);
                c.moveTo(ex,sy); c.lineTo(ex-10,sy+5);
                c.stroke();
                
                c.fillStyle = col; c.font = '12px Arial'; c.textAlign = 'center';
                c.fillText(v.toFixed(1)+'m/s', ex, sy-10);
            }
            
            drawChart() {
                if(!this.eData.length) return;
                const c = this.chx, w = this.ch.width, h = this.ch.height;
                c.clearRect(0,0,w,h);
                
                const m = {t:20,r:20,b:40,l:60};
                const cw = w-m.l-m.r, ch = h-m.t-m.b;
                const mx = Math.max(...this.eData.map(d=>d.e), this.ke0);
                
                c.strokeStyle = '#6c757d'; c.lineWidth = 2;
                c.beginPath();
                c.moveTo(m.l,m.t); c.lineTo(m.l,m.t+ch); c.lineTo(m.l+cw,m.t+ch); c.stroke();
                
                if(this.eData.length>1) {
                    c.strokeStyle = '#007bff'; c.lineWidth = 3;
                    c.beginPath();
                    this.eData.forEach((p,i) => {
                        const x = m.l + (i/(this.eData.length-1))*cw;
                        const y = m.t + ch - (p.e/mx)*ch;
                        i===0 ? c.moveTo(x,y) : c.lineTo(x,y);
                    });
                    c.stroke();
                }
                
                c.fillStyle = '#495057'; c.font = '12px Arial'; c.textAlign = 'center';
                c.fillText('Vaqt', m.l+cw/2, h-5);
                c.save(); c.translate(15,m.t+ch/2); c.rotate(-Math.PI/2);
                c.fillText('Energiya (J)', 0, 0); c.restore();
            }
        }
        
        function setPreset(t) {
            const vals = {
                equal: [2,3,2,-3],
                heavy: [5,2,1,-1],
                light: [1,5,4,-1],
                fast: [2,8,3,-6]
            };
            const v = vals[t];
            ['m1','v1','m2','v2'].forEach((id,i) => {
                document.getElementById(id).value = document.getElementById(id+'n').value = v[i];
            });
            if(window.sim) {
                window.sim.calc();
                if(!window.sim.run) window.sim.draw();
            }
        }
        
        window.addEventListener('DOMContentLoaded', () => {
            window.sim = new Sim();
        });
        
        document.addEventListener('keydown', e => {
            if(!window.sim) return;
            if(e.key===' ') {
                e.preventDefault();
                window.sim.run ? window.sim.pause() : window.sim.start();
            }
            if(e.key==='r'||e.key==='R') {
                e.preventDefault();
                window.sim.reset();
            }
        });
    </script>
</body>
</html>
