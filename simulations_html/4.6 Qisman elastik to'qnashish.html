<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>To'qnashish Simulyatsiyasi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 8px;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        #canvas {
            width: 100%;
            height: 250px;
            border: 2px solid #3498db;
            border-radius: 8px;
            background: linear-gradient(180deg, #87ceeb 0%, #e0f6ff 100%);
            display: block;
            touch-action: none;
        }

        .controls {
            margin-top: 15px;
        }

        .control-group {
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #3498db;
        }

        .control-group h3 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .slider-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .slider-row label {
            min-width: 80px;
            font-size: 0.85rem;
            font-weight: bold;
            color: #34495e;
        }

        .slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            border: none;
        }

        .value-display {
            min-width: 45px;
            text-align: center;
            background: #3498db;
            color: white;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin-top: 10px;
        }

        .btn {
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: bold;
            transition: all 0.2s;
            touch-action: manipulation;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .collision-types {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin-top: 8px;
        }

        .collision-type {
            background: #ecf0f1;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            font-size: 0.8rem;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .collision-type.active {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }

        .info-display {
            margin-top: 15px;
            padding: 12px;
            background: white;
            border-radius: 8px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }

        .info-card {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid #3498db;
        }

        .info-card h4 {
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 0.8rem;
        }

        .info-card .value {
            font-size: 1rem;
            font-weight: bold;
            color: #3498db;
        }

        .energy-bar {
            width: 100%;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin-top: 10px;
        }

        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #f39c12, #27ae60);
            transition: width 0.3s;
            border-radius: 10px;
        }

        .energy-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 0.75rem;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 10px;
            flex-wrap: wrap;
            font-size: 0.8rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            background: #2c3e50;
            color: white;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 0.85rem;
        }

        .scenarios {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin-top: 8px;
        }

        .scenario-btn {
            background: #6f42c1;
            color: white;
            border: none;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.2s;
        }

        .scenario-btn:active {
            transform: scale(0.95);
        }

        @media (max-width: 360px) {
            h1 {
                font-size: 1.1rem;
            }
            
            .slider-row label {
                min-width: 70px;
                font-size: 0.75rem;
            }
            
            .value-display {
                min-width: 40px;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÆ To'qnashish Simulyatsiyasi</h1>
        
        <canvas id="canvas"></canvas>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #e74c3c;"></div>
                <span>Jism 1</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #3498db;"></div>
                <span>Jism 2</span>
            </div>
        </div>

        <div class="controls">
            <div class="status-bar">
                <span id="timeDisplay">Vaqt: 0.0s</span>
                <span id="collisionCounter">To'qnashish: 0</span>
            </div>

            <div class="control-group">
                <h3>‚ö° Koeffitsient (e)</h3>
                <div class="slider-row">
                    <label>e:</label>
                    <input type="range" class="slider" id="eSlider" min="0.1" max="1" step="0.1" value="0.8">
                    <span class="value-display" id="eValue">0.8</span>
                </div>
                <div class="collision-types">
                    <div class="collision-type" data-e="1.0">Elastik (1.0)</div>
                    <div class="collision-type active" data-e="0.8">Qisman (0.8)</div>
                    <div class="collision-type" data-e="0.5">O'rtacha (0.5)</div>
                    <div class="collision-type" data-e="0.2">Kuchsiz (0.2)</div>
                </div>
            </div>

            <div class="control-group">
                <h3>üéØ Jism 1</h3>
                <div class="slider-row">
                    <label>Massa (kg):</label>
                    <input type="range" class="slider" id="m1Slider" min="1" max="10" step="0.5" value="2">
                    <span class="value-display" id="m1Value">2</span>
                </div>
                <div class="slider-row">
                    <label>Tezlik (m/s):</label>
                    <input type="range" class="slider" id="v1Slider" min="-10" max="10" step="0.5" value="5">
                    <span class="value-display" id="v1Value">5</span>
                </div>
            </div>

            <div class="control-group">
                <h3>üéØ Jism 2</h3>
                <div class="slider-row">
                    <label>Massa (kg):</label>
                    <input type="range" class="slider" id="m2Slider" min="1" max="10" step="0.5" value="3">
                    <span class="value-display" id="m2Value">3</span>
                </div>
                <div class="slider-row">
                    <label>Tezlik (m/s):</label>
                    <input type="range" class="slider" id="v2Slider" min="-10" max="10" step="0.5" value="0">
                    <span class="value-display" id="v2Value">0</span>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" id="startBtn">‚ñ∂Ô∏è Boshlash</button>
                <button class="btn btn-secondary" id="pauseBtn">‚è∏Ô∏è Pauza</button>
                <button class="btn btn-danger" id="resetBtn">üîÑ Qayta</button>
            </div>

            <div class="control-group">
                <h3>üéÆ Senariylar</h3>
                <div class="scenarios">
                    <button class="scenario-btn" data-scenario="tennis">Tennis</button>
                    <button class="scenario-btn" data-scenario="billiard">Bilyard</button>
                    <button class="scenario-btn" data-scenario="cars">Mashina</button>
                    <button class="scenario-btn" data-scenario="atoms">Atomlar</button>
                </div>
            </div>
        </div>

        <div class="info-display">
            <div class="info-grid">
                <div class="info-card">
                    <h4>üìä Boshlang'ich E</h4>
                    <div class="value" id="initialEnergy">0 J</div>
                </div>
                <div class="info-card">
                    <h4>üìà Oxirgi E</h4>
                    <div class="value" id="finalEnergy">0 J</div>
                </div>
                <div class="info-card">
                    <h4>‚ö° Yo'qolish</h4>
                    <div class="value" id="energyLoss">0 J</div>
                </div>
                <div class="info-card">
                    <h4>üìâ Foiz</h4>
                    <div class="value" id="energyPercent">0%</div>
                </div>
            </div>

            <div class="energy-bar">
                <div class="energy-fill" id="energyBar"></div>
                <div class="energy-text" id="energyText">100%</div>
            </div>
        </div>
    </div>

    <script>
        class CollisionSim {
            constructor() {
                this.canvas = document.getElementById('canvas');
                this.ctx = this.canvas.getContext('2d');
                this.resizeCanvas();
                
                this.ball1 = {
                    x: 80,
                    y: 0,
                    vx: 5,
                    mass: 2,
                    radius: 20,
                    color: '#e74c3c',
                    trail: []
                };
                
                this.ball2 = {
                    x: 300,
                    y: 0,
                    vx: 0,
                    mass: 3,
                    radius: 25,
                    color: '#3498db',
                    trail: []
                };
                
                this.e = 0.8;
                this.isRunning = false;
                this.animationId = null;
                this.collisionCount = 0;
                this.time = 0;
                this.initialV1 = 5;
                this.initialV2 = 0;
                
                this.setupEvents();
                this.updateDisplay();
                this.draw();
            }
            
            resizeCanvas() {
                const rect = this.canvas.getBoundingClientRect();
                this.canvas.width = rect.width;
                this.canvas.height = rect.height;
                this.centerY = this.canvas.height / 2;
            }
            
            setupEvents() {
                const updateSlider = (sliderId, valueId, callback) => {
                    const slider = document.getElementById(sliderId);
                    slider.addEventListener('input', (e) => {
                        const val = parseFloat(e.target.value);
                        document.getElementById(valueId).textContent = val;
                        callback(val);
                        this.updateDisplay();
                    });
                };
                
                updateSlider('eSlider', 'eValue', v => {
                    this.e = v;
                    this.updateCollisionTypes();
                });
                updateSlider('m1Slider', 'm1Value', v => {
                    this.ball1.mass = v;
                    this.ball1.radius = 15 + v * 2;
                });
                updateSlider('m2Slider', 'm2Value', v => {
                    this.ball2.mass = v;
                    this.ball2.radius = 15 + v * 2;
                });
                updateSlider('v1Slider', 'v1Value', v => {
                    this.ball1.vx = v;
                    this.initialV1 = v;
                });
                updateSlider('v2Slider', 'v2Value', v => {
                    this.ball2.vx = v;
                    this.initialV2 = v;
                });
                
                document.getElementById('startBtn').addEventListener('click', () => this.start());
                document.getElementById('pauseBtn').addEventListener('click', () => this.pause());
                document.getElementById('resetBtn').addEventListener('click', () => this.reset());
                
                document.querySelectorAll('.collision-type').forEach(el => {
                    el.addEventListener('click', (e) => {
                        const eVal = parseFloat(e.target.dataset.e);
                        this.e = eVal;
                        document.getElementById('eSlider').value = eVal;
                        document.getElementById('eValue').textContent = eVal;
                        this.updateCollisionTypes();
                    });
                });
                
                document.querySelectorAll('.scenario-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.loadScenario(e.target.dataset.scenario));
                });
                
                window.addEventListener('resize', () => {
                    this.resizeCanvas();
                    this.draw();
                });
            }
            
            updateCollisionTypes() {
                document.querySelectorAll('.collision-type').forEach(el => {
                    el.classList.toggle('active', parseFloat(el.dataset.e) === this.e);
                });
            }
            
            loadScenario(type) {
                this.pause();
                const scenarios = {
                    tennis: { m1: 0.06, v1: 30, m2: 0.06, v2: 0, e: 0.7 },
                    billiard: { m1: 0.16, v1: 5, m2: 0.16, v2: 0, e: 0.95 },
                    cars: { m1: 8, v1: 8, m2: 10, v2: 0, e: 0.2 },
                    atoms: { m1: 1, v1: 10, m2: 1, v2: -5, e: 1.0 }
                };
                
                const s = scenarios[type];
                if (s) {
                    ['m1', 'm2', 'v1', 'v2', 'e'].forEach(key => {
                        const slider = document.getElementById(key + 'Slider');
                        const val = s[key];
                        slider.value = val;
                        document.getElementById(key + 'Value').textContent = val;
                    });
                    
                    this.ball1.mass = s.m1;
                    this.ball2.mass = s.m2;
                    this.ball1.vx = s.v1;
                    this.ball2.vx = s.v2;
                    this.e = s.e;
                    this.initialV1 = s.v1;
                    this.initialV2 = s.v2;
                    
                    this.ball1.radius = 15 + this.ball1.mass * 2;
                    this.ball2.radius = 15 + this.ball2.mass * 2;
                    
                    this.updateCollisionTypes();
                    this.reset();
                }
            }
            
            start() {
                if (!this.isRunning) {
                    this.isRunning = true;
                    this.animate();
                }
            }
            
            pause() {
                this.isRunning = false;
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                    this.animationId = null;
                }
            }
            
            reset() {
                this.pause();
                this.ball1.x = 80;
                this.ball1.y = 0;
                this.ball1.vx = this.initialV1;
                this.ball1.trail = [];
                
                this.ball2.x = this.canvas.width - 80;
                this.ball2.y = 0;
                this.ball2.vx = this.initialV2;
                this.ball2.trail = [];
                
                this.collisionCount = 0;
                this.time = 0;
                
                this.updateDisplay();
                this.draw();
            }
            
            animate() {
                if (!this.isRunning) return;
                
                this.update();
                this.draw();
                this.updateDisplay();
                
                this.animationId = requestAnimationFrame(() => this.animate());
            }
            
            update() {
                this.time += 0.016;
                
                // Update positions
                this.ball1.x += this.ball1.vx * 2;
                this.ball2.x += this.ball2.vx * 2;
                
                // Add trail
                this.ball1.trail.push({ x: this.ball1.x, y: this.ball1.y });
                this.ball2.trail.push({ x: this.ball2.x, y: this.ball2.y });
                if (this.ball1.trail.length > 20) this.ball1.trail.shift();
                if (this.ball2.trail.length > 20) this.ball2.trail.shift();
                
                // Wall collision
                if (this.ball1.x - this.ball1.radius < 0 || this.ball1.x + this.ball1.radius > this.canvas.width) {
                    this.ball1.vx *= -0.9;
                    this.ball1.x = Math.max(this.ball1.radius, Math.min(this.canvas.width - this.ball1.radius, this.ball1.x));
                }
                if (this.ball2.x - this.ball2.radius < 0 || this.ball2.x + this.ball2.radius > this.canvas.width) {
                    this.ball2.vx *= -0.9;
                    this.ball2.x = Math.max(this.ball2.radius, Math.min(this.canvas.width - this.ball2.radius, this.ball2.x));
                }
                
                // Ball collision
                const dx = this.ball2.x - this.ball1.x;
                const dist = Math.abs(dx);
                const minDist = this.ball1.radius + this.ball2.radius;
                
                if (dist < minDist) {
                    const m1 = this.ball1.mass;
                    const m2 = this.ball2.mass;
                    const v1 = this.ball1.vx;
                    const v2 = this.ball2.vx;
                    
                    const v1f = ((m1 - this.e * m2) * v1 + m2 * (1 + this.e) * v2) / (m1 + m2);
                    const v2f = ((m2 - this.e * m1) * v2 + m1 * (1 + this.e) * v1) / (m1 + m2);
                    
                    this.ball1.vx = v1f;
                    this.ball2.vx = v2f;
                    
                    // Separate balls
                    const overlap = minDist - dist;
                    const total = m1 + m2;
                    this.ball1.x -= overlap * (m2 / total) * Math.sign(dx);
                    this.ball2.x += overlap * (m1 / total) * Math.sign(dx);
                    
                    this.collisionCount++;
                }
            }
            
            draw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Draw trails
                this.drawTrail(this.ball1);
                this.drawTrail(this.ball2);
                
                // Draw balls
                this.drawBall(this.ball1);
                this.drawBall(this.ball2);
                
                // Draw velocity vectors
                this.drawVelocity(this.ball1);
                this.drawVelocity(this.ball2);
            }
            
            drawTrail(ball) {
                if (ball.trail.length < 2) return;
                
                this.ctx.strokeStyle = ball.color;
                this.ctx.lineWidth = 2;
                this.ctx.globalAlpha = 0.3;
                this.ctx.beginPath();
                
                ball.trail.forEach((point, i) => {
                    const x = point.x;
                    const y = point.y + this.centerY;
                    if (i === 0) this.ctx.moveTo(x, y);
                    else this.ctx.lineTo(x, y);
                });
                
                this.ctx.stroke();
                this.ctx.globalAlpha = 1;
            }
            
            drawBall(ball) {
                const x = ball.x;
                const y = ball.y + this.centerY;
                
                this.ctx.beginPath();
                this.ctx.arc(x, y, ball.radius, 0, Math.PI * 2);
                
                const gradient = this.ctx.createRadialGradient(
                    x - ball.radius * 0.3, 
                    y - ball.radius * 0.3, 
                    0, 
                    x, 
                    y, 
                    ball.radius
                );
                gradient.addColorStop(0, this.lightenColor(ball.color, 40));
                gradient.addColorStop(1, ball.color);
                
                this.ctx.fillStyle = gradient;
                this.ctx.fill();
                
                this.ctx.strokeStyle = this.darkenColor(ball.color, 20);
                this.ctx.lineWidth = 2;
                this.ctx.stroke();
            }
            
            drawVelocity(ball) {
                const scale = 8;
                const x = ball.x;
                const y = ball.y + this.centerY;
                const vx = ball.vx * scale;
                
                if (Math.abs(vx) < 1) return;
                
                this.ctx.strokeStyle = '#27ae60';
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();
                this.ctx.moveTo(x, y);
                this.ctx.lineTo(x + vx, y);
                this.ctx.stroke();
                
                // Arrow head
                const angle = Math.atan2(0, vx);
                const headLen = 8;
                this.ctx.beginPath();
                this.ctx.moveTo(x + vx, y);
                this.ctx.lineTo(
                    x + vx - headLen * Math.cos(angle - Math.PI / 6),
                    y - headLen * Math.sin(angle - Math.PI / 6)
                );
                this.ctx.lineTo(
                    x + vx - headLen * Math.cos(angle + Math.PI / 6),
                    y - headLen * Math.sin(angle + Math.PI / 6)
                );
                this.ctx.closePath();
                this.ctx.fillStyle = '#27ae60';
                this.ctx.fill();
            }
            
            updateDisplay() {
                const initialE = 0.5 * this.ball1.mass * this.initialV1 * this.initialV1 + 
                               0.5 * this.ball2.mass * this.initialV2 * this.initialV2;
                const currentE = 0.5 * this.ball1.mass * this.ball1.vx * this.ball1.vx + 
                                0.5 * this.ball2.mass * this.ball2.vx * this.ball2.vx;
                const loss = initialE - currentE;
                const percent = initialE > 0 ? (currentE / initialE) * 100 : 100;
                
                document.getElementById('initialEnergy').textContent = initialE.toFixed(1) + ' J';
                document.getElementById('finalEnergy').textContent = currentE.toFixed(1) + ' J';
                document.getElementById('energyLoss').textContent = loss.toFixed(1) + ' J';
                document.getElementById('energyPercent').textContent = percent.toFixed(0) + '%';
                document.getElementById('energyBar').style.width = percent + '%';
                document.getElementById('energyText').textContent = percent.toFixed(0) + '%';
                document.getElementById('timeDisplay').textContent = 'Vaqt: ' + this.time.toFixed(1) + 's';
                document.getElementById('collisionCounter').textContent = 'To\'qnashish: ' + this.collisionCount;
            }
            
            lightenColor(color, percent) {
                const num = parseInt(color.replace('#', ''), 16);
                const amt = Math.round(2.55 * percent);
                const R = Math.min(255, (num >> 16) + amt);
                const G = Math.min(255, (num >> 8 & 0x00FF) + amt);
                const B = Math.min(255, (num & 0x0000FF) + amt);
                return '#' + (0x1000000 + R * 0x10000 + G * 0x100 + B).toString(16).slice(1);
            }
            
            darkenColor(color, percent) {
                const num = parseInt(color.replace('#', ''), 16);
                const amt = Math.round(2.55 * percent);
                const R = Math.max(0, (num >> 16) - amt);
                const G = Math.max(0, (num >> 8 & 0x00FF) - amt);
                const B = Math.max(0, (num & 0x0000FF) - amt);
                return '#' + (0x1000000 + R * 0x10000 + G * 0x100 + B).toString(16).slice(1);
            }
        }
        
        // Initialize
        let sim;
        window.addEventListener('DOMContentLoaded', () => {
            sim = new CollisionSim();
            
            // Touch to start
            document.getElementById('canvas').addEventListener('touchstart', () => {
                if (!sim.isRunning) sim.start();
            });
        });
    </script>
</body>
</html>
