<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tezlik Vektori</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }
        
        .container { padding: 10px; max-width: 100%; }
        
        .header {
            text-align: center;
            padding: 15px 10px;
            color: white;
        }
        
        .header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p { font-size: 0.85em; opacity: 0.9; }
        
        .canvas-wrapper {
            background: white;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .canvas-container {
            position: relative;
            width: 100%;
            height: 300px;
            border: 2px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background: #f8f9fa;
            touch-action: none;
        }
        
        canvas { width: 100%; height: 100%; display: block; }
        
        .status-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            font-size: 0.7em;
            font-family: monospace;
            display: flex;
            justify-content: space-between;
        }
        
        .controls {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .btn-group {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .btn {
            padding: 12px 8px;
            border: none;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            touch-action: manipulation;
        }
        
        .btn:active { transform: scale(0.95); }
        
        .btn-primary { background: #667eea; color: white; }
        .btn-secondary { background: #e2e8f0; color: #4a5568; }
        .btn-danger { background: #e53e3e; color: white; }
        
        .section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .section:last-child { border-bottom: none; }
        
        .section h3 {
            font-size: 1em;
            color: #4a5568;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .param {
            margin-bottom: 15px;
        }
        
        .param label {
            display: block;
            font-size: 0.85em;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .value {
            background: #f7fafc;
            padding: 8px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9em;
            text-align: center;
            margin-top: 5px;
            border: 1px solid #e2e8f0;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .checkbox {
            display: flex;
            align-items: center;
            font-size: 0.85em;
        }
        
        .checkbox input {
            margin-right: 6px;
            transform: scale(1.3);
        }
        
        .data-panel {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .data-panel h4 {
            font-size: 1em;
            margin-bottom: 10px;
        }
        
        .data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 0.85em;
        }
        
        .data-item {
            background: rgba(255,255,255,0.15);
            padding: 8px;
            border-radius: 5px;
        }
        
        .data-label {
            font-weight: 600;
            opacity: 0.9;
        }
        
        .data-value {
            font-family: monospace;
            font-size: 1.1em;
        }
        
        .presets {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .preset-btn {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
            touch-action: manipulation;
        }
        
        .preset-btn:active {
            transform: scale(0.95);
            border-color: #667eea;
        }
        
        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .speed-badge {
            background: #667eea;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.9em;
            min-width: 50px;
            text-align: center;
        }
        
        .theory {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .theory h2 {
            font-size: 1.2em;
            color: #2d3748;
            margin-bottom: 15px;
        }
        
        .formula {
            background: #f7fafc;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
        }
        
        .formula h4 {
            font-size: 0.9em;
            margin-bottom: 8px;
            color: #4a5568;
        }
        
        .formula p {
            font-size: 0.85em;
            line-height: 1.5;
            margin-top: 5px;
        }
        
        .examples {
            font-size: 0.85em;
            line-height: 1.6;
        }
        
        .examples li {
            margin-bottom: 8px;
            margin-left: 20px;
        }
        
        .collapse-btn {
            width: 100%;
            padding: 12px;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            color: #4a5568;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .collapse-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .collapse-content.show {
            max-height: 2000px;
        }
        
        @media (max-width: 360px) {
            .header h1 { font-size: 1.3em; }
            .btn { padding: 10px 6px; font-size: 0.75em; }
            .canvas-container { height: 250px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Tezlik Vektori</h1>
            <p>Interaktiv Simulyatsiya</p>
        </div>

        <div class="canvas-wrapper">
            <div class="canvas-container">
                <canvas id="canvas"></canvas>
                <div class="status-bar">
                    <span id="scale">1:1</span>
                    <span id="time">0.0s</span>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="btn-group">
                <button class="btn btn-primary" id="playBtn">‚ñ∂Ô∏è Start</button>
                <button class="btn btn-secondary" id="resetBtn">üîÑ Reset</button>
                <button class="btn btn-danger" id="clearBtn">üßπ Clear</button>
            </div>

            <div class="data-panel">
                <h4>üìä Tezlik Ma'lumotlari</h4>
                <div class="data-grid">
                    <div class="data-item">
                        <div class="data-label">v‚Çì:</div>
                        <div class="data-value" id="dvx">20.0 m/s</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">v·µß:</div>
                        <div class="data-value" id="dvy">15.0 m/s</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">|v‚Éó|:</div>
                        <div class="data-value" id="dmag">25.0 m/s</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Œ∏:</div>
                        <div class="data-value" id="dang">36.9¬∞</div>
                    </div>
                </div>
            </div>

            <button class="collapse-btn" id="paramsBtn">
                ‚öôÔ∏è Parametrlar
                <span>‚ñº</span>
            </button>
            <div class="collapse-content" id="paramsContent">
                <div class="section">
                    <div class="param">
                        <label>Boshlang'ich tezlik v‚Çì (m/s)</label>
                        <input type="range" id="vx" min="-50" max="50" value="20" step="1">
                        <div class="value" id="vxVal">20 m/s</div>
                    </div>
                    <div class="param">
                        <label>Boshlang'ich tezlik v·µß (m/s)</label>
                        <input type="range" id="vy" min="-50" max="50" value="15" step="1">
                        <div class="value" id="vyVal">15 m/s</div>
                    </div>
                    <div class="param">
                        <label>Tezlanish a‚Çì (m/s¬≤)</label>
                        <input type="range" id="ax" min="-10" max="10" value="0" step="0.1">
                        <div class="value" id="axVal">0.0 m/s¬≤</div>
                    </div>
                    <div class="param">
                        <label>Tezlanish a·µß (m/s¬≤)</label>
                        <input type="range" id="ay" min="-10" max="10" value="-9.8" step="0.1">
                        <div class="value" id="ayVal">-9.8 m/s¬≤</div>
                    </div>
                </div>
            </div>

            <button class="collapse-btn" id="viewBtn">
                üëÅÔ∏è Ko'rish
                <span>‚ñº</span>
            </button>
            <div class="collapse-content" id="viewContent">
                <div class="section">
                    <div class="checkbox-group">
                        <label class="checkbox">
                            <input type="checkbox" id="showGrid" checked> To'r
                        </label>
                        <label class="checkbox">
                            <input type="checkbox" id="showTrail" checked> Iz
                        </label>
                        <label class="checkbox">
                            <input type="checkbox" id="showComp" checked> Komponent
                        </label>
                        <label class="checkbox">
                            <input type="checkbox" id="autoScale" checked> Auto
                        </label>
                    </div>
                </div>
            </div>

            <button class="collapse-btn" id="speedBtn">
                ‚è±Ô∏è Tezlik
                <span>‚ñº</span>
            </button>
            <div class="collapse-content" id="speedContent">
                <div class="section">
                    <div class="speed-control">
                        <label>Tezlik:</label>
                        <input type="range" id="speed" min="0.1" max="3" value="1" step="0.1" style="flex:1">
                        <div class="speed-badge" id="speedVal">1.0x</div>
                    </div>
                </div>
            </div>

            <button class="collapse-btn" id="presetsBtn">
                üé¨ Stsenariylar
                <span>‚ñº</span>
            </button>
            <div class="collapse-content" id="presetsContent">
                <div class="section">
                    <div class="presets">
                        <button class="preset-btn" data-preset="projectile">üéØ Proyektil</button>
                        <button class="preset-btn" data-preset="circular">‚≠ï Aylana</button>
                        <button class="preset-btn" data-preset="uniform">‚û°Ô∏è Tekis</button>
                        <button class="preset-btn" data-preset="decel">‚¨áÔ∏è Sekinlash</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="theory">
            <button class="collapse-btn" id="theoryBtn">
                üìö Nazariya
                <span>‚ñº</span>
            </button>
            <div class="collapse-content" id="theoryContent">
                <div class="formula">
                    <h4>Tezlik Vektori Kattaligi</h4>
                    <p>$$|\vec{v}| = \sqrt{v_x^2 + v_y^2}$$</p>
                </div>
                <div class="formula">
                    <h4>Yo'nalish</h4>
                    <p>$$\theta = \arctan\left(\frac{v_y}{v_x}\right)$$</p>
                </div>
                <div class="formula">
                    <h4>Kinematika</h4>
                    <p>$$v_x(t) = v_{0x} + a_x t$$</p>
                    <p>$$v_y(t) = v_{0y} + a_y t$$</p>
                </div>
                <h3 style="margin-top:15px; font-size:1em;">Misollar:</h3>
                <ul class="examples">
                    <li>Top o'qi harakati</li>
                    <li>Planetalar harakati</li>
                    <li>Avtomobil harakati</li>
                    <li>Samolyot harakati</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        class Sim {
            constructor() {
                this.c = document.getElementById('canvas');
                this.ctx = this.c.getContext('2d');
                this.setup();
                
                this.run = false;
                this.t = 0;
                this.dt = 0.016;
                this.speed = 1;
                
                this.x0 = 0; this.y0 = 0;
                this.vx0 = 20; this.vy0 = 15;
                this.ax = 0; this.ay = -9.8;
                this.reset();
                
                this.scale = 3;
                this.minScale = 0.5;
                this.maxScale = 20;
                this.ox = this.c.width / 2;
                this.oy = this.c.height / 2;
                
                this.showGrid = true;
                this.showTrail = true;
                this.showComp = true;
                this.autoScale = true;
                
                this.trail = [];
                this.maxTrail = 150;
                this.vecScale = 5;
                this.buf = 30;
                
                this.bind();
                this.updateUI();
                this.draw();
            }
            
            setup() {
                const r = this.c.getBoundingClientRect();
                const dpr = window.devicePixelRatio || 1;
                this.c.width = r.width * dpr;
                this.c.height = r.height * dpr;
                this.ctx.scale(dpr, dpr);
            }
            
            bind() {
                const get = id => document.getElementById(id);
                
                get('vx').oninput = e => {
                    this.vx0 = +e.target.value;
                    this.fitView();
                    this.updateUI();
                };
                
                get('vy').oninput = e => {
                    this.vy0 = +e.target.value;
                    this.fitView();
                    this.updateUI();
                };
                
                get('ax').oninput = e => {
                    this.ax = +e.target.value;
                    this.fitView();
                    this.updateUI();
                };
                
                get('ay').oninput = e => {
                    this.ay = +e.target.value;
                    this.fitView();
                    this.updateUI();
                };
                
                get('speed').oninput = e => {
                    this.speed = +e.target.value;
                    get('speedVal').textContent = this.speed.toFixed(1) + 'x';
                };
                
                get('playBtn').onclick = () => this.toggle();
                get('resetBtn').onclick = () => this.reset();
                get('clearBtn').onclick = () => this.trail = [];
                
                get('autoScale').onchange = e => this.autoScale = e.target.checked;
                get('showGrid').onchange = e => this.showGrid = e.target.checked;
                get('showTrail').onchange = e => this.showTrail = e.target.checked;
                get('showComp').onchange = e => this.showComp = e.target.checked;
                
                document.querySelectorAll('.preset-btn').forEach(b => {
                    b.onclick = e => this.preset(e.target.dataset.preset);
                });
                
                // Collapse controls
                ['params', 'view', 'speed', 'presets', 'theory'].forEach(name => {
                    const btn = get(name + 'Btn');
                    const content = get(name + 'Content');
                    if (btn && content) {
                        btn.onclick = () => {
                            content.classList.toggle('show');
                            btn.querySelector('span').textContent = 
                                content.classList.contains('show') ? '‚ñ≤' : '‚ñº';
                        };
                    }
                });
                
                // Touch controls
                let touchStartX = 0;
                let touchStartY = 0;
                
                this.c.ontouchstart = e => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const r = this.c.getBoundingClientRect();
                    touchStartX = touch.clientX - r.left;
                    touchStartY = touch.clientY - r.top;
                };
                
                this.c.ontouchend = e => {
                    e.preventDefault();
                    this.setPos(touchStartX, touchStartY);
                };
                
                window.onresize = () => {
                    this.setup();
                    this.fitView();
                };
            }
            
            reset() {
                this.t = 0;
                this.x = this.x0;
                this.y = this.y0;
                this.vx = this.vx0;
                this.vy = this.vy0;
                this.trail = [];
                this.fitView();
                this.updateUI();
            }
            
            toggle() {
                this.run = !this.run;
                document.getElementById('playBtn').textContent = 
                    this.run ? '‚è∏Ô∏è Pauza' : '‚ñ∂Ô∏è Start';
                if (this.run) this.animate();
            }
            
            preset(p) {
                const presets = {
                    projectile: { vx0: 20, vy0: 20, ax: 0, ay: -9.8 },
                    circular: { vx0: 15, vy0: 0, ax: 0, ay: 0 },
                    uniform: { vx0: 25, vy0: 0, ax: 0, ay: 0 },
                    decel: { vx0: 30, vy0: 10, ax: -2, ay: -1 }
                };
                
                if (presets[p]) {
                    const pr = presets[p];
                    this.vx0 = pr.vx0;
                    this.vy0 = pr.vy0;
                    this.ax = pr.ax;
                    this.ay = pr.ay;
                    
                    document.getElementById('vx').value = pr.vx0;
                    document.getElementById('vy').value = pr.vy0;
                    document.getElementById('ax').value = pr.ax;
                    document.getElementById('ay').value = pr.ay;
                    
                    this.reset();
                }
            }
            
            setPos(cx, cy) {
                this.x = (cx - this.ox) / this.scale;
                this.y = -(cy - this.oy) / this.scale;
                this.x0 = this.x;
                this.y0 = this.y;
                this.t = 0;
                this.trail = [];
                this.updateUI();
            }
            
            update() {
                if (!this.run) return;
                
                const dt = this.dt * this.speed;
                this.t += dt;
                
                this.vx = this.vx0 + this.ax * this.t;
                this.vy = this.vy0 + this.ay * this.t;
                
                this.x = this.x0 + this.vx0 * this.t + 0.5 * this.ax * this.t * this.t;
                this.y = this.y0 + this.vy0 * this.t + 0.5 * this.ay * this.t * this.t;
                
                if (this.showTrail) {
                    this.trail.push({ x: this.x, y: this.y });
                    if (this.trail.length > this.maxTrail) this.trail.shift();
                }
                
                if (this.autoScale) this.autoFit();
                
                if (Math.abs(this.x) > 500 || Math.abs(this.y) > 500) this.reset();
                
                this.updateUI();
            }
            
            autoFit() {
                let minX = Math.min(this.x, this.x0);
                let maxX = Math.max(this.x, this.x0);
                let minY = Math.min(this.y, this.y0);
                let maxY = Math.max(this.y, this.y0);
                
                this.trail.forEach(p => {
                    minX = Math.min(minX, p.x);
                    maxX = Math.max(maxX, p.x);
                    minY = Math.min(minY, p.y);
                    maxY = Math.max(maxY, p.y);
                });
                
                const vMag = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
                const buf = Math.max(10, vMag * 2);
                
                minX -= buf; maxX += buf;
                minY -= buf; maxY += buf;
                
                const rx = maxX - minX;
                const ry = maxY - minY;
                const cx = (minX + maxX) / 2;
                const cy = (minY + maxY) / 2;
                
                const r = this.c.getBoundingClientRect();
                const sx = (r.width - 2 * this.buf) / rx;
                const sy = (r.height - 2 * this.buf) / ry;
                const ts = Math.min(sx, sy);
                
                const ns = Math.max(this.minScale, Math.min(this.maxScale, ts));
                this.scale = this.scale * 0.95 + ns * 0.05;
                
                this.ox = r.width / 2 - cx * this.scale;
                this.oy = r.height / 2 + cy * this.scale;
                
                this.vecScale = Math.max(1, Math.min(15, 40 / Math.max(1, vMag)));
            }
            
            fitView() {
                const vMag = Math.sqrt(this.vx0 * this.vx0 + this.vy0 * this.vy0);
                let est = 50;
                
                if (this.ay !== 0) {
                    const tMax = Math.abs(this.vy0 / this.ay);
                    const hMax = Math.abs(this.y0 + this.vy0 * tMax + 0.5 * this.ay * tMax * tMax);
                    const tTot = 2 * tMax;
                    const rMax = Math.abs(this.x0 + this.vx0 * tTot + 0.5 * this.ax * tTot * tTot);
                    est = Math.max(hMax, rMax);
                }
                
                est *= 1.5;
                
                const r = this.c.getBoundingClientRect();
                const sx = (r.width - 2 * this.buf) / (2 * est);
                const sy = (r.height - 2 * this.buf) / (2 * est);
                this.scale = Math.max(this.minScale, Math.min(this.maxScale, Math.min(sx, sy)));
                
                this.ox = r.width / 2;
                this.oy = r.height / 2;
                
                this.vecScale = Math.max(1, Math.min(15, 40 / Math.max(1, vMag)));
            }
            
            updateUI() {
                document.getElementById('vxVal').textContent = this.vx0.toFixed(1) + ' m/s';
                document.getElementById('vyVal').textContent = this.vy0.toFixed(1) + ' m/s';
                document.getElementById('axVal').textContent = this.ax.toFixed(1) + ' m/s¬≤';
                document.getElementById('ayVal').textContent = this.ay.toFixed(1) + ' m/s¬≤';
                
                document.getElementById('dvx').textContent = this.vx.toFixed(1) + ' m/s';
                document.getElementById('dvy').textContent = this.vy.toFixed(1) + ' m/s';
                
                const mag = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
                document.getElementById('dmag').textContent = mag.toFixed(1) + ' m/s';
                
                const ang = Math.atan2(this.vy, this.vx) * 180 / Math.PI;
                document.getElementById('dang').textContent = ang.toFixed(1) + '¬∞';
                
                document.getElementById('time').textContent = this.t.toFixed(1) + 's';
                document.getElementById('scale').textContent = this.scale.toFixed(1) + 'x';
            }
            
            draw() {
                const r = this.c.getBoundingClientRect();
                this.ctx.clearRect(0, 0, r.width, r.height);
                
                if (this.showGrid) this.drawGrid();
                if (this.showTrail && this.trail.length > 1) this.drawTrail();
                
                this.drawAxes();
                this.drawParticle();
                this.drawVectors();
            }
            
            drawGrid() {
                const r = this.c.getBoundingClientRect();
                const gs = 50;
                const gps = gs * this.scale;
                
                if (gps < 10 || gps > 200) return;
                
                this.ctx.strokeStyle = 'rgba(0,0,0,0.1)';
                this.ctx.lineWidth = 1;
                
                const minX = Math.floor(-this.ox / gps) * gps;
                const maxX = Math.ceil((r.width - this.ox) / gps) * gps;
                const minY = Math.floor(-this.oy / gps) * gps;
                const maxY = Math.ceil((r.height - this.oy) / gps) * gps;
                
                for (let x = minX; x <= maxX; x += gps) {
                    const sx = this.ox + x;
                    this.ctx.beginPath();
                    this.ctx.moveTo(sx, 0);
                    this.ctx.lineTo(sx, r.height);
                    this.ctx.stroke();
                }
                
                for (let y = minY; y <= maxY; y += gps) {
                    const sy = this.oy + y;
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, sy);
                    this.ctx.lineTo(r.width, sy);
                    this.ctx.stroke();
                }
            }
            
            drawAxes() {
                const r = this.c.getBoundingClientRect();
                this.ctx.strokeStyle = '#333';
                this.ctx.lineWidth = 2;
                
                this.ctx.beginPath();
                this.ctx.moveTo(0, this.oy);
                this.ctx.lineTo(r.width, this.oy);
                this.ctx.stroke();
                
                this.ctx.beginPath();
                this.ctx.moveTo(this.ox, 0);
                this.ctx.lineTo(this.ox, r.height);
                this.ctx.stroke();
            }
            
            drawTrail() {
                if (this.trail.length < 2) return;
                
                this.ctx.strokeStyle = '#667eea';
                this.ctx.lineWidth = 2;
                this.ctx.globalAlpha = 0.3;
                
                this.ctx.beginPath();
                const fp = this.trail[0];
                this.ctx.moveTo(this.ox + fp.x * this.scale, this.oy - fp.y * this.scale);
                
                for (let i = 1; i < this.trail.length; i++) {
                    const p = this.trail[i];
                    this.ctx.lineTo(this.ox + p.x * this.scale, this.oy - p.y * this.scale);
                }
                
                this.ctx.stroke();
                this.ctx.globalAlpha = 1;
            }
            
            drawParticle() {
                const sx = this.ox + this.x * this.scale;
                const sy = this.oy - this.y * this.scale;
                
                this.ctx.fillStyle = '#e53e3e';
                this.ctx.beginPath();
                this.ctx.arc(sx, sy, 6, 0, 2 * Math.PI);
                this.ctx.fill();
                
                this.ctx.strokeStyle = '#fff';
                this.ctx.lineWidth = 2;
                this.ctx.stroke();
            }
            
            drawVectors() {
                const sx = this.ox + this.x * this.scale;
                const sy = this.oy - this.y * this.scale;
                
                if (this.showComp) {
                    this.drawVec(sx, sy, this.vx * this.vecScale, 0, '#ff6b6b');
                    this.drawVec(sx, sy, 0, -this.vy * this.vecScale, '#4ecdc4');
                }
                
                this.drawVec(sx, sy, this.vx * this.vecScale, -this.vy * this.vecScale, '#667eea');
            }
            
            drawVec(sx, sy, dx, dy, col) {
                if (Math.abs(dx) < 0.1 && Math.abs(dy) < 0.1) return;
                
                const ex = sx + dx;
                const ey = sy + dy;
                
                this.ctx.strokeStyle = col;
                this.ctx.fillStyle = col;
                this.ctx.lineWidth = 2;
                
                this.ctx.beginPath();
                this.ctx.moveTo(sx, sy);
                this.ctx.lineTo(ex, ey);
                this.ctx.stroke();
                
                const ang = Math.atan2(dy, dx);
                const al = 8;
                const aa = Math.PI / 6;
                
                this.ctx.beginPath();
                this.ctx.moveTo(ex, ey);
                this.ctx.lineTo(ex - al * Math.cos(ang - aa), ey - al * Math.sin(ang - aa));
                this.ctx.lineTo(ex - al * Math.cos(ang + aa), ey - al * Math.sin(ang + aa));
                this.ctx.closePath();
                this.ctx.fill();
            }
            
            animate() {
                this.update();
                this.draw();
                if (this.run) requestAnimationFrame(() => this.animate());
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            new Sim();
        });
    </script>
</body>
</html>
