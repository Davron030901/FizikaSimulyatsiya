<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2.8 Kuchlar Muvozanati</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5em;
            color: white;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            color: rgba(255, 255, 255, 0.9);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            margin-bottom: 30px;
        }

        .simulation-area {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }

        .canvas-container {
            position: relative;
            width: 100%;
            height: 500px;
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            overflow: hidden;
        }

        #simulationCanvas {
            width: 100%;
            height: 100%;
            cursor: crosshair;
        }

        .controls-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            height: fit-content;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .control-group {
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .control-group h3 {
            margin-bottom: 15px;
            color: #495057;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .control-row label {
            font-weight: 500;
            color: #495057;
            font-size: 0.9em;
        }

        .control-row input {
            width: 80px;
            padding: 5px 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .slider-container {
            width: 100%;
            margin: 10px 0;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }

        .bulk-input-container {
            margin-top: 10px;
        }

        .force-input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .quick-values {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .quick-value-btn {
            padding: 5px 10px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s ease;
        }

        .quick-value-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        .input-validation {
            font-size: 0.8em;
            margin-top: 5px;
            padding: 5px;
            border-radius: 4px;
        }

        .input-valid {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .input-invalid {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            appearance: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #007bff;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #007bff;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 2px;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .status-display {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .status-equilibrium {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .status-not-equilibrium {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .force-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background: #f8f9fa;
        }

        .force-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }

        .force-info {
            flex: 1;
            font-size: 0.9em;
        }

        .force-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .theory-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .theory-section h2 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .formula-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.3;
        }

        .legend {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.8em;
            border: 1px solid #ddd;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 3px 0;
        }

        .legend-color {
            width: 15px;
            height: 3px;
            margin-right: 8px;
            border-radius: 1px;
        }

        .equilibrium-info {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #ddd;
        }

        .component-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .component-box {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            text-align: center;
            font-size: 0.9em;
        }

        .polygon-display {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            width: 150px;
            height: 150px;
        }

        .help-tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .help-tooltip .tooltip-text {
            visibility: hidden;
            width: 250px;
            background: #333;
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8em;
        }

        .help-tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .canvas-container {
                height: 400px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .control-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .control-row input {
                width: 100%;
            }
            
            .btn {
                width: 100%;
                margin: 5px 0;
            }
        }

        /* Animation */
        .force-arrow {
            transition: all 0.3s ease;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Force input specific styles */
        .force-input-container {
            position: relative;
        }

        .force-input-container input:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        .force-input-container input:invalid {
            border-color: #dc3545;
            box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.25);
        }

        .force-input-container input:valid {
            border-color: #28a745;
            box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.25);
        }

        /* Enhanced tooltips */
        .enhanced-tooltip {
            position: relative;
            display: inline-block;
        }

        .enhanced-tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8em;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .enhanced-tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>2.8 Kuchlar Muvozanati</h1>
            <p>Kuchlar muvozanatini o'rganish va vizual tahlil qilish</p>
        </div>

        <div class="main-content">
            <div class="simulation-area">
                <div class="canvas-container">
                    <canvas id="simulationCanvas"></canvas>
                    <div class="grid-overlay" id="gridOverlay"></div>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #007bff;"></div>
                            <span>Kuchlar</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #dc3545;"></div>
                            <span>Natijaviy kuch</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #28a745;"></div>
                            <span>Muvozanat</span>
                        </div>
                    </div>
                    <div class="polygon-display" id="polygonDisplay">
                        <canvas id="polygonCanvas" width="130" height="130"></canvas>
                    </div>
                </div>

                <div class="status-display" id="statusDisplay">
                    <div id="equilibriumStatus">Muvozanat holati tekshirilmoqda...</div>
                    <div class="component-display">
                        <div class="component-box">
                            <strong>Œ£F‚Çì</strong><br>
                            <span id="sumFx">0.00</span> N
                        </div>
                        <div class="component-box">
                            <strong>Œ£F·µß</strong><br>
                            <span id="sumFy">0.00</span> N
                        </div>
                    </div>
                </div>
            </div>

            <div class="controls-panel">
                <div class="control-group">
                    <h3>üéØ Kuch qo'shish 
                        <div class="help-tooltip">
                            <span style="cursor: help;">‚ÑπÔ∏è</span>
                            <div class="tooltip-text">Kuch qo'shish uchun kattalik va yo'nalishni kiriting</div>
                        </div>
                    </h3>
                    <div class="control-row">
                        <label>Kuch (N):</label>
                        <input type="number" id="forceInput" value="50" min="0" max="500" step="0.1" placeholder="Kuch qiymatini kiriting">
                    </div>
                    <div class="slider-container">
                        <input type="range" id="forceSlider" class="slider" min="0" max="500" value="50" step="0.1">
                        <div class="slider-labels">
                            <span>0N</span>
                            <span>250N</span>
                            <span>500N</span>
                        </div>
                    </div>
                    <div class="control-row">
                        <label>Burchak (¬∞):</label>
                        <input type="number" id="angleInput" value="0" min="0" max="360" step="0.1" placeholder="Burchak qiymatini kiriting">
                    </div>
                    <div class="slider-container">
                        <input type="range" id="angleSlider" class="slider" min="0" max="360" value="0" step="0.1">
                        <div class="slider-labels">
                            <span>0¬∞</span>
                            <span>180¬∞</span>
                            <span>360¬∞</span>
                        </div>
                    </div>
                    <div class="control-row">
                        <label>Kuch nomi:</label>
                        <input type="text" id="forceNameInput" placeholder="F1, F2, ..." style="width: 100px;">
                    </div>
                    <button class="btn btn-primary" id="addForceBtn">Kuch qo'shish</button>
                    <button class="btn btn-success" id="quickAddBtn">Tez qo'shish</button>
                </div>

                <div class="control-group">
                    <h3>üìù Kuch qiymatlarini kiritish</h3>
                    <div class="bulk-input-container">
                        <textarea id="bulkForceInput" rows="4" placeholder="Kuch qiymatlarini kiriting:&#10;Kuch1: 50N, 30¬∞&#10;Kuch2: 75N, 120¬∞&#10;Kuch3: 100N, 240¬∞" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-family: monospace; font-size: 0.9em;"></textarea>
                        <button class="btn btn-primary" id="addBulkForcesBtn" style="width: 100%; margin-top: 10px;">Ko'p kuch qo'shish</button>
                    </div>
                </div>

                <div class="control-group">
                    <h3>‚öñÔ∏è Muvozanat nazorati</h3>
                    <button class="btn btn-success" id="checkEquilibriumBtn">Muvozanatni tekshirish</button>
                    <button class="btn btn-warning" id="findEquilibriumBtn">Muvozanat kuchini topish</button>
                    <button class="btn btn-danger" id="clearAllBtn">Barchani tozalash</button>
                </div>

                <div class="control-group">
                    <h3>üìä Kuchlar ro'yxati</h3>
                    <div class="force-list" id="forceList">
                        <div style="text-align: center; color: #666; padding: 20px;">
                            Hozircha kuch qo'shilmagan
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <h3>ÔøΩ Ma'lumotlar boshqaruvi</h3>
                    <div class="control-row">
                        <button class="btn btn-primary" id="exportDataBtn">Ma'lumotlarni eksport qilish</button>
                        <button class="btn btn-success" id="importDataBtn">Ma'lumotlarni import qilish</button>
                    </div>
                    <input type="file" id="importFileInput" accept=".json" style="display: none;">
                    <div class="control-row">
                        <button class="btn btn-warning" id="saveToLocalBtn">Mahalliy saqlash</button>
                        <button class="btn btn-warning" id="loadFromLocalBtn">Mahalliydan yuklash</button>
                    </div>
                </div>

                <div class="control-group">
                    <h3>üîß Qo'shimcha sozlamalar</h3>
                    <div class="control-row">
                        <label>Kattalash:</label>
                        <input type="number" id="scaleInput" value="1" min="0.5" max="3" step="0.1">
                    </div>
                    <div class="control-row">
                        <label>Aniqlik:</label>
                        <input type="number" id="precisionInput" value="0.1" min="0.01" max="1" step="0.01">
                    </div>
                    <button class="btn btn-primary" id="showGridBtn">Koordinata to'rini ko'rsatish</button>
                </div>

                <div class="equilibrium-info" id="equilibriumInfo">
                    <h4>Muvozanat ma'lumotlari:</h4>
                    <div id="equilibriumDetails">
                        <p><strong>Natijaviy kuch:</strong> <span id="resultantForce">0.00 N</span></p>
                        <p><strong>Natijaviy burchak:</strong> <span id="resultantAngle">0.00¬∞</span></p>
                        <p><strong>Muvozanat holati:</strong> <span id="equilibriumState">Tekshirilmagan</span></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="theory-section">
            <h2>üìö Nazariy ma'lumotlar</h2>
            
            <div class="formula-box">
                <h3>Muvozanat sharti:</h3>
                <p>$$\sum \vec{F} = 0$$</p>
                <p>$$\sum F_x = 0 \quad \text{va} \quad \sum F_y = 0$$</p>
            </div>

            <div class="formula-box">
                <h3>Kuch komponentlari:</h3>
                <p>$$F_x = F \cos \theta$$</p>
                <p>$$F_y = F \sin \theta$$</p>
            </div>

            <div class="formula-box">
                <h3>Natijaviy kuch:</h3>
                <p>$$F_{res} = \sqrt{(\sum F_x)^2 + (\sum F_y)^2}$$</p>
                <p>$$\theta_{res} = \arctan\left(\frac{\sum F_y}{\sum F_x}\right)$$</p>
            </div>

            <h3>Kuchlar muvozanati haqida:</h3>
            <p><strong>Kuchlar muvozanati</strong> - bu jismga ta'sir etuvchi barcha kuchlarning vektor yig'indisi nolga teng bo'lgan holat.</p>
            
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><strong>Statik muvozanat:</strong> Jism tinch holatda turadi (v = 0, a = 0)</li>
                <li><strong>Dinamik muvozanat:</strong> Jism tekis harakat qiladi (a = 0, v = const)</li>
                <li><strong>Kuch poligoni:</strong> Muvozanat holatida barcha kuchlar yopiq poligon hosil qiladi</li>
                <li><strong>Komponentlar bo'yicha muvozanat:</strong> Har bir yo'nalish bo'yicha kuchlar yig'indisi nolga teng</li>
            </ul>

            <h3>Amaliy qo'llanmalar:</h3>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>Binolar va ko'priklar qurilishi</li>
                <li>Kranlar va ko'tarish mexanizmlari</li>
                <li>Aviatsiya va kosmik texnika</li>
                <li>Avtomobil suspenziyasi</li>
            </ul>
        </div>
    </div>

    <script>
        class ForceEquilibriumSimulation {
            constructor() {
                this.canvas = document.getElementById('simulationCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.polygonCanvas = document.getElementById('polygonCanvas');
                this.polygonCtx = this.polygonCanvas.getContext('2d');
                
                this.forces = [];
                this.centerX = 0;
                this.centerY = 0;
                this.scale = 1;
                this.precision = 0.1;
                this.showGrid = false;
                this.colors = ['#007bff', '#28a745', '#dc3545', '#ffc107', '#6f42c1', '#fd7e14', '#20c997'];
                this.colorIndex = 0;
                
                this.setupCanvas();
                this.setupEventListeners();
                this.updateDisplay();
                this.animate();
            }

            setupCanvas() {
                const rect = this.canvas.getBoundingClientRect();
                this.canvas.width = rect.width;
                this.canvas.height = rect.height;
                this.centerX = this.canvas.width / 2;
                this.centerY = this.canvas.height / 2;
                
                window.addEventListener('resize', () => {
                    this.setupCanvas();
                    this.updateDisplay();
                });
            }

            setupEventListeners() {
                // Force input synchronization
                const forceInput = document.getElementById('forceInput');
                const forceSlider = document.getElementById('forceSlider');
                const angleInput = document.getElementById('angleInput');
                const angleSlider = document.getElementById('angleSlider');

                forceInput.addEventListener('input', (e) => {
                    forceSlider.value = e.target.value;
                    this.validateForceInput();
                });

                forceSlider.addEventListener('input', (e) => {
                    forceInput.value = e.target.value;
                    this.validateForceInput();
                });

                angleInput.addEventListener('input', (e) => {
                    angleSlider.value = e.target.value;
                    this.validateAngleInput();
                });

                angleSlider.addEventListener('input', (e) => {
                    angleInput.value = e.target.value;
                    this.validateAngleInput();
                });

                // Button events
                document.getElementById('addForceBtn').addEventListener('click', () => {
                    this.addForce();
                });

                document.getElementById('quickAddBtn').addEventListener('click', () => {
                    this.quickAddForce();
                });

                document.getElementById('addBulkForcesBtn').addEventListener('click', () => {
                    this.addBulkForces();
                });

                document.getElementById('checkEquilibriumBtn').addEventListener('click', () => {
                    this.checkEquilibrium();
                });

                document.getElementById('findEquilibriumBtn').addEventListener('click', () => {
                    this.findEquilibriumForce();
                });

                document.getElementById('clearAllBtn').addEventListener('click', () => {
                    this.clearAll();
                });

                document.getElementById('showGridBtn').addEventListener('click', () => {
                    this.toggleGrid();
                });

                // Data management
                document.getElementById('exportDataBtn').addEventListener('click', () => {
                    this.exportData();
                });

                document.getElementById('importDataBtn').addEventListener('click', () => {
                    document.getElementById('importFileInput').click();
                });

                document.getElementById('importFileInput').addEventListener('change', (e) => {
                    this.importData(e.target.files[0]);
                });

                document.getElementById('saveToLocalBtn').addEventListener('click', () => {
                    this.saveToLocal();
                });

                document.getElementById('loadFromLocalBtn').addEventListener('click', () => {
                    this.loadFromLocal();
                });

                // Settings
                document.getElementById('scaleInput').addEventListener('input', (e) => {
                    this.scale = parseFloat(e.target.value);
                    this.updateDisplay();
                });

                document.getElementById('precisionInput').addEventListener('input', (e) => {
                    this.precision = parseFloat(e.target.value);
                    this.updateDisplay();
                });

                // Canvas click to add force
                this.canvas.addEventListener('click', (e) => {
                    const rect = this.canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    // Calculate angle from center to click point
                    const dx = x - this.centerX;
                    const dy = y - this.centerY;
                    const angle = Math.atan2(-dy, dx) * 180 / Math.PI;
                    const normalizedAngle = angle < 0 ? angle + 360 : angle;
                    
                    angleInput.value = Math.round(normalizedAngle * 10) / 10;
                    angleSlider.value = Math.round(normalizedAngle * 10) / 10;
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        this.addForce();
                    } else if (e.key === 'Escape') {
                        this.clearAll();
                    } else if (e.key === ' ') {
                        e.preventDefault();
                        this.checkEquilibrium();
                    }
                });

                // Add quick value buttons
                this.addQuickValueButtons();
            }

            addForce() {
                const magnitude = parseFloat(document.getElementById('forceInput').value);
                const angle = parseFloat(document.getElementById('angleInput').value);
                const forceName = document.getElementById('forceNameInput').value.trim();

                if (!this.validateForceValues(magnitude, angle)) {
                    return;
                }

                const force = {
                    magnitude: magnitude,
                    angle: angle,
                    color: this.colors[this.colorIndex % this.colors.length],
                    id: Date.now(),
                    name: forceName || `F${this.forces.length + 1}`
                };

                this.forces.push(force);
                this.colorIndex++;
                this.updateDisplay();
                this.updateForceList();
                this.updateEquilibriumInfo();
                
                // Auto-increment angle for next force
                const nextAngle = (angle + 45) % 360;
                document.getElementById('angleInput').value = nextAngle;
                document.getElementById('angleSlider').value = nextAngle;
                
                // Clear force name input
                document.getElementById('forceNameInput').value = '';
                
                this.showSuccessMessage(`Kuch qo'shildi: ${force.name} = ${magnitude}N, ${angle}¬∞`);
            }

            quickAddForce() {
                const magnitude = parseFloat(document.getElementById('forceInput').value);
                const angle = parseFloat(document.getElementById('angleInput').value);
                
                if (!this.validateForceValues(magnitude, angle)) {
                    return;
                }

                this.addForce();
                
                // Auto-increment both values for quick adding
                const nextMagnitude = magnitude + 10;
                const nextAngle = (angle + 60) % 360;
                
                document.getElementById('forceInput').value = nextMagnitude;
                document.getElementById('forceSlider').value = nextMagnitude;
                document.getElementById('angleInput').value = nextAngle;
                document.getElementById('angleSlider').value = nextAngle;
            }

            addBulkForces() {
                const bulkInput = document.getElementById('bulkForceInput').value.trim();
                
                if (!bulkInput) {
                    this.showErrorMessage('Kuch qiymatlarini kiriting!');
                    return;
                }

                const lines = bulkInput.split('\n');
                const forces = [];
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    
                    const force = this.parseForceString(line);
                    if (force) {
                        forces.push(force);
                    } else {
                        this.showErrorMessage(`Xato ${i + 1}-qatorda: "${line}"`);
                        return;
                    }
                }
                
                if (forces.length === 0) {
                    this.showErrorMessage('Hech qanday to\'g\'ri kuch topilmadi!');
                    return;
                }
                
                // Add all forces
                forces.forEach(force => {
                    const forceObj = {
                        magnitude: force.magnitude,
                        angle: force.angle,
                        color: this.colors[this.colorIndex % this.colors.length],
                        id: Date.now() + Math.random(),
                        name: force.name || `F${this.forces.length + 1}`
                    };
                    
                    this.forces.push(forceObj);
                    this.colorIndex++;
                });
                
                this.updateDisplay();
                this.updateForceList();
                this.updateEquilibriumInfo();
                
                this.showSuccessMessage(`${forces.length} ta kuch qo'shildi!`);
                document.getElementById('bulkForceInput').value = '';
            }

            parseForceString(str) {
                // Parse formats like: "F1: 50N, 30¬∞" or "50N, 30¬∞" or "50, 30"
                const patterns = [
                    /^(\w+):\s*([0-9.]+)N?,?\s*([0-9.]+)¬∞?$/i,
                    /^([0-9.]+)N?,?\s*([0-9.]+)¬∞?$/i,
                    /^([0-9.]+),?\s*([0-9.]+)$/i
                ];
                
                for (const pattern of patterns) {
                    const match = str.match(pattern);
                    if (match) {
                        if (match.length === 4) {
                            // Has name
                            return {
                                name: match[1],
                                magnitude: parseFloat(match[2]),
                                angle: parseFloat(match[3])
                            };
                        } else if (match.length === 3) {
                            // No name
                            return {
                                magnitude: parseFloat(match[1]),
                                angle: parseFloat(match[2])
                            };
                        }
                    }
                }
                
                return null;
            }

            validateForceValues(magnitude, angle) {
                if (isNaN(magnitude) || magnitude <= 0) {
                    this.showErrorMessage('Kuch qiymati musbat son bo\'lishi kerak!');
                    return false;
                }
                
                if (isNaN(angle) || angle < 0 || angle > 360) {
                    this.showErrorMessage('Burchak 0-360 orasida bo\'lishi kerak!');
                    return false;
                }
                
                return true;
            }

            validateForceInput() {
                const magnitude = parseFloat(document.getElementById('forceInput').value);
                const isValid = !isNaN(magnitude) && magnitude > 0;
                
                this.showInputValidation('forceInput', isValid, 
                    isValid ? 'To\'g\'ri qiymat' : 'Musbat son kiriting');
            }

            validateAngleInput() {
                const angle = parseFloat(document.getElementById('angleInput').value);
                const isValid = !isNaN(angle) && angle >= 0 && angle <= 360;
                
                this.showInputValidation('angleInput', isValid,
                    isValid ? 'To\'g\'ri burchak' : '0-360 orasida bo\'lishi kerak');
            }

            showInputValidation(inputId, isValid, message) {
                const input = document.getElementById(inputId);
                let validation = input.parentNode.querySelector('.input-validation');
                
                if (!validation) {
                    validation = document.createElement('div');
                    validation.className = 'input-validation';
                    input.parentNode.appendChild(validation);
                }
                
                validation.textContent = message;
                validation.className = `input-validation ${isValid ? 'input-valid' : 'input-invalid'}`;
            }

            showSuccessMessage(message) {
                this.showMessage(message, 'success');
            }

            showErrorMessage(message) {
                this.showMessage(message, 'error');
            }

            showMessage(message, type) {
                const messageDiv = document.createElement('div');
                messageDiv.textContent = message;
                messageDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 20px;
                    border-radius: 8px;
                    color: white;
                    font-weight: 500;
                    z-index: 1000;
                    animation: slideIn 0.3s ease-in-out;
                    max-width: 300px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                `;
                
                if (type === 'success') {
                    messageDiv.style.background = '#28a745';
                } else {
                    messageDiv.style.background = '#dc3545';
                }
                
                document.body.appendChild(messageDiv);
                
                setTimeout(() => {
                    messageDiv.remove();
                }, 3000);
            }

            addQuickValueButtons() {
                const forceInputContainer = document.getElementById('forceInput').parentNode;
                const angleInputContainer = document.getElementById('angleInput').parentNode;
                
                // Force quick values
                const forceQuickValues = [10, 25, 50, 75, 100, 150, 200];
                const forceQuickContainer = document.createElement('div');
                forceQuickContainer.className = 'quick-values';
                forceQuickContainer.innerHTML = forceQuickValues.map(value => 
                    `<button class="quick-value-btn" onclick="simulation.setForceValue(${value})">${value}N</button>`
                ).join('');
                
                forceInputContainer.appendChild(forceQuickContainer);
                
                // Angle quick values
                const angleQuickValues = [0, 30, 45, 60, 90, 120, 135, 180, 270];
                const angleQuickContainer = document.createElement('div');
                angleQuickContainer.className = 'quick-values';
                angleQuickContainer.innerHTML = angleQuickValues.map(value => 
                    `<button class="quick-value-btn" onclick="simulation.setAngleValue(${value})">${value}¬∞</button>`
                ).join('');
                
                angleInputContainer.appendChild(angleQuickContainer);
            }

            setForceValue(value) {
                document.getElementById('forceInput').value = value;
                document.getElementById('forceSlider').value = value;
                this.validateForceInput();
            }

            setAngleValue(value) {
                document.getElementById('angleInput').value = value;
                document.getElementById('angleSlider').value = value;
                this.validateAngleInput();
            }

            exportData() {
                const data = {
                    forces: this.forces,
                    settings: {
                        scale: this.scale,
                        precision: this.precision,
                        showGrid: this.showGrid
                    },
                    timestamp: new Date().toISOString(),
                    version: '1.0'
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `kuchlar-muvozanati-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                this.showSuccessMessage('Ma\'lumotlar eksport qilindi');
            }

            importData(file) {
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (data.forces && Array.isArray(data.forces)) {
                            this.forces = data.forces;
                            this.colorIndex = data.forces.length;
                            
                            if (data.settings) {
                                this.scale = data.settings.scale || 1;
                                this.precision = data.settings.precision || 0.1;
                                this.showGrid = data.settings.showGrid || false;
                                
                                document.getElementById('scaleInput').value = this.scale;
                                document.getElementById('precisionInput').value = this.precision;
                                document.getElementById('showGridBtn').textContent = 
                                    this.showGrid ? 'Koordinata to\'rini yashirish' : 'Koordinata to\'rini ko\'rsatish';
                            }
                            
                            this.updateDisplay();
                            this.updateForceList();
                            this.updateEquilibriumInfo();
                            
                            this.showSuccessMessage(`${data.forces.length} ta kuch yuklandi`);
                        } else {
                            this.showErrorMessage('Noto\'g\'ri fayl formati');
                        }
                    } catch (error) {
                        this.showErrorMessage('Faylni o\'qishda xatolik yuz berdi');
                    }
                };
                
                reader.readAsText(file);
            }

            saveToLocal() {
                const data = {
                    forces: this.forces,
                    settings: {
                        scale: this.scale,
                        precision: this.precision,
                        showGrid: this.showGrid
                    },
                    timestamp: new Date().toISOString()
                };

                localStorage.setItem('kuchlar-muvozanati', JSON.stringify(data));
                this.showSuccessMessage('Ma\'lumotlar mahalliy saqlandi');
            }

            loadFromLocal() {
                const saved = localStorage.getItem('kuchlar-muvozanati');
                if (!saved) {
                    this.showErrorMessage('Saqlangan ma\'lumotlar topilmadi');
                    return;
                }

                try {
                    const data = JSON.parse(saved);
                    
                    if (data.forces && Array.isArray(data.forces)) {
                        this.forces = data.forces;
                        this.colorIndex = data.forces.length;
                        
                        if (data.settings) {
                            this.scale = data.settings.scale || 1;
                            this.precision = data.settings.precision || 0.1;
                            this.showGrid = data.settings.showGrid || false;
                            
                            document.getElementById('scaleInput').value = this.scale;
                            document.getElementById('precisionInput').value = this.precision;
                            document.getElementById('showGridBtn').textContent = 
                                this.showGrid ? 'Koordinata to\'rini yashirish' : 'Koordinata to\'rini ko\'rsatish';
                        }
                        
                        this.updateDisplay();
                        this.updateForceList();
                        this.updateEquilibriumInfo();
                        
                        this.showSuccessMessage(`${data.forces.length} ta kuch yuklandi`);
                    } else {
                        this.showErrorMessage('Noto\'g\'ri ma\'lumot formati');
                    }
                } catch (error) {
                    this.showErrorMessage('Ma\'lumotlarni yuklashda xatolik');
                }
            }

            removeForce(id) {
                this.forces = this.forces.filter(force => force.id !== id);
                this.updateDisplay();
                this.updateForceList();
                this.updateEquilibriumInfo();
                this.showSuccessMessage('Kuch o\'chirildi');
            }

            editForce(id) {
                const force = this.forces.find(f => f.id === id);
                if (!force) return;
                
                // Fill inputs with current values
                document.getElementById('forceInput').value = force.magnitude;
                document.getElementById('forceSlider').value = force.magnitude;
                document.getElementById('angleInput').value = force.angle;
                document.getElementById('angleSlider').value = force.angle;
                document.getElementById('forceNameInput').value = force.name || '';
                
                // Remove the force temporarily
                this.removeForce(id);
                
                // Change button text to indicate editing
                const addBtn = document.getElementById('addForceBtn');
                const originalText = addBtn.textContent;
                addBtn.textContent = 'Tahrirlashni saqlash';
                addBtn.style.background = '#28a745';
                
                // Restore button after some time
                setTimeout(() => {
                    addBtn.textContent = originalText;
                    addBtn.style.background = '#007bff';
                }, 5000);
                
                this.showSuccessMessage('Kuch tahrirlash uchun yuklandi');
            }

            clearAll() {
                this.forces = [];
                this.colorIndex = 0;
                this.updateDisplay();
                this.updateForceList();
                this.updateEquilibriumInfo();
            }

            checkEquilibrium() {
                const { sumFx, sumFy } = this.calculateComponents();
                const resultantMagnitude = Math.sqrt(sumFx * sumFx + sumFy * sumFy);
                const isEquilibrium = Math.abs(resultantMagnitude) < this.precision;

                const statusDisplay = document.getElementById('statusDisplay');
                const equilibriumStatus = document.getElementById('equilibriumStatus');

                if (isEquilibrium) {
                    statusDisplay.className = 'status-display status-equilibrium';
                    equilibriumStatus.textContent = '‚úÖ Muvozanat holati: Kuchlar muvozanatda!';
                } else {
                    statusDisplay.className = 'status-display status-not-equilibrium';
                    equilibriumStatus.textContent = '‚ùå Muvozanat holati: Kuchlar muvozanatda emas!';
                }

                // Add pulse animation
                statusDisplay.classList.add('pulse');
                setTimeout(() => {
                    statusDisplay.classList.remove('pulse');
                }, 2000);
            }

            findEquilibriumForce() {
                if (this.forces.length === 0) {
                    alert('Avval kuch qo\'shing!');
                    return;
                }

                const { sumFx, sumFy } = this.calculateComponents();
                const equilibriumMagnitude = Math.sqrt(sumFx * sumFx + sumFy * sumFy);
                const equilibriumAngle = Math.atan2(-sumFy, -sumFx) * 180 / Math.PI;
                const normalizedAngle = equilibriumAngle < 0 ? equilibriumAngle + 360 : equilibriumAngle;

                if (equilibriumMagnitude < this.precision) {
                    alert('Tizim allaqachon muvozanatda!');
                    return;
                }

                const equilibriumForce = {
                    magnitude: equilibriumMagnitude,
                    angle: normalizedAngle,
                    color: '#28a745',
                    id: Date.now(),
                    isEquilibrium: true
                };

                this.forces.push(equilibriumForce);
                this.updateDisplay();
                this.updateForceList();
                this.updateEquilibriumInfo();
                
                alert(`Muvozanat kuchi: ${equilibriumMagnitude.toFixed(2)} N, ${normalizedAngle.toFixed(1)}¬∞`);
            }

            calculateComponents() {
                let sumFx = 0;
                let sumFy = 0;

                this.forces.forEach(force => {
                    const angleRad = force.angle * Math.PI / 180;
                    sumFx += force.magnitude * Math.cos(angleRad);
                    sumFy += force.magnitude * Math.sin(angleRad);
                });

                return { sumFx, sumFy };
            }

            toggleGrid() {
                this.showGrid = !this.showGrid;
                const button = document.getElementById('showGridBtn');
                button.textContent = this.showGrid ? 'Koordinata to\'rini yashirish' : 'Koordinata to\'rini ko\'rsatish';
                this.updateDisplay();
            }

            updateDisplay() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                if (this.showGrid) {
                    this.drawGrid();
                }

                this.drawAxes();
                this.drawForces();
                this.drawResultantForce();
                this.drawForcePolygon();
            }

            drawGrid() {
                this.ctx.strokeStyle = '#e0e0e0';
                this.ctx.lineWidth = 1;
                this.ctx.globalAlpha = 0.5;

                const spacing = 20;
                for (let x = 0; x <= this.canvas.width; x += spacing) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, 0);
                    this.ctx.lineTo(x, this.canvas.height);
                    this.ctx.stroke();
                }

                for (let y = 0; y <= this.canvas.height; y += spacing) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, y);
                    this.ctx.lineTo(this.canvas.width, y);
                    this.ctx.stroke();
                }

                this.ctx.globalAlpha = 1;
            }

            drawAxes() {
                this.ctx.strokeStyle = '#333';
                this.ctx.lineWidth = 2;
                this.ctx.globalAlpha = 0.7;

                // X-axis
                this.ctx.beginPath();
                this.ctx.moveTo(0, this.centerY);
                this.ctx.lineTo(this.canvas.width, this.centerY);
                this.ctx.stroke();

                // Y-axis
                this.ctx.beginPath();
                this.ctx.moveTo(this.centerX, 0);
                this.ctx.lineTo(this.centerX, this.canvas.height);
                this.ctx.stroke();

                // Axis labels
                this.ctx.fillStyle = '#333';
                this.ctx.font = '14px Arial';
                this.ctx.fillText('X', this.canvas.width - 20, this.centerY - 10);
                this.ctx.fillText('Y', this.centerX + 10, 20);

                this.ctx.globalAlpha = 1;
            }

            drawForces() {
                this.forces.forEach((force, index) => {
                    this.drawForceVector(force, index);
                });
            }

            drawForceVector(force, index) {
                const angleRad = force.angle * Math.PI / 180;
                const length = force.magnitude * this.scale;
                const endX = this.centerX + length * Math.cos(angleRad);
                const endY = this.centerY - length * Math.sin(angleRad);

                // Draw vector line
                this.ctx.strokeStyle = force.color;
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();
                this.ctx.moveTo(this.centerX, this.centerY);
                this.ctx.lineTo(endX, endY);
                this.ctx.stroke();

                // Draw arrowhead
                this.drawArrowhead(this.centerX, this.centerY, endX, endY, force.color);

                // Draw force label
                const labelX = this.centerX + (length * 0.7) * Math.cos(angleRad);
                const labelY = this.centerY - (length * 0.7) * Math.sin(angleRad);
                
                this.ctx.fillStyle = force.color;
                this.ctx.font = 'bold 12px Arial';
                this.ctx.fillText(`F${index + 1}`, labelX + 5, labelY + 5);
                this.ctx.font = '10px Arial';
                this.ctx.fillText(`${force.magnitude}N`, labelX + 5, labelY + 18);
            }

            drawArrowhead(startX, startY, endX, endY, color) {
                const headlen = 12;
                const angle = Math.atan2(endY - startY, endX - startX);

                this.ctx.fillStyle = color;
                this.ctx.beginPath();
                this.ctx.moveTo(endX, endY);
                this.ctx.lineTo(endX - headlen * Math.cos(angle - Math.PI / 6), endY - headlen * Math.sin(angle - Math.PI / 6));
                this.ctx.lineTo(endX - headlen * Math.cos(angle + Math.PI / 6), endY - headlen * Math.sin(angle + Math.PI / 6));
                this.ctx.closePath();
                this.ctx.fill();
            }

            drawResultantForce() {
                if (this.forces.length === 0) return;

                const { sumFx, sumFy } = this.calculateComponents();
                const resultantMagnitude = Math.sqrt(sumFx * sumFx + sumFy * sumFy);
                
                if (resultantMagnitude < this.precision) return;

                const resultantAngle = Math.atan2(sumFy, sumFx);
                const length = resultantMagnitude * this.scale;
                const endX = this.centerX + length * Math.cos(resultantAngle);
                const endY = this.centerY - length * Math.sin(resultantAngle);

                // Draw resultant vector
                this.ctx.strokeStyle = '#dc3545';
                this.ctx.lineWidth = 4;
                this.ctx.setLineDash([5, 5]);
                this.ctx.beginPath();
                this.ctx.moveTo(this.centerX, this.centerY);
                this.ctx.lineTo(endX, endY);
                this.ctx.stroke();
                this.ctx.setLineDash([]);

                // Draw arrowhead
                this.drawArrowhead(this.centerX, this.centerY, endX, endY, '#dc3545');

                // Draw label
                const labelX = this.centerX + (length * 0.5) * Math.cos(resultantAngle);
                const labelY = this.centerY - (length * 0.5) * Math.sin(resultantAngle);
                
                this.ctx.fillStyle = '#dc3545';
                this.ctx.font = 'bold 12px Arial';
                this.ctx.fillText('R', labelX + 5, labelY + 5);
                this.ctx.font = '10px Arial';
                this.ctx.fillText(`${resultantMagnitude.toFixed(1)}N`, labelX + 5, labelY + 18);
            }

            drawForcePolygon() {
                if (this.forces.length < 2) return;

                this.polygonCtx.clearRect(0, 0, 130, 130);
                
                const centerX = 65;
                const centerY = 65;
                const maxRadius = 50;
                
                // Find maximum force for scaling
                const maxForce = Math.max(...this.forces.map(f => f.magnitude));
                const scale = maxRadius / maxForce;

                this.polygonCtx.strokeStyle = '#333';
                this.polygonCtx.lineWidth = 1;
                this.polygonCtx.globalAlpha = 0.3;

                // Draw grid
                for (let r = 10; r <= maxRadius; r += 10) {
                    this.polygonCtx.beginPath();
                    this.polygonCtx.arc(centerX, centerY, r, 0, 2 * Math.PI);
                    this.polygonCtx.stroke();
                }

                this.polygonCtx.globalAlpha = 1;

                // Draw force polygon
                let currentX = centerX;
                let currentY = centerY;
                const startX = currentX;
                const startY = currentY;

                this.forces.forEach((force, index) => {
                    const angleRad = force.angle * Math.PI / 180;
                    const length = force.magnitude * scale;
                    const nextX = currentX + length * Math.cos(angleRad);
                    const nextY = currentY - length * Math.sin(angleRad);

                    this.polygonCtx.strokeStyle = force.color;
                    this.polygonCtx.lineWidth = 2;
                    this.polygonCtx.beginPath();
                    this.polygonCtx.moveTo(currentX, currentY);
                    this.polygonCtx.lineTo(nextX, nextY);
                    this.polygonCtx.stroke();

                    // Draw small arrowhead
                    const headlen = 6;
                    const angle = Math.atan2(nextY - currentY, nextX - currentX);
                    this.polygonCtx.fillStyle = force.color;
                    this.polygonCtx.beginPath();
                    this.polygonCtx.moveTo(nextX, nextY);
                    this.polygonCtx.lineTo(nextX - headlen * Math.cos(angle - Math.PI / 6), nextY - headlen * Math.sin(angle - Math.PI / 6));
                    this.polygonCtx.lineTo(nextX - headlen * Math.cos(angle + Math.PI / 6), nextY - headlen * Math.sin(angle + Math.PI / 6));
                    this.polygonCtx.closePath();
                    this.polygonCtx.fill();

                    currentX = nextX;
                    currentY = nextY;
                });

                // Draw closing line (resultant)
                const distance = Math.sqrt((currentX - startX) ** 2 + (currentY - startY) ** 2);
                if (distance > 1) {
                    this.polygonCtx.strokeStyle = '#dc3545';
                    this.polygonCtx.lineWidth = 2;
                    this.polygonCtx.setLineDash([3, 3]);
                    this.polygonCtx.beginPath();
                    this.polygonCtx.moveTo(currentX, currentY);
                    this.polygonCtx.lineTo(startX, startY);
                    this.polygonCtx.stroke();
                    this.polygonCtx.setLineDash([]);
                }

                // Draw center point
                this.polygonCtx.fillStyle = '#333';
                this.polygonCtx.beginPath();
                this.polygonCtx.arc(centerX, centerY, 2, 0, 2 * Math.PI);
                this.polygonCtx.fill();
            }

            updateForceList() {
                const forceList = document.getElementById('forceList');
                
                if (this.forces.length === 0) {
                    forceList.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">Hozircha kuch qo\'shilmagan</div>';
                    return;
                }

                forceList.innerHTML = this.forces.map((force, index) => `
                    <div class="force-item">
                        <div style="display: flex; align-items: center;">
                            <div class="force-color" style="background: ${force.color};"></div>
                            <div class="force-info">
                                <strong>${force.name || `F${index + 1}`}:</strong> ${force.magnitude}N, ${force.angle.toFixed(1)}¬∞
                                ${force.isEquilibrium ? '<br><small style="color: #28a745;">Muvozanat kuchi</small>' : ''}
                                <br><small style="color: #666;">
                                    Fx: ${(force.magnitude * Math.cos(force.angle * Math.PI / 180)).toFixed(2)}N, 
                                    Fy: ${(force.magnitude * Math.sin(force.angle * Math.PI / 180)).toFixed(2)}N
                                </small>
                            </div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button class="btn btn-warning" onclick="simulation.editForce(${force.id})" style="padding: 4px 8px; font-size: 0.8em;">‚úèÔ∏è</button>
                            <button class="btn btn-danger" onclick="simulation.removeForce(${force.id})" style="padding: 4px 8px; font-size: 0.8em;">√ó</button>
                        </div>
                    </div>
                `).join('');
            }

            updateEquilibriumInfo() {
                const { sumFx, sumFy } = this.calculateComponents();
                const resultantMagnitude = Math.sqrt(sumFx * sumFx + sumFy * sumFy);
                const resultantAngle = Math.atan2(sumFy, sumFx) * 180 / Math.PI;
                const normalizedAngle = resultantAngle < 0 ? resultantAngle + 360 : resultantAngle;
                const isEquilibrium = Math.abs(resultantMagnitude) < this.precision;

                document.getElementById('sumFx').textContent = sumFx.toFixed(2);
                document.getElementById('sumFy').textContent = sumFy.toFixed(2);
                document.getElementById('resultantForce').textContent = resultantMagnitude.toFixed(2) + ' N';
                document.getElementById('resultantAngle').textContent = normalizedAngle.toFixed(1) + '¬∞';
                document.getElementById('equilibriumState').textContent = isEquilibrium ? 'Muvozanatda' : 'Muvozanatda emas';
            }

            animate() {
                this.updateDisplay();
                requestAnimationFrame(() => this.animate());
            }
        }

        // Initialize simulation
        let simulation;
        
        document.addEventListener('DOMContentLoaded', () => {
            simulation = new ForceEquilibriumSimulation();
            
            // Initialize MathJax
            if (window.MathJax) {
                MathJax.typesetPromise();
            }
        });

        // Add some preset scenarios
        function addPresetScenarios() {
            const scenarios = [
                {
                    name: 'Uchburchak muvozanat',
                    forces: [
                        { magnitude: 100, angle: 0 },
                        { magnitude: 100, angle: 120 },
                        { magnitude: 100, angle: 240 }
                    ]
                },
                {
                    name: 'To\'rtburchak muvozanat',
                    forces: [
                        { magnitude: 80, angle: 0 },
                        { magnitude: 80, angle: 90 },
                        { magnitude: 80, angle: 180 },
                        { magnitude: 80, angle: 270 }
                    ]
                },
                {
                    name: 'Asimmetrik muvozanat',
                    forces: [
                        { magnitude: 150, angle: 30 },
                        { magnitude: 100, angle: 150 },
                        { magnitude: 120, angle: 270 }
                    ]
                }
            ];

            // Add preset buttons
            const controlsPanel = document.querySelector('.controls-panel');
            const presetGroup = document.createElement('div');
            presetGroup.className = 'control-group';
            presetGroup.innerHTML = `
                <h3>üé≤ Tayyor senariylar</h3>
                ${scenarios.map((scenario, index) => `
                    <button class="btn btn-primary" onclick="loadPreset(${index})" style="margin: 2px; width: 100%;">
                        ${scenario.name}
                    </button>
                `).join('')}
            `;
            controlsPanel.appendChild(presetGroup);

            // Make loadPreset function global
            window.loadPreset = function(index) {
                const scenario = scenarios[index];
                simulation.clearAll();
                
                scenario.forces.forEach(force => {
                    setTimeout(() => {
                        const forceObj = {
                            magnitude: force.magnitude,
                            angle: force.angle,
                            color: simulation.colors[simulation.colorIndex % simulation.colors.length],
                            id: Date.now() + Math.random()
                        };
                        simulation.forces.push(forceObj);
                        simulation.colorIndex++;
                        simulation.updateDisplay();
                        simulation.updateForceList();
                        simulation.updateEquilibriumInfo();
                    }, simulation.forces.length * 100);
                });
            };
        }

        // Add presets when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(addPresetScenarios, 1000);
        });

        // Add touch support for mobile
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('simulationCanvas');
            
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                
                const dx = x - simulation.centerX;
                const dy = y - simulation.centerY;
                const angle = Math.atan2(-dy, dx) * 180 / Math.PI;
                const normalizedAngle = angle < 0 ? angle + 360 : angle;
                
                document.getElementById('angleInput').value = Math.round(normalizedAngle);
                document.getElementById('angleSlider').value = Math.round(normalizedAngle);
            });
        });
    </script>
</body>
</html>
