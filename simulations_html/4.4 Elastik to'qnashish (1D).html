<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elastik To'qnashish (1D)</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 20px; }
        h2, h3 { color: #34495e; margin: 15px 0; }
        .theory { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #3498db; }
        .formula { background: #e3f2fd; padding: 15px; margin: 10px 0; border-radius: 6px; text-align: center; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .controls { background: #f8f9fa; padding: 20px; border-radius: 8px; }
        .control-group { margin-bottom: 20px; }
        .control-header { display: flex; justify-content: space-between; margin-bottom: 8px; }
        label { font-weight: 600; color: #2c3e50; }
        .value { background: #3498db; color: white; padding: 4px 12px; border-radius: 12px; font-size: 14px; font-weight: bold; }
        input[type="range"] { width: 100%; height: 40px; cursor: pointer; }
        input[type="number"] { width: 80px; padding: 8px; border: 2px solid #ddd; border-radius: 6px; }
        .presets { display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap; }
        .preset-btn { background: #e9ecef; border: 2px solid #dee2e6; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; }
        .preset-btn:hover { background: #dee2e6; }
        .buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-top: 20px; }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        button:hover { background: #2980b9; transform: translateY(-2px); }
        .btn-success { background: #27ae60; }
        .btn-success:hover { background: #229954; }
        .btn-warning { background: #f39c12; }
        .btn-warning:hover { background: #e67e22; }
        .btn-danger { background: #e74c3c; }
        .btn-danger:hover { background: #c0392b; }
        .animation-box { background: #f8f9fa; padding: 20px; border-radius: 8px; }
        .track {
            width: 100%;
            height: 120px;
            background: linear-gradient(135deg, #ecf0f1 0%, #bdc3c7 100%);
            border-radius: 12px;
            position: relative;
            border: 2px solid #95a5a6;
            margin: 20px 0;
        }
        .track::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: #7f8c8d;
        }
        .ball {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            border: 3px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        .ball1 { background: radial-gradient(circle at 30% 30%, #e74c3c, #c0392b); left: 10%; }
        .ball2 { background: radial-gradient(circle at 30% 30%, #3498db, #2980b9); left: 70%; }
        .vector {
            position: absolute;
            top: 50%;
            height: 4px;
            background: linear-gradient(90deg, #f39c12, #e67e22);
            transform: translateY(-50%);
            border-radius: 2px;
            display: none;
            z-index: 5;
        }
        .collision-alert {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 20;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.5);
        }
        .collision-alert.active { opacity: 1; }
        .status {
            background: #17a2b8;
            color: white;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-weight: 600;
            margin-top: 10px;
        }
        .results {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid #28a745;
        }
        .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px; }
        .result-card { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
        .result-label { font-weight: 600; color: #2c3e50; margin-bottom: 8px; }
        .result-value { font-size: 18px; font-weight: bold; color: #27ae60; }
        .conservation {
            background: #fff3cd;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #ffc107;
            margin: 20px 0;
        }
        .conservation.valid { background: #d4edda; border-left-color: #28a745; }
        .conservation-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px; }
        .conservation-item { background: white; padding: 15px; border-radius: 8px; text-align: center; }
        .conservation-status { font-size: 24px; font-weight: bold; margin-top: 8px; }
        .conservation-status.valid { color: #28a745; }
        .conservation-status.invalid { color: #dc3545; }
        .graphs { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .graph { background: #f8f9fa; padding: 20px; border-radius: 12px; border: 2px solid #dee2e6; }
        .bar-chart { display: flex; align-items: end; height: 200px; gap: 15px; padding: 10px; background: white; border-radius: 8px; }
        .bar-column { flex: 1; display: flex; flex-direction: column; align-items: center; }
        .bar {
            width: 100%;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            min-height: 10px;
            border-radius: 4px 4px 0 0;
            position: relative;
            transition: all 0.3s;
        }
        .bar.energy { background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); }
        .bar-label { margin-top: 10px; font-size: 12px; font-weight: 600; text-align: center; }
        .scenarios { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .scenario {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #2196f3;
            cursor: pointer;
            transition: all 0.3s;
        }
        .scenario:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .scenario-title { font-weight: 600; color: #2c3e50; margin-bottom: 8px; }
        .scenario-desc { font-size: 14px; color: #7f8c8d; }
        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
            .container { padding: 15px; }
            body { padding: 10px; }
            .ball { width: 40px; height: 40px; font-size: 12px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>4.4 Elastik To'qnashish (1D)</h1>
        
        <div class="theory">
            <h3>Nazariy Asoslar</h3>
            <p><strong>Elastik to'qnashish</strong> - jismlarning to'qnashishida kinetik energiya saqlanib qoladigan to'qnashish turi.</p>
            <div class="formula">
                <strong>Impuls saqlanish:</strong> $$m_1v_1 + m_2v_2 = m_1v_1' + m_2v_2'$$
            </div>
            <div class="formula">
                <strong>Energiya saqlanish:</strong> $$\frac{1}{2}m_1v_1^2 + \frac{1}{2}m_2v_2^2 = \frac{1}{2}m_1v_1'^2 + \frac{1}{2}m_2v_2'^2$$
            </div>
        </div>

        <div class="grid">
            <div class="controls">
                <h3>Boshqarish Paneli</h3>
                
                <div class="control-group">
                    <div class="control-header">
                        <label>Massa m‚ÇÅ (kg)</label>
                        <span class="value" id="m1-val">1.0</span>
                    </div>
                    <input type="range" id="m1" min="0.1" max="10" step="0.1" value="1.0">
                    <div class="presets">
                        <button class="preset-btn" onclick="set('m1',0.5)">0.5</button>
                        <button class="preset-btn" onclick="set('m1',1.0)">1.0</button>
                        <button class="preset-btn" onclick="set('m1',2.0)">2.0</button>
                        <button class="preset-btn" onclick="set('m1',5.0)">5.0</button>
                    </div>
                </div>

                <div class="control-group">
                    <div class="control-header">
                        <label>Massa m‚ÇÇ (kg)</label>
                        <span class="value" id="m2-val">1.0</span>
                    </div>
                    <input type="range" id="m2" min="0.1" max="10" step="0.1" value="1.0">
                    <div class="presets">
                        <button class="preset-btn" onclick="set('m2',0.5)">0.5</button>
                        <button class="preset-btn" onclick="set('m2',1.0)">1.0</button>
                        <button class="preset-btn" onclick="set('m2',2.0)">2.0</button>
                        <button class="preset-btn" onclick="set('m2',5.0)">5.0</button>
                    </div>
                </div>

                <div class="control-group">
                    <div class="control-header">
                        <label>Tezlik v‚ÇÅ (m/s)</label>
                        <span class="value" id="v1-val">5.0</span>
                    </div>
                    <input type="range" id="v1" min="-15" max="15" step="0.1" value="5.0">
                    <div class="presets">
                        <button class="preset-btn" onclick="set('v1',-5)">-5</button>
                        <button class="preset-btn" onclick="set('v1',0)">0</button>
                        <button class="preset-btn" onclick="set('v1',5)">5</button>
                        <button class="preset-btn" onclick="set('v1',10)">10</button>
                    </div>
                </div>

                <div class="control-group">
                    <div class="control-header">
                        <label>Tezlik v‚ÇÇ (m/s)</label>
                        <span class="value" id="v2-val">0.0</span>
                    </div>
                    <input type="range" id="v2" min="-15" max="15" step="0.1" value="0.0">
                    <div class="presets">
                        <button class="preset-btn" onclick="set('v2',-5)">-5</button>
                        <button class="preset-btn" onclick="set('v2',0)">0</button>
                        <button class="preset-btn" onclick="set('v2',5)">5</button>
                        <button class="preset-btn" onclick="set('v2',10)">10</button>
                    </div>
                </div>

                <div class="buttons">
                    <button onclick="calc()">üßÆ Hisobla</button>
                    <button class="btn-success" onclick="startAnimation()" id="animBtn">‚ñ∂Ô∏è Animatsiya</button>
                    <button class="btn-danger" onclick="reset()">üîÑ Reset</button>
                </div>
            </div>

            <div class="animation-box">
                <h3>Animatsiya</h3>
                <div class="collision-alert" id="alert">TO'QNASHISH!</div>
                <div class="track" id="track">
                    <div class="ball ball1" id="ball1">m‚ÇÅ</div>
                    <div class="ball ball2" id="ball2">m‚ÇÇ</div>
                    <div class="vector" id="vec1"></div>
                    <div class="vector" id="vec2"></div>
                </div>
                <div class="status" id="status">Tayyor</div>
            </div>
        </div>

        <div class="results" id="results">
            <h3>Natijalar</h3>
            <div class="result-grid" id="result-content">
                <div class="result-card">
                    <div class="result-label">Parametrlarni o'rnating va "Hisobla" tugmasini bosing</div>
                </div>
            </div>
        </div>

        <div class="conservation" id="conservation">
            <h3>Saqlanish Qonunlari</h3>
            <div class="conservation-grid" id="cons-content"></div>
        </div>

        <div class="graphs">
            <div class="graph">
                <h3>Tezliklar</h3>
                <div class="bar-chart" id="vel-chart"></div>
            </div>
            <div class="graph">
                <h3>Energiya</h3>
                <div class="bar-chart" id="energy-chart"></div>
            </div>
        </div>

        <div>
            <h3>Maxsus Holatlar</h3>
            <div class="scenarios">
                <div class="scenario" onclick="scenario('equal')">
                    <div class="scenario-title">Teng Massalar</div>
                    <div class="scenario-desc">m‚ÇÅ=m‚ÇÇ, v‚ÇÅ=5, v‚ÇÇ=0</div>
                </div>
                <div class="scenario" onclick="scenario('heavy')">
                    <div class="scenario-title">Og'ir ‚Üí Yengil</div>
                    <div class="scenario-desc">m‚ÇÅ=5, m‚ÇÇ=0.5</div>
                </div>
                <div class="scenario" onclick="scenario('light')">
                    <div class="scenario-title">Yengil ‚Üí Og'ir</div>
                    <div class="scenario-desc">m‚ÇÅ=0.5, m‚ÇÇ=5</div>
                </div>
                <div class="scenario" onclick="scenario('head')">
                    <div class="scenario-title">Qarama-qarshi</div>
                    <div class="scenario-desc">v‚ÇÅ=5, v‚ÇÇ=-5</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let res = {}, animId, isAnim = false;

        function set(id, val) {
            document.getElementById(id).value = val;
            update();
        }

        function update() {
            ['m1','m2','v1','v2'].forEach(id => {
                document.getElementById(id+'-val').textContent = parseFloat(document.getElementById(id).value).toFixed(1);
            });
            calc();
        }

        function calc() {
            const m1 = parseFloat(document.getElementById('m1').value);
            const m2 = parseFloat(document.getElementById('m2').value);
            const v1 = parseFloat(document.getElementById('v1').value);
            const v2 = parseFloat(document.getElementById('v2').value);

            const v1f = ((m1-m2)*v1 + 2*m2*v2)/(m1+m2);
            const v2f = ((m2-m1)*v2 + 2*m1*v1)/(m1+m2);

            res = {
                m1, m2, v1, v2, v1f, v2f,
                ke1: 0.5*m1*v1*v1,
                ke2: 0.5*m2*v2*v2,
                ke1f: 0.5*m1*v1f*v1f,
                ke2f: 0.5*m2*v2f*v2f,
                p1: m1*v1,
                p2: m2*v2,
                p1f: m1*v1f,
                p2f: m2*v2f
            };

            showResults();
            showGraphs();
            showConservation();
        }

        function showResults() {
            document.getElementById('result-content').innerHTML = `
                <div class="result-card">
                    <div class="result-label">v‚ÇÅ: ${res.v1.toFixed(2)} ‚Üí ${res.v1f.toFixed(2)} m/s</div>
                </div>
                <div class="result-card">
                    <div class="result-label">v‚ÇÇ: ${res.v2.toFixed(2)} ‚Üí ${res.v2f.toFixed(2)} m/s</div>
                </div>
                <div class="result-card">
                    <div class="result-label">Impuls</div>
                    <div class="result-value">${(res.p1+res.p2).toFixed(2)} kg‚ãÖm/s</div>
                </div>
                <div class="result-card">
                    <div class="result-label">Energiya</div>
                    <div class="result-value">${(res.ke1+res.ke2).toFixed(2)} J</div>
                </div>
            `;
        }

        function showGraphs() {
            const maxV = Math.max(Math.abs(res.v1), Math.abs(res.v2), Math.abs(res.v1f), Math.abs(res.v2f)) || 1;
            const maxE = Math.max(res.ke1, res.ke2, res.ke1f, res.ke2f) || 1;

            document.getElementById('vel-chart').innerHTML = 
                bar(res.v1, maxV, 'v‚ÇÅ') + bar(res.v2, maxV, 'v‚ÇÇ') + 
                bar(res.v1f, maxV, "v‚ÇÅ'") + bar(res.v2f, maxV, "v‚ÇÇ'");

            document.getElementById('energy-chart').innerHTML = 
                bar(res.ke1, maxE, 'KE‚ÇÅ', true) + bar(res.ke2, maxE, 'KE‚ÇÇ', true) + 
                bar(res.ke1f, maxE, "KE‚ÇÅ'", true) + bar(res.ke2f, maxE, "KE‚ÇÇ'", true);
        }

        function bar(val, max, label, isE) {
            const h = Math.abs(val)/max*140+20;
            return `<div class="bar-column">
                <div class="bar ${isE?'energy':''}" style="height:${h}px"></div>
                <div class="bar-label">${label}<br>${val.toFixed(1)}</div>
            </div>`;
        }

        function showConservation() {
            const pBef = res.p1 + res.p2;
            const pAft = res.p1f + res.p2f;
            const eBef = res.ke1 + res.ke2;
            const eAft = res.ke1f + res.ke2f;
            
            const pOk = Math.abs(pBef-pAft) < 0.01;
            const eOk = Math.abs(eBef-eAft) < 0.01;

            document.getElementById('conservation').className = `conservation ${pOk&&eOk?'valid':''}`;
            document.getElementById('cons-content').innerHTML = `
                <div class="conservation-item">
                    <div>Impuls</div>
                    <div>${pBef.toFixed(2)} ‚âà ${pAft.toFixed(2)}</div>
                    <div class="conservation-status ${pOk?'valid':'invalid'}">${pOk?'‚úì':'‚úó'}</div>
                </div>
                <div class="conservation-item">
                    <div>Energiya</div>
                    <div>${eBef.toFixed(2)} ‚âà ${eAft.toFixed(2)}</div>
                    <div class="conservation-status ${eOk?'valid':'invalid'}">${eOk?'‚úì':'‚úó'}</div>
                </div>
            `;
        }

        function startAnimation() {
            if (isAnim) {
                clearInterval(animId);
                isAnim = false;
                document.getElementById('animBtn').textContent = '‚ñ∂Ô∏è Animatsiya';
                return;
            }

            calc();
            isAnim = true;
            document.getElementById('animBtn').textContent = '‚èπÔ∏è To\'xtat';

            const ball1 = document.getElementById('ball1');
            const ball2 = document.getElementById('ball2');
            const alert = document.getElementById('alert');

            let t = 0;
            const dur = 6000, colTime = 2000;

            animId = setInterval(() => {
                t += 30;
                const prog = t / dur;

                if (t <= colTime) {
                    const p = t / colTime;
                    ball1.style.left = (10 + res.v1*p*8) + '%';
                    ball2.style.left = (70 + res.v2*p*8) + '%';
                    document.getElementById('status').textContent = 'Harakat...';
                } else if (t <= colTime + 300) {
                    ball1.style.left = '45%';
                    ball2.style.left = '48%';
                    alert.classList.add('active');
                    document.getElementById('status').textContent = 'TO\'QNASHISH!';
                } else {
                    alert.classList.remove('active');
                    const p = (t - colTime - 300) / (dur - colTime - 300);
                    ball1.style.left = (45 + res.v1f*p*10) + '%';
                    ball2.style.left = (48 + res.v2f*p*10) + '%';
                    document.getElementById('status').textContent = 'Keyin harakat...';
                }

                if (t >= dur) {
                    clearInterval(animId);
                    isAnim = false;
                    document.getElementById('animBtn').textContent = '‚ñ∂Ô∏è Animatsiya';
                    document.getElementById('status').textContent = 'Tugadi';
                    resetBalls();
                }
            }, 30);
        }

        function resetBalls() {
            document.getElementById('ball1').style.left = '10%';
            document.getElementById('ball2').style.left = '70%';
        }

        function reset() {
            if (isAnim) {
                clearInterval(animId);
                isAnim = false;
                document.getElementById('animBtn').textContent = '‚ñ∂Ô∏è Animatsiya';
            }
            resetBalls();
            document.getElementById('status').textContent = 'Tayyor';
        }

        function scenario(type) {
            const scenarios = {
                equal: [1,1,5,0],
                heavy: [5,0.5,3,0],
                light: [0.5,5,8,0],
                head: [1,1,5,-5]
            };
            const [m1,m2,v1,v2] = scenarios[type];
            ['m1','m2','v1','v2'].forEach((id,i) => set(id,[m1,m2,v1,v2][i]));
        }

        ['m1','m2','v1','v2'].forEach(id => {
            document.getElementById(id).addEventListener('input', update);
        });

        window.addEventListener('load', () => {
            if (window.MathJax) MathJax.typesetPromise().then(calc);
            else calc();
        });
    </script>
</body>
</html>
