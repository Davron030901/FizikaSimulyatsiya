<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rezonans Hodisasi - Interaktiv Simulyatsiya</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Space+Mono:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #00f0ff;
            --secondary: #ff00aa;
            --accent: #ffaa00;
            --danger: #ff3366;
            --success: #00ff88;
            --bg-dark: #0a0e1a;
            --bg-medium: #131829;
            --bg-light: #1a1f38;
            --text: #e0e6ff;
            --text-dim: #8892b8;
            --border: rgba(0, 240, 255, 0.2);
            --glow: rgba(0, 240, 255, 0.3);
        }
        
        body {
            font-family: 'Space Mono', monospace;
            background: var(--bg-dark);
            color: var(--text);
            overflow-x: hidden;
            line-height: 1.6;
        }
        
        /* Background Animation */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(0, 240, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(255, 0, 170, 0.05) 0%, transparent 50%);
            animation: bgPulse 10s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }
        
        @keyframes bgPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--bg-medium) 0%, var(--bg-light) 100%);
            border-radius: 20px;
            border: 2px solid var(--border);
            box-shadow: 0 10px 40px rgba(0, 240, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        header::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 240, 255, 0.1), transparent);
            animation: shine 3s infinite;
        }
        
        @keyframes shine {
            to { left: 100%; }
        }
        
        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 4px;
            text-shadow: 0 0 30px var(--glow);
        }
        
        .subtitle {
            color: var(--text-dim);
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            letter-spacing: 2px;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (min-width: 1024px) {
            .main-grid {
                grid-template-columns: 2fr 1fr;
            }
        }
        
        .card {
            background: var(--bg-medium);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid var(--border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            border-color: var(--primary);
            box-shadow: 0 8px 32px var(--glow);
            transform: translateY(-2px);
        }
        
        .card-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.4rem;
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title::before {
            content: 'â—†';
            color: var(--secondary);
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }
        
        canvas {
            width: 100%;
            height: 400px;
            border-radius: 10px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            display: block;
            cursor: crosshair;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        @media (min-width: 768px) {
            .controls-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .control-group {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }
        
        .control-group:hover {
            border-color: var(--primary);
            box-shadow: 0 0 20px var(--glow);
        }
        
        .control-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: var(--text);
            font-weight: 700;
        }
        
        .control-value {
            color: var(--primary);
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1rem;
        }
        
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(90deg, var(--bg-dark) 0%, var(--primary) 100%);
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 0 10px var(--primary);
            transition: all 0.3s ease;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 20px var(--primary);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 0 10px var(--primary);
            border: none;
            transition: all 0.3s ease;
        }
        
        input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 20px var(--primary);
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            flex: 1;
            min-width: 120px;
            padding: 12px 24px;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text);
            background: linear-gradient(135deg, var(--bg-light), var(--bg-medium));
            border: 2px solid var(--primary);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: var(--primary);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
            opacity: 0.3;
        }
        
        button:hover::before {
            width: 300px;
            height: 300px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px var(--glow);
            border-color: var(--primary);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--bg-dark);
            box-shadow: 0 0 30px var(--glow);
        }
        
        button.danger {
            border-color: var(--danger);
        }
        
        button.danger:hover {
            box-shadow: 0 5px 20px rgba(255, 51, 102, 0.3);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-box {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border);
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-box:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--text-dim);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--primary);
            text-shadow: 0 0 10px var(--glow);
        }
        
        .theory-section {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid var(--secondary);
            margin-top: 20px;
        }
        
        .theory-section h3 {
            font-family: 'Orbitron', sans-serif;
            color: var(--secondary);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .formula-box {
            background: var(--bg-dark);
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid var(--border);
            overflow-x: auto;
        }
        
        .warning-box {
            background: linear-gradient(135deg, rgba(255, 51, 102, 0.1), rgba(255, 170, 0, 0.1));
            border: 2px solid var(--danger);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            animation: warningPulse 2s ease-in-out infinite;
        }
        
        @keyframes warningPulse {
            0%, 100% { box-shadow: 0 0 0 var(--danger); }
            50% { box-shadow: 0 0 20px var(--danger); }
        }
        
        .warning-box h3 {
            color: var(--danger);
            font-family: 'Orbitron', sans-serif;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .warning-box h3::before {
            content: 'âš ';
            font-size: 1.5rem;
            animation: shake 0.5s ease-in-out infinite;
        }
        
        @keyframes shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            75% { transform: rotate(10deg); }
        }
        
        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .preset-btn {
            min-width: auto;
            padding: 10px 15px;
            font-size: 0.85rem;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            color: var(--secondary);
            font-weight: 700;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--bg-dark);
            color: var(--text);
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid var(--primary);
            font-size: 0.8rem;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .lissajous-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .lissajous-item canvas {
            width: 100%;
            height: 200px;
        }
        
        .lissajous-label {
            text-align: center;
            margin-top: 10px;
            color: var(--text-dim);
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            header {
                padding: 20px 15px;
            }
            
            .card {
                padding: 15px;
            }
            
            canvas {
                height: 300px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                min-width: 100%;
            }
        }
        
        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Focus styles for keyboard navigation */
        button:focus,
        input:focus {
            outline: 3px solid var(--primary);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Rezonans Hodisasi</h1>
            <p class="subtitle">Interaktiv Fizika Simulyatsiyasi</p>
        </header>
        
        <div class="main-grid">
            <!-- Main Canvas Area -->
            <div class="card">
                <h2 class="card-title">Amplituda-Chastota Egri Chizig'i</h2>
                <canvas id="mainCanvas"></canvas>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Joriy Ï‰</div>
                        <div class="stat-value" id="currentOmega">0.0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Amplituda A</div>
                        <div class="stat-value" id="currentAmplitude">0.0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Rezonans Ï‰â‚€</div>
                        <div class="stat-value" id="resonanceFreq">0.0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Q Faktor</div>
                        <div class="stat-value" id="qFactor">0.0</div>
                    </div>
                </div>
            </div>
            
            <!-- Controls -->
            <div class="card">
                <h2 class="card-title">Boshqarish Paneli</h2>
                
                <div class="controls-grid">
                    <div class="control-group">
                        <div class="control-label">
                            <span>Ta'sir Chastotasi (Ï‰<sub>e</sub>)</span>
                            <span class="control-value" id="omegaValue">5.0</span>
                        </div>
                        <input type="range" id="omegaSlider" min="0.1" max="10" step="0.1" value="5">
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span>Tabiiy Chastota (Ï‰â‚€)</span>
                            <span class="control-value" id="omega0Value">5.0</span>
                        </div>
                        <input type="range" id="omega0Slider" min="0.1" max="10" step="0.1" value="5">
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span class="tooltip">So'nish Koeffitsienti (Î³)
                                <span class="tooltiptext">Kichik Î³ - keskin rezonans, katta Î³ - yumshoq rezonans</span>
                            </span>
                            <span class="control-value" id="gammaValue">0.5</span>
                        </div>
                        <input type="range" id="gammaSlider" min="0.05" max="2" step="0.05" value="0.5">
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span>Ta'sir Kuchi (Fâ‚€)</span>
                            <span class="control-value" id="forceValue">10</span>
                        </div>
                        <input type="range" id="forceSlider" min="1" max="50" step="1" value="10">
                    </div>
                </div>
                
                <div class="button-group">
                    <button id="playBtn" class="active">â–¶ Play</button>
                    <button id="resetBtn">â†» Reset</button>
                    <button id="snapBtn">ðŸ“¸ Screenshot</button>
                </div>
                
                <div class="control-group" style="margin-top: 20px;">
                    <div class="control-label">
                        <span>Animatsiya Tezligi</span>
                        <span class="control-value" id="speedValue">1.0x</span>
                    </div>
                    <input type="range" id="speedSlider" min="0.1" max="5" step="0.1" value="1">
                </div>
            </div>
        </div>
        
        <!-- Oscillation Visualization -->
        <div class="card">
            <h2 class="card-title">Tebranish Vizualizatsiyasi</h2>
            <canvas id="oscillationCanvas"></canvas>
        </div>
        
        <!-- Lissajous Figures -->
        <div class="card">
            <h2 class="card-title">Lissajous Figuralari</h2>
            <p style="color: var(--text-dim); margin-bottom: 15px;">
                Ikki perpendikulyar tebranishlar superpozitsiyasi
            </p>
            <div class="lissajous-grid">
                <div class="lissajous-item">
                    <canvas id="lissajous1"></canvas>
                    <div class="lissajous-label">1:1 (Î´=0Â°)</div>
                </div>
                <div class="lissajous-item">
                    <canvas id="lissajous2"></canvas>
                    <div class="lissajous-label">1:1 (Î´=90Â°)</div>
                </div>
                <div class="lissajous-item">
                    <canvas id="lissajous3"></canvas>
                    <div class="lissajous-label">2:1</div>
                </div>
                <div class="lissajous-item">
                    <canvas id="lissajous4"></canvas>
                    <div class="lissajous-label">3:2</div>
                </div>
            </div>
        </div>
        
        <!-- Presets -->
        <div class="card">
            <h2 class="card-title">Tayyor Stsenariylar</h2>
            <div class="preset-buttons">
                <button class="preset-btn" data-preset="sharp">Keskin Rezonans (Yuqori Q)</button>
                <button class="preset-btn" data-preset="broad">Keng Rezonans (Past Q)</button>
                <button class="preset-btn" data-preset="critical">Kritik So'nish</button>
                <button class="preset-btn" data-preset="underdamped">Kam So'nish</button>
                <button class="preset-btn" data-preset="overdamped">Haddan Tashqari So'nish</button>
                <button class="preset-btn" data-preset="danger">âš  Xavfli Rezonans</button>
            </div>
        </div>
        
        <!-- Warning Box -->
        <div class="warning-box">
            <h3>âš  Xavfli Rezonans</h3>
            <p>
                <strong>Rezonans xavfli bo'lishi mumkin!</strong> Agar Ï‰<sub>e</sub> â‰ˆ Ï‰â‚€ va so'nish juda kichik bo'lsa, 
                amplituda haddan tashqari oshadi. Bu ko'priklar, binolar va mexanik tizimlarning vayron bo'lishiga olib kelishi mumkin.
            </p>
            <p style="margin-top: 10px;">
                <strong>Mashhur misollar:</strong>
            </p>
            <ul style="margin-left: 20px; margin-top: 5px;">
                <li>Tacoma Narrows ko'prigi halokati (1940)</li>
                <li>Zilzilalarda binolar vayron bo'lishi</li>
                <li>Dvigatel vibratsiyalari</li>
                <li>Akustik rezonans (Stakan sinishi)</li>
            </ul>
        </div>
        
        <!-- Theory Section -->
        <div class="card">
            <h2 class="card-title">Nazariy Asoslar</h2>
            
            <div class="theory-section">
                <h3>Rezonans Sharti</h3>
                <p>
                    Rezonans - bu tashqi ta'sir chastotasi tizimning tabiiy tebranish chastotasiga teng bo'lganda 
                    yuzaga keladigan hodisa. Bu holda amplituda maksimal qiymatga erishadi.
                </p>
                
                <div class="formula-box">
                    <p style="text-align: center;">
                        \[ \omega_e \approx \omega_0 \]
                    </p>
                </div>
            </div>
            
            <div class="theory-section">
                <h3>So'nuvchi Majburiy Tebranishlar</h3>
                <p>
                    Tashqi kuch ta'sirida so'nuvchi garmonik ossiltatorning harakati:
                </p>
                
                <div class="formula-box">
                    <p style="text-align: center;">
                        \[ m\ddot{x} + \gamma\dot{x} + kx = F_0\cos(\omega_e t) \]
                    </p>
                </div>
                
                <p style="margin-top: 10px;">
                    Amplituda chastotaga bog'liqligi:
                </p>
                
                <div class="formula-box">
                    <p style="text-align: center;">
                        \[ A(\omega) = \frac{F_0/m}{\sqrt{(\omega_0^2 - \omega_e^2)^2 + (2\gamma\omega_e)^2}} \]
                    </p>
                </div>
            </div>
            
            <div class="theory-section">
                <h3>Q Faktor (Sifat Faktori)</h3>
                <p>
                    Q faktor rezonansning keskinligini tavsiflaydi:
                </p>
                
                <div class="formula-box">
                    <p style="text-align: center;">
                        \[ Q = \frac{\omega_0}{2\gamma} \]
                    </p>
                </div>
                
                <p style="margin-top: 10px;">
                    <strong>Yuqori Q:</strong> Keskin rezonans, kichik energiya yo'qotish<br>
                    <strong>Past Q:</strong> Keng rezonans, katta energiya yo'qotish
                </p>
            </div>
            
            <div class="theory-section">
                <h3>Rezonans Chastotasi</h3>
                <div class="formula-box">
                    <p style="text-align: center;">
                        \[ \omega_{res} = \sqrt{\omega_0^2 - 2\gamma^2} \]
                    </p>
                </div>
                <p style="margin-top: 10px;">
                    Kichik so'nish uchun: \( \omega_{res} \approx \omega_0 \)
                </p>
            </div>
            
            <div class="theory-section">
                <h3>Amaliy Misollar</h3>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li><strong>Musiqiy asboblar:</strong> Torlar va havo ustunlarining rezonans tebranishlari</li>
                    <li><strong>Radio qabul qilgichlar:</strong> LC konturlarning rezonans chastotalari</li>
                    <li><strong>Belanchak:</strong> Tebranish chastotasida itarish (maksimal amplituda)</li>
                    <li><strong>Mexanik tizimlar:</strong> Dvigatellar, mashinalar, binolarning tabiiy chastotalari</li>
                    <li><strong>Atom fizikasi:</strong> Elektronlarning energiya sathlarini o'tishi</li>
                    <li><strong>MRI:</strong> Yadro magnit rezonans usuli</li>
                </ul>
            </div>
        </div>
        
        <footer style="text-align: center; padding: 30px; color: var(--text-dim); margin-top: 30px;">
            <p>Â© 2024 Rezonans Simulyatsiyasi | Interaktiv Fizika Ta'limi</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">
                Barmoq harakatlarini qo'llab-quvvatlaydi | 60 FPS animatsiya | Barcha qurilmalarda ishlaydi
            </p>
        </footer>
    </div>
    
    <script>
        // Configuration and State
        const config = {
            omega: 5.0,
            omega0: 5.0,
            gamma: 0.5,
            force: 10,
            mass: 1,
            speed: 1.0,
            time: 0,
            isPlaying: true
        };
        
        // Get canvas contexts
        const mainCanvas = document.getElementById('mainCanvas');
        const mainCtx = mainCanvas.getContext('2d');
        const oscCanvas = document.getElementById('oscillationCanvas');
        const oscCtx = oscCanvas.getContext('2d');
        
        // Setup canvas sizes
        function setupCanvas(canvas) {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * window.devicePixelRatio;
            canvas.height = rect.height * window.devicePixelRatio;
            const ctx = canvas.getContext('2d');
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
            return { width: rect.width, height: rect.height };
        }
        
        let mainSize = setupCanvas(mainCanvas);
        let oscSize = setupCanvas(oscCanvas);
        
        // Resize handler
        window.addEventListener('resize', () => {
            mainSize = setupCanvas(mainCanvas);
            oscSize = setupCanvas(oscCanvas);
            drawResonanceCurve();
            drawOscillation();
        });
        
        // Calculate amplitude at given frequency
        function calculateAmplitude(omega_e, omega_0, gamma, F0, m) {
            const numerator = F0 / m;
            const term1 = Math.pow(omega_0 * omega_0 - omega_e * omega_e, 2);
            const term2 = Math.pow(2 * gamma * omega_e, 2);
            const denominator = Math.sqrt(term1 + term2);
            return numerator / denominator;
        }
        
        // Calculate Q factor
        function calculateQ(omega_0, gamma) {
            return omega_0 / (2 * gamma);
        }
        
        // Draw resonance curve
        function drawResonanceCurve() {
            const ctx = mainCtx;
            const width = mainSize.width;
            const height = mainSize.height;
            
            // Clear canvas
            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, width, height);
            
            // Draw grid
            ctx.strokeStyle = 'rgba(0, 240, 255, 0.1)';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= 10; i++) {
                const y = (height - 60) * i / 10 + 30;
                ctx.beginPath();
                ctx.moveTo(50, y);
                ctx.lineTo(width - 30, y);
                ctx.stroke();
            }
            
            for (let i = 0; i <= 10; i++) {
                const x = (width - 80) * i / 10 + 50;
                ctx.beginPath();
                ctx.moveTo(x, 30);
                ctx.lineTo(x, height - 30);
                ctx.stroke();
            }
            
            // Calculate curve data
            const points = [];
            const maxOmega = 10;
            let maxAmplitude = 0;
            
            for (let i = 0; i <= 200; i++) {
                const omega_e = (maxOmega * i) / 200;
                const amplitude = calculateAmplitude(
                    omega_e,
                    config.omega0,
                    config.gamma,
                    config.force,
                    config.mass
                );
                points.push({ omega: omega_e, amplitude: amplitude });
                maxAmplitude = Math.max(maxAmplitude, amplitude);
            }
            
            // Scale factor
            const amplitudeScale = (height - 80) / maxAmplitude;
            
            // Draw resonance curve
            ctx.strokeStyle = '#00f0ff';
            ctx.lineWidth = 3;
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#00f0ff';
            ctx.beginPath();
            
            points.forEach((point, i) => {
                const x = 50 + ((width - 80) * point.omega) / maxOmega;
                const y = height - 30 - point.amplitude * amplitudeScale;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
            ctx.shadowBlur = 0;
            
            // Draw current point
            const currentAmplitude = calculateAmplitude(
                config.omega,
                config.omega0,
                config.gamma,
                config.force,
                config.mass
            );
            
            const currentX = 50 + ((width - 80) * config.omega) / maxOmega;
            const currentY = height - 30 - currentAmplitude * amplitudeScale;
            
            // Draw point
            ctx.fillStyle = '#ff00aa';
            ctx.shadowBlur = 20;
            ctx.shadowColor = '#ff00aa';
            ctx.beginPath();
            ctx.arc(currentX, currentY, 6, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;
            
            // Draw vertical line at resonance frequency
            const resonanceX = 50 + ((width - 80) * config.omega0) / maxOmega;
            ctx.strokeStyle = 'rgba(255, 170, 0, 0.5)';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(resonanceX, 30);
            ctx.lineTo(resonanceX, height - 30);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Draw axes labels
            ctx.fillStyle = '#e0e6ff';
            ctx.font = '14px Space Mono';
            ctx.textAlign = 'center';
            ctx.fillText('Ï‰ (rad/s)', width / 2, height - 5);
            
            ctx.save();
            ctx.translate(15, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('A (Amplituda)', 0, 0);
            ctx.restore();
            
            // Draw tick marks
            ctx.font = '12px Space Mono';
            for (let i = 0; i <= 10; i++) {
                const x = 50 + ((width - 80) * i) / 10;
                ctx.fillText((i * maxOmega / 10).toFixed(1), x, height - 15);
            }
            
            // Update stats
            document.getElementById('currentOmega').textContent = config.omega.toFixed(2);
            document.getElementById('currentAmplitude').textContent = currentAmplitude.toFixed(2);
            document.getElementById('resonanceFreq').textContent = config.omega0.toFixed(2);
            document.getElementById('qFactor').textContent = calculateQ(config.omega0, config.gamma).toFixed(2);
        }
        
        // Draw oscillation
        function drawOscillation() {
            const ctx = oscCtx;
            const width = oscSize.width;
            const height = oscSize.height;
            
            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, width, height);
            
            // Draw time series
            const amplitude = calculateAmplitude(
                config.omega,
                config.omega0,
                config.gamma,
                config.force,
                config.mass
            );
            
            const timePoints = 500;
            const timeSpan = 20;
            
            // Draw forced oscillation
            ctx.strokeStyle = '#00f0ff';
            ctx.lineWidth = 2;
            ctx.shadowBlur = 5;
            ctx.shadowColor = '#00f0ff';
            ctx.beginPath();
            
            for (let i = 0; i <= timePoints; i++) {
                const t = config.time - timeSpan + (timeSpan * i) / timePoints;
                const x = amplitude * Math.cos(config.omega * t - Math.atan2(2 * config.gamma * config.omega, config.omega0 * config.omega0 - config.omega * config.omega));
                const dampingFactor = Math.exp(-config.gamma * Math.max(0, timeSpan * i / timePoints - timeSpan/2));
                
                const plotX = (width - 80) * i / timePoints + 50;
                const plotY = height / 2 - (x * dampingFactor * (height / 3) / Math.max(amplitude, 1));
                
                if (i === 0) {
                    ctx.moveTo(plotX, plotY);
                } else {
                    ctx.lineTo(plotX, plotY);
                }
            }
            
            ctx.stroke();
            ctx.shadowBlur = 0;
            
            // Draw axes
            ctx.strokeStyle = 'rgba(0, 240, 255, 0.3)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(50, height / 2);
            ctx.lineTo(width - 30, height / 2);
            ctx.stroke();
            
            // Labels
            ctx.fillStyle = '#e0e6ff';
            ctx.font = '14px Space Mono';
            ctx.textAlign = 'center';
            ctx.fillText('Vaqt', width / 2, height - 10);
            
            ctx.save();
            ctx.translate(15, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('x(t)', 0, 0);
            ctx.restore();
        }
        
        // Draw Lissajous figures
        function drawLissajous(canvasId, ratioX, ratioY, phase) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            
            canvas.width = rect.width * window.devicePixelRatio;
            canvas.height = rect.height * window.devicePixelRatio;
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
            
            const width = rect.width;
            const height = rect.height;
            
            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, width, height);
            
            const centerX = width / 2;
            const centerY = height / 2;
            const radius = Math.min(width, height) * 0.35;
            
            ctx.strokeStyle = '#00f0ff';
            ctx.lineWidth = 2;
            ctx.shadowBlur = 5;
            ctx.shadowColor = '#00f0ff';
            ctx.beginPath();
            
            const points = 1000;
            for (let i = 0; i <= points; i++) {
                const t = (Math.PI * 2 * i) / points;
                const x = centerX + radius * Math.sin(ratioX * t);
                const y = centerY + radius * Math.sin(ratioY * t + phase);
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            
            ctx.stroke();
            ctx.shadowBlur = 0;
            
            // Draw current point
            const t = config.time;
            const x = centerX + radius * Math.sin(ratioX * t);
            const y = centerY + radius * Math.sin(ratioY * t + phase);
            
            ctx.fillStyle = '#ff00aa';
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#ff00aa';
            ctx.beginPath();
            ctx.arc(x, y, 4, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // Animation loop
        function animate() {
            if (config.isPlaying) {
                config.time += 0.05 * config.speed;
                drawOscillation();
                
                // Update Lissajous figures
                drawLissajous('lissajous1', 1, 1, 0);
                drawLissajous('lissajous2', 1, 1, Math.PI / 2);
                drawLissajous('lissajous3', 2, 1, 0);
                drawLissajous('lissajous4', 3, 2, Math.PI / 4);
            }
            
            requestAnimationFrame(animate);
        }
        
        // Control handlers
        document.getElementById('omegaSlider').addEventListener('input', (e) => {
            config.omega = parseFloat(e.target.value);
            document.getElementById('omegaValue').textContent = config.omega.toFixed(1);
            drawResonanceCurve();
        });
        
        document.getElementById('omega0Slider').addEventListener('input', (e) => {
            config.omega0 = parseFloat(e.target.value);
            document.getElementById('omega0Value').textContent = config.omega0.toFixed(1);
            drawResonanceCurve();
        });
        
        document.getElementById('gammaSlider').addEventListener('input', (e) => {
            config.gamma = parseFloat(e.target.value);
            document.getElementById('gammaValue').textContent = config.gamma.toFixed(2);
            drawResonanceCurve();
        });
        
        document.getElementById('forceSlider').addEventListener('input', (e) => {
            config.force = parseFloat(e.target.value);
            document.getElementById('forceValue').textContent = config.force.toFixed(0);
            drawResonanceCurve();
        });
        
        document.getElementById('speedSlider').addEventListener('input', (e) => {
            config.speed = parseFloat(e.target.value);
            document.getElementById('speedValue').textContent = config.speed.toFixed(1) + 'x';
        });
        
        // Button handlers
        document.getElementById('playBtn').addEventListener('click', function() {
            config.isPlaying = !config.isPlaying;
            this.textContent = config.isPlaying ? 'â¸ Pause' : 'â–¶ Play';
            this.classList.toggle('active');
        });
        
        document.getElementById('resetBtn').addEventListener('click', () => {
            config.time = 0;
            config.omega = 5.0;
            config.omega0 = 5.0;
            config.gamma = 0.5;
            config.force = 10;
            config.speed = 1.0;
            
            document.getElementById('omegaSlider').value = 5.0;
            document.getElementById('omega0Slider').value = 5.0;
            document.getElementById('gammaSlider').value = 0.5;
            document.getElementById('forceSlider').value = 10;
            document.getElementById('speedSlider').value = 1.0;
            
            document.getElementById('omegaValue').textContent = '5.0';
            document.getElementById('omega0Value').textContent = '5.0';
            document.getElementById('gammaValue').textContent = '0.50';
            document.getElementById('forceValue').textContent = '10';
            document.getElementById('speedValue').textContent = '1.0x';
            
            drawResonanceCurve();
            drawOscillation();
        });
        
        document.getElementById('snapBtn').addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = 'rezonans_' + Date.now() + '.png';
            link.href = mainCanvas.toDataURL();
            link.click();
        });
        
        // Preset buttons
        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const preset = this.dataset.preset;
                
                switch(preset) {
                    case 'sharp':
                        config.omega = 5.0;
                        config.omega0 = 5.0;
                        config.gamma = 0.1;
                        config.force = 10;
                        break;
                    case 'broad':
                        config.omega = 5.0;
                        config.omega0 = 5.0;
                        config.gamma = 1.5;
                        config.force = 10;
                        break;
                    case 'critical':
                        config.omega = 5.0;
                        config.omega0 = 5.0;
                        config.gamma = 5.0;
                        config.force = 10;
                        break;
                    case 'underdamped':
                        config.omega = 5.0;
                        config.omega0 = 5.0;
                        config.gamma = 0.3;
                        config.force = 10;
                        break;
                    case 'overdamped':
                        config.omega = 5.0;
                        config.omega0 = 5.0;
                        config.gamma = 2.0;
                        config.force = 10;
                        break;
                    case 'danger':
                        config.omega = 5.0;
                        config.omega0 = 5.0;
                        config.gamma = 0.05;
                        config.force = 20;
                        break;
                }
                
                document.getElementById('omegaSlider').value = config.omega;
                document.getElementById('omega0Slider').value = config.omega0;
                document.getElementById('gammaSlider').value = config.gamma;
                document.getElementById('forceSlider').value = config.force;
                
                document.getElementById('omegaValue').textContent = config.omega.toFixed(1);
                document.getElementById('omega0Value').textContent = config.omega0.toFixed(1);
                document.getElementById('gammaValue').textContent = config.gamma.toFixed(2);
                document.getElementById('forceValue').textContent = config.force.toFixed(0);
                
                drawResonanceCurve();
                drawOscillation();
            });
        });
        
        // Touch support for mobile
        let touchStartX = 0;
        let touchStartY = 0;
        
        mainCanvas.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });
        
        mainCanvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touchX = e.touches[0].clientX;
            const deltaX = touchX - touchStartX;
            
            const rect = mainCanvas.getBoundingClientRect();
            const relativeX = (touchX - rect.left) / rect.width;
            config.omega = relativeX * 10;
            config.omega = Math.max(0.1, Math.min(10, config.omega));
            
            document.getElementById('omegaSlider').value = config.omega;
            document.getElementById('omegaValue').textContent = config.omega.toFixed(1);
            drawResonanceCurve();
            
            touchStartX = touchX;
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case ' ':
                    e.preventDefault();
                    document.getElementById('playBtn').click();
                    break;
                case 'r':
                case 'R':
                    document.getElementById('resetBtn').click();
                    break;
                case 'ArrowLeft':
                    config.omega = Math.max(0.1, config.omega - 0.1);
                    document.getElementById('omegaSlider').value = config.omega;
                    document.getElementById('omegaValue').textContent = config.omega.toFixed(1);
                    drawResonanceCurve();
                    break;
                case 'ArrowRight':
                    config.omega = Math.min(10, config.omega + 0.1);
                    document.getElementById('omegaSlider').value = config.omega;
                    document.getElementById('omegaValue').textContent = config.omega.toFixed(1);
                    drawResonanceCurve();
                    break;
            }
        });
        
        // Initialize
        drawResonanceCurve();
        drawOscillation();
        drawLissajous('lissajous1', 1, 1, 0);
        drawLissajous('lissajous2', 1, 1, Math.PI / 2);
        drawLissajous('lissajous3', 2, 1, 0);
        drawLissajous('lissajous4', 3, 2, Math.PI / 4);
        animate();
        
        // Render MathJax
        if (window.MathJax) {
            MathJax.typesetPromise();
        }
    </script>
</body>
</html>
