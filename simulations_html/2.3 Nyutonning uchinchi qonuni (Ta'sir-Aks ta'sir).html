<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nyutonning uchinchi qonuni</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        .formula {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            font-size: 2em;
            font-weight: bold;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        .formula small {
            display: block;
            font-size: 0.5em;
            margin-top: 10px;
            opacity: 0.9;
        }
        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        .tab {
            padding: 12px 24px;
            background: #f0f0f0;
            border: 2px solid #667eea;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        .tab.active {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }
        .tab:hover {
            background: #764ba2;
            color: white;
        }
        .sim-panel {
            display: none;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }
        .sim-panel.active { display: block; }
        .sim-title {
            color: #667eea;
            font-size: 1.6em;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 700;
        }
        canvas {
            display: block;
            margin: 0 auto;
            border: 3px solid #667eea;
            border-radius: 10px;
            background: white;
            max-width: 100%;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .ctrl-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        .ctrl-group label {
            font-weight: 600;
            color: #667eea;
            font-size: 0.95em;
        }
        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 700;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }
        button:active { transform: translateY(0); }
        input[type="range"] {
            width: 140px;
            height: 8px;
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
            background: #ddd;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        input[type="number"] {
            width: 90px;
            padding: 10px;
            border: 2px solid #667eea;
            border-radius: 8px;
            text-align: center;
            font-size: 1em;
            font-weight: 600;
        }
        .force-display {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            gap: 15px;
        }
        .force-info {
            flex: 1;
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: 2px solid #667eea;
        }
        .force-info h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .force-arrow {
            font-size: 2.5em;
            margin: 10px 0;
        }
        .examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .example-card {
            background: white;
            border: 3px solid #667eea;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .example-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
        }
        .example-card h3 {
            color: #667eea;
            margin: 15px 0 10px;
            font-size: 1.3em;
        }
        .example-icon {
            font-size: 4em;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f8ff;
            border-radius: 12px;
            margin-bottom: 10px;
        }
        .info-box {
            background: #fff3cd;
            border: 3px solid #ffc107;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }
        .info-box h3 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        .info-box ul {
            margin-left: 25px;
            line-height: 1.8;
        }
        .info-box li {
            margin-bottom: 8px;
        }
        @media (max-width: 768px) {
            .container { padding: 15px; }
            h1 { font-size: 1.8em; }
            .formula { font-size: 1.5em; padding: 20px; }
            .tabs { gap: 5px; }
            .tab { padding: 10px 18px; font-size: 0.9em; }
            .controls { flex-direction: column; }
            canvas { width: 100% !important; height: auto !important; }
            .examples { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚öõÔ∏è Nyutonning uchinchi qonuni</h1>
        <p class="subtitle">Ta'sir va aks ta'sir qonuni</p>

        <div class="formula">
            F‚ÇÅ‚ÇÇ = -F‚ÇÇ‚ÇÅ
            <small>Har bir ta'sirga teng va qarama-qarshi aks ta'sir mavjud</small>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('collision')">üî¥ To'qnashuv</div>
            <div class="tab" onclick="switchTab('rocket')">üöÄ Raketa</div>
            <div class="tab" onclick="switchTab('walking')">üö∂ Yurish</div>
            <div class="tab" onclick="switchTab('forces')">‚ö° Kuchlar</div>
        </div>

        <div id="collision" class="sim-panel active">
            <div class="sim-title">Jismlar to'qnashuvi</div>
            <canvas id="c1" width="800" height="400"></canvas>
            <div class="controls">
                <div class="ctrl-group">
                    <label>Massa 1 (kg)</label>
                    <input type="number" id="m1" value="5" min="1" max="20">
                </div>
                <div class="ctrl-group">
                    <label>Massa 2 (kg)</label>
                    <input type="number" id="m2" value="3" min="1" max="20">
                </div>
                <div class="ctrl-group">
                    <label>Tezlik 1 (m/s)</label>
                    <input type="number" id="v1" value="8" min="0" max="20">
                </div>
                <div class="ctrl-group">
                    <label>Tezlik 2 (m/s)</label>
                    <input type="number" id="v2" value="0" min="0" max="20">
                </div>
                <button onclick="startCollision()">‚ñ∂Ô∏è Boshlash</button>
                <button onclick="resetCollision()">üîÑ Qayta</button>
            </div>
            <div class="force-display">
                <div class="force-info">
                    <h4>Jism 1 ga ta'sir</h4>
                    <div class="force-arrow">‚¨ÖÔ∏è</div>
                    <div id="f1">F‚ÇÅ = 0 N</div>
                </div>
                <div class="force-info">
                    <h4>Jism 2 ga ta'sir</h4>
                    <div class="force-arrow">‚û°Ô∏è</div>
                    <div id="f2">F‚ÇÇ = 0 N</div>
                </div>
            </div>
        </div>

        <div id="rocket" class="sim-panel">
            <div class="sim-title">Raketa harakati</div>
            <canvas id="c2" width="800" height="400"></canvas>
            <div class="controls">
                <div class="ctrl-group">
                    <label>Yonilg'i tezligi: <span id="fvVal">50</span> m/s</label>
                    <input type="range" id="fv" min="10" max="100" value="50" oninput="fvVal.textContent=this.value">
                </div>
                <div class="ctrl-group">
                    <label>Yonilg'i sarfi: <span id="frVal">5</span> kg/s</label>
                    <input type="range" id="fr" min="1" max="10" value="5" oninput="frVal.textContent=this.value">
                </div>
                <button onclick="startRocket()">üöÄ Uchirish</button>
                <button onclick="resetRocket()">üîÑ Qayta</button>
            </div>
            <div class="force-display">
                <div class="force-info">
                    <h4>Gazga ta'sir</h4>
                    <div class="force-arrow">‚¨áÔ∏è</div>
                    <div id="fg">F_gaz = 0 N</div>
                </div>
                <div class="force-info">
                    <h4>Raketaga ta'sir</h4>
                    <div class="force-arrow">‚¨ÜÔ∏è</div>
                    <div id="fr2">F_raketa = 0 N</div>
                </div>
            </div>
        </div>

        <div id="walking" class="sim-panel">
            <div class="sim-title">Yurish mexanizmi</div>
            <canvas id="c3" width="800" height="400"></canvas>
            <div class="controls">
                <div class="ctrl-group">
                    <label>Tezlik: <span id="wsVal">5</span></label>
                    <input type="range" id="ws" min="1" max="10" value="5" oninput="wsVal.textContent=this.value">
                </div>
                <div class="ctrl-group">
                    <label>Ishqalanish: <span id="fricVal">0.5</span></label>
                    <input type="range" id="fric" min="0.1" max="1" step="0.1" value="0.5" oninput="fricVal.textContent=this.value">
                </div>
                <button onclick="startWalk()">üö∂ Yurish</button>
                <button onclick="stopWalk()">‚èπÔ∏è To'xtatish</button>
            </div>
            <div class="force-display">
                <div class="force-info">
                    <h4>Yerga ta'sir</h4>
                    <div class="force-arrow">‚û°Ô∏è</div>
                    <div id="fw1">F_yer = 0 N</div>
                </div>
                <div class="force-info">
                    <h4>Odamga ta'sir</h4>
                    <div class="force-arrow">‚¨ÖÔ∏è</div>
                    <div id="fw2">F_odam = 0 N</div>
                </div>
            </div>
        </div>

        <div id="forces" class="sim-panel">
            <div class="sim-title">Kuch vektorlari</div>
            <canvas id="c4" width="800" height="400"></canvas>
            <div class="controls">
                <div class="ctrl-group">
                    <label>Kuch: <span id="fmVal">100</span> N</label>
                    <input type="range" id="fm" min="10" max="200" value="100" oninput="fmVal.textContent=this.value">
                </div>
                <div class="ctrl-group">
                    <label>Yo'nalish: <span id="fdVal">0</span>¬∞</label>
                    <input type="range" id="fd" min="0" max="360" value="0" oninput="fdVal.textContent=this.value">
                </div>
                <button onclick="applyForce()">‚ö° Qo'llash</button>
                <button onclick="resetForces()">üîÑ Qayta</button>
            </div>
            <div class="force-display">
                <div class="force-info">
                    <h4>Ta'sir kuchi</h4>
                    <div id="ff1">F_action = 0 N</div>
                </div>
                <div class="force-info">
                    <h4>Aks ta'sir</h4>
                    <div id="ff2">F_reaction = 0 N</div>
                </div>
            </div>
        </div>

        <div class="examples">
            <div class="example-card">
                <div class="example-icon">üöó</div>
                <h3>Mashina harakati</h3>
                <p>G'ildiraklar yerga kuch qo'llaydi, yer mashinaga qarama-qarshi kuch qo'llaydi</p>
            </div>
            <div class="example-card">
                <div class="example-icon">üèä</div>
                <h3>Suzish</h3>
                <p>Suzuvchi suvni orqaga itaradi, suv suzuvchini oldinga itaradi</p>
            </div>
            <div class="example-card">
                <div class="example-icon">üê¶</div>
                <h3>Qush parvozi</h3>
                <p>Qanotlar havoni pastga itaradi, havo qushni yuqoriga ko'taradi</p>
            </div>
        </div>

        <div class="info-box">
            <h3>üí° Asosiy xususiyatlar</h3>
            <ul>
                <li><strong>Teng kattalik:</strong> Ta'sir va aks ta'sir kuchlari har doim teng</li>
                <li><strong>Qarama-qarshi yo'nalish:</strong> Kuchlar doim bir-biriga teskari yo'nalgan</li>
                <li><strong>Turli jismlar:</strong> Kuchlar har xil jismlarga ta'sir qiladi</li>
                <li><strong>Bir vaqtda:</strong> Ta'sir va aks ta'sir bir vaqtda sodir bo'ladi</li>
            </ul>
        </div>
    </div>

    <script>
        let anim, tab = 'collision';
        const ctx1 = c1.getContext('2d');
        const ctx2 = c2.getContext('2d');
        const ctx3 = c3.getContext('2d');
        const ctx4 = c4.getContext('2d');

        let state = {
            balls: [],
            collided: false,
            forces: {f1: 0, f2: 0},
            rocket: {x: 100, y: 350, vx: 0, vy: 0, fuel: 100},
            particles: [],
            thrust: 0,
            person: {x: 100, y: 200, step: 0},
            walking: false,
            wforces: {ground: 0, person: 0},
            objs: [{x: 300, y: 200, vx: 0, vy: 0}, {x: 500, y: 200, vx: 0, vy: 0}],
            fforces: {action: 0, reaction: 0}
        };

        function switchTab(t) {
            document.querySelectorAll('.sim-panel, .tab').forEach(e => e.classList.remove('active'));
            document.getElementById(t).classList.add('active');
            event.target.classList.add('active');
            tab = t;
            if (anim) cancelAnimationFrame(anim);
            resetAll();
        }

        function resetAll() {
            resetCollision();
            resetRocket();
            stopWalk();
            resetForces();
        }

        function arrow(ctx, x1, y1, x2, y2, col) {
            ctx.strokeStyle = ctx.fillStyle = col;
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
            const ang = Math.atan2(y2 - y1, x2 - x1);
            ctx.beginPath();
            ctx.moveTo(x2, y2);
            ctx.lineTo(x2 - 10 * Math.cos(ang - 0.5), y2 - 10 * Math.sin(ang - 0.5));
            ctx.lineTo(x2 - 10 * Math.cos(ang + 0.5), y2 - 10 * Math.sin(ang + 0.5));
            ctx.closePath();
            ctx.fill();
        }

        function startCollision() {
            const m1v = +m1.value, m2v = +m2.value, v1v = +v1.value, v2v = +v2.value;
            state.balls = [
                {x: 150, y: 200, vx: v1v, vy: 0, m: m1v, r: Math.sqrt(m1v) * 5 + 10, c: '#f44'},
                {x: 650, y: 200, vx: -v2v, vy: 0, m: m2v, r: Math.sqrt(m2v) * 5 + 10, c: '#44f'}
            ];
            state.collided = false;
            state.forces = {f1: 0, f2: 0};
            animCollision();
        }

        function resetCollision() {
            if (anim) cancelAnimationFrame(anim);
            startCollision();
            cancelAnimationFrame(anim);
            drawCollision();
        }

        function animCollision() {
            updateCollision();
            drawCollision();
            f1.textContent = `F‚ÇÅ = ${state.forces.f1.toFixed(1)} N`;
            f2.textContent = `F‚ÇÇ = ${state.forces.f2.toFixed(1)} N`;
            if (tab === 'collision') anim = requestAnimationFrame(animCollision);
        }

        function updateCollision() {
            const [b1, b2] = state.balls;
            const dx = b2.x - b1.x, dy = b2.y - b1.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            
            if (dist < b1.r + b2.r && !state.collided) {
                state.collided = true;
                const totM = b1.m + b2.m;
                const relV = Math.abs(b1.vx - b2.vx);
                const force = (b1.m * b2.m * relV) / (totM * 0.1);
                state.forces.f1 = state.forces.f2 = force;
                
                const v1n = ((b1.m - b2.m) * b1.vx + 2 * b2.m * b2.vx) / totM;
                const v2n = ((b2.m - b1.m) * b2.vx + 2 * b1.m * b1.vx) / totM;
                b1.vx = v1n;
                b2.vx = v2n;
                
                const ovr = b1.r + b2.r - dist;
                b1.x -= ovr / 2 * (dx / dist);
                b2.x += ovr / 2 * (dx / dist);
                
                setTimeout(() => { state.forces.f1 *= 0.3; state.forces.f2 *= 0.3; }, 200);
                setTimeout(() => { state.collided = false; }, 500);
            }
            
            b1.x += b1.vx;
            b2.x += b2.vx;
            
            [b1, b2].forEach(b => {
                if (b.x - b.r < 0 || b.x + b.r > 800) {
                    b.vx *= -0.8;
                    b.x = Math.max(b.r, Math.min(800 - b.r, b.x));
                }
                b.vx *= 0.999;
            });
            
            state.forces.f1 *= 0.98;
            state.forces.f2 *= 0.98;
        }

        function drawCollision() {
            ctx1.clearRect(0, 0, 800, 400);
            ctx1.fillStyle = '#8B4513';
            ctx1.fillRect(0, 380, 800, 20);
            
            state.balls.forEach((b, i) => {
                ctx1.fillStyle = b.c;
                ctx1.beginPath();
                ctx1.arc(b.x, b.y, b.r, 0, Math.PI * 2);
                ctx1.fill();
                
                ctx1.fillStyle = 'white';
                ctx1.font = 'bold 16px Arial';
                ctx1.textAlign = 'center';
                ctx1.fillText(`${b.m}kg`, b.x, b.y + 5);
                
                if (Math.abs(b.vx) > 0.1) arrow(ctx1, b.x, b.y, b.x + b.vx * 10, b.y, 'green');
                
                if (state.collided && state.forces.f1 > 0.1) {
                    const dir = i === 0 ? -1 : 1;
                    const len = Math.min((i === 0 ? state.forces.f1 : state.forces.f2) / 2, 80);
                    arrow(ctx1, b.x, b.y - b.r - 10, b.x + dir * len, b.y - b.r - 10, 'red');
                }
            });
        }

        function startRocket() {
            state.rocket = {x: 100, y: 350, vx: 0, vy: 0, fuel: 100};
            state.particles = [];
            state.thrust = 0;
            animRocket();
        }

        function resetRocket() {
            if (anim) cancelAnimationFrame(anim);
            startRocket();
            cancelAnimationFrame(anim);
            drawRocket();
        }

        function animRocket() {
            if (state.rocket.fuel > 0 || state.rocket.vy !== 0 || state.particles.length > 0) {
                updateRocket();
                drawRocket();
                fg.textContent = `F_gaz = ${state.thrust.toFixed(1)} N`;
                fr2.textContent = `F_raketa = ${state.thrust.toFixed(1)} N`;
                if (tab === 'rocket') anim = requestAnimationFrame(animRocket);
            }
        }

        function updateRocket() {
            const fvel = +fv.value, frate = +fr.value;
            
            if (state.rocket.fuel > 0) {
                state.thrust = frate * fvel;
                state.rocket.vy -= state.thrust / 1000;
                state.rocket.fuel -= frate / 10;
                
                for (let i = 0; i < 3; i++) {
                    state.particles.push({
                        x: state.rocket.x + Math.random() * 20 - 10,
                        y: state.rocket.y + 30,
                        vx: (Math.random() - 0.5) * 4,
                        vy: fvel / 10 + Math.random() * 5,
                        life: 30,
                        max: 30
                    });
                }
            } else {
                state.thrust = 0;
            }
            
            state.rocket.vy += 0.3;
            state.rocket.x += state.rocket.vx;
            state.rocket.y += state.rocket.vy;
            
            if (state.rocket.y > 350) {
                state.rocket.y = 350;
                state.rocket.vy = 0;
            }
            
            state.particles = state.particles.filter(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.life--;
                return p.life > 0;
            });
        }

        function drawRocket() {
            const g = ctx2.createLinearGradient(0, 0, 0, 400);
            g.addColorStop(0, '#87CEEB');
            g.addColorStop(1, '#E0F6FF');
            ctx2.fillStyle = g;
            ctx2.fillRect(0, 0, 800, 400);
            ctx2.fillStyle = '#8B4513';
            ctx2.fillRect(0, 380, 800, 20);
            
            state.particles.forEach(p => {
                const a = p.life / p.max;
                ctx2.fillStyle = `rgba(255, ${100 + Math.floor(155 * a)}, 0, ${a})`;
                ctx2.beginPath();
                ctx2.arc(p.x, p.y, 3, 0, Math.PI * 2);
                ctx2.fill();
            });
            
            ctx2.fillStyle = '#C0C0C0';
            ctx2.fillRect(state.rocket.x - 10, state.rocket.y - 30, 20, 60);
            ctx2.fillStyle = '#F00';
            ctx2.beginPath();
            ctx2.moveTo(state.rocket.x, state.rocket.y - 30);
            ctx2.lineTo(state.rocket.x - 10, state.rocket.y - 10);
            ctx2.lineTo(state.rocket.x + 10, state.rocket.y - 10);
            ctx2.closePath();
            ctx2.fill();
            
            ctx2.fillStyle = '#000';
            ctx2.fillRect(20, 20, 200, 20);
            ctx2.fillStyle = state.rocket.fuel > 20 ? '#0F0' : '#F00';
            ctx2.fillRect(22, 22, state.rocket.fuel / 100 * 196, 16);
            ctx2.fillStyle = '#000';
            ctx2.font = '14px Arial';
            ctx2.fillText(`Yonilg'i: ${state.rocket.fuel.toFixed(1)}%`, 25, 55);
            
            if (state.thrust > 0) arrow(ctx2, state.rocket.x, state.rocket.y - 40, state.rocket.x, state.rocket.y - 40 - state.thrust / 5, 'blue');
        }

        function startWalk() {
            state.walking = true;
            animWalk();
        }

        function stopWalk() {
            state.walking = false;
            if (anim) cancelAnimationFrame(anim);
            state.wforces = {ground: 0, person: 0};
            fw1.textContent = 'F_yer = 0 N';
            fw2.textContent = 'F_odam = 0 N';
        }

        function animWalk() {
            if (state.walking) {
                updateWalk();
                drawWalk();
                fw1.textContent = `F_yer = ${state.wforces.ground.toFixed(1)} N`;
                fw2.textContent = `F_odam = ${state.wforces.person.toFixed(1)} N`;
                if (tab === 'walking') anim = requestAnimationFrame(animWalk);
            }
        }

        function updateWalk() {
            const speed = +ws.value, friction = +fric.value;
            
            if (state.walking) {
                state.person.step += speed / 10;
                state.person.x += speed / 2;
                const force = speed * friction * 10;
                state.wforces.ground = state.wforces.person = force;
                
                if (state.person.x > 850) state.person.x = -50;
            }
        }

        function drawWalk() {
            ctx3.clearRect(0, 0, 800, 400);
            ctx3.fillStyle = '#8B4513';
            ctx3.fillRect(0, 350, 800, 50);
            
            const p = state.person;
            ctx3.strokeStyle = '#000';
            ctx3.lineWidth = 4;
            
            ctx3.beginPath();
            ctx3.arc(p.x, p.y - 80, 20, 0, Math.PI * 2);
            ctx3.stroke();
            
            ctx3.beginPath();
            ctx3.moveTo(p.x, p.y - 60);
            ctx3.lineTo(p.x, p.y - 10);
            ctx3.stroke();
            
            ctx3.beginPath();
            ctx3.moveTo(p.x - 20, p.y - 40);
            ctx3.lineTo(p.x + 20, p.y - 40);
            ctx3.stroke();
            
            const leg = Math.sin(p.step) * 20;
            ctx3.beginPath();
            ctx3.moveTo(p.x, p.y - 10);
            ctx3.lineTo(p.x - leg, p.y + 30);
            ctx3.moveTo(p.x, p.y - 10);
            ctx3.lineTo(p.x + leg, p.y + 30);
            ctx3.stroke();
            
            if (state.walking && state.wforces.person > 0) {
                arrow(ctx3, p.x, p.y + 35, p.x + state.wforces.person * 0.8, p.y + 35, 'red');
                arrow(ctx3, p.x, p.y + 45, p.x - state.wforces.ground * 0.8, p.y + 45, 'blue');
            }
        }

        function applyForce() {
            const mag = +fm.value, dir = +fd.value * Math.PI / 180;
            state.fforces.action = state.fforces.reaction = mag;
            
            state.objs[0].vx += Math.cos(dir) * mag / 100;
            state.objs[0].vy += Math.sin(dir) * mag / 100;
            state.objs[1].vx -= Math.cos(dir) * mag / 100;
            state.objs[1].vy -= Math.sin(dir) * mag / 100;
            
            animForces();
        }

        function resetForces() {
            if (anim) cancelAnimationFrame(anim);
            state.objs = [{x: 300, y: 200, vx: 0, vy: 0}, {x: 500, y: 200, vx: 0, vy: 0}];
            state.fforces = {action: 0, reaction: 0};
            drawForces();
            ff1.textContent = 'F_action = 0 N';
            ff2.textContent = 'F_reaction = 0 N';
        }

        function animForces() {
            updateForces();
            drawForces();
            ff1.textContent = `F_action = ${state.fforces.action.toFixed(1)} N`;
            ff2.textContent = `F_reaction = ${state.fforces.reaction.toFixed(1)} N`;
            if (tab === 'forces') anim = requestAnimationFrame(animForces);
        }

        function updateForces() {
            state.objs.forEach(o => {
                o.x += o.vx;
                o.y += o.vy;
                o.vx *= 0.98;
                o.vy *= 0.98;
                
                if (o.x < 25 || o.x > 775) {
                    o.vx *= -0.8;
                    o.x = Math.max(25, Math.min(775, o.x));
                }
                if (o.y < 25 || o.y > 375) {
                    o.vy *= -0.8;
                    o.y = Math.max(25, Math.min(375, o.y));
                }
            });
            
            state.fforces.action *= 0.95;
            state.fforces.reaction *= 0.95;
        }

        function drawForces() {
            ctx4.clearRect(0, 0, 800, 400);
            ctx4.strokeStyle = '#f0f0f0';
            ctx4.lineWidth = 1;
            for (let i = 0; i < 800; i += 50) {
                ctx4.beginPath();
                ctx4.moveTo(i, 0);
                ctx4.lineTo(i, 400);
                ctx4.stroke();
            }
            for (let i = 0; i < 400; i += 50) {
                ctx4.beginPath();
                ctx4.moveTo(0, i);
                ctx4.lineTo(800, i);
                ctx4.stroke();
            }
            
            state.objs.forEach((o, i) => {
                ctx4.fillStyle = i === 0 ? '#f44' : '#44f';
                ctx4.beginPath();
                ctx4.arc(o.x, o.y, 25, 0, Math.PI * 2);
                ctx4.fill();
                
                if (Math.abs(o.vx) > 0.1 || Math.abs(o.vy) > 0.1) {
                    arrow(ctx4, o.x, o.y, o.x + o.vx * 10, o.y + o.vy * 10, 'green');
                }
            });
            
            if (state.fforces.action > 1) {
                const mag = state.fforces.action, dir = +fd.value * Math.PI / 180;
                arrow(ctx4, state.objs[0].x, state.objs[0].y,
                    state.objs[0].x + Math.cos(dir) * mag / 2,
                    state.objs[0].y + Math.sin(dir) * mag / 2, 'red');
                arrow(ctx4, state.objs[1].x, state.objs[1].y,
                    state.objs[1].x - Math.cos(dir) * mag / 2,
                    state.objs[1].y - Math.sin(dir) * mag / 2, 'blue');
            }
        }

        window.onload = () => {
            resetCollision();
            drawRocket();
            drawWalk();
            drawForces();
        };
    </script>
</body>
</html>
